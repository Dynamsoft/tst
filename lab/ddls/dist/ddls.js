/*!
* Dynamsoft Driver License Scanner JavaScript Library
* @product Dynamsoft Driver License Scanner JS Edition Bundle
* @website http://www.dynamsoft.com
* @copyright Copyright 2025, Dynamsoft Corporation
* @author Dynamsoft
* @version 2.0.0
* @fileoverview Dynamsoft Driver License Scanner is a ready-to-use SDK for capturing and enhancing document images with automatic border detection, correction, and customizable workflows. Uses Dynamsoft Capture Vision Bundle v2.6.1000.
* More info on Dynamsoft Driver License Scanner JS: https://www.dynamsoft.com/capture-vision/docs/web/programming/javascript/
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("dynamsoft-capture-vision-bundle")):"function"==typeof define&&define.amd?define(["exports","dynamsoft-capture-vision-bundle"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Dynamsoft=e.Dynamsoft||{},e.Dynamsoft)}(this,(function(e,t){"use strict";function i(e){var t=Object.create(null);return e&&Object.keys(e).forEach((function(i){if("default"!==i){var n=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(t,i,n.get?n:{enumerable:!0,get:function(){return e[i]}})}})),t.default=e,Object.freeze(t)}var n,a,s=i(t);function o(e){if("string"==typeof e){const t=document.querySelector(e);if(!t)throw new Error("Element not found");return t}return e instanceof HTMLElement?e:null}e.EnumResultStatus=void 0,(n=e.EnumResultStatus||(e.EnumResultStatus={}))[n.RS_SUCCESS=0]="RS_SUCCESS",n[n.RS_CANCELLED=1]="RS_CANCELLED",n[n.RS_FAILED=2]="RS_FAILED",function(e){e.MANUAL="manual",e.SMART_CAPTURE="smartCapture",e.AUTO_CROP="autoCrop",e.UPLOADED_IMAGE="uploadedImage",e.STATIC_FILE="staticFile"}(a||(a={}));function r(e,t){l("ddls-controls-style","\n  .ddls-controls {\n    display: flex;\n    height: 8rem;\n    background-color: #323234;\n    align-items: center;\n    font-size: 12px;\n    font-family: Verdana;\n    color: white;\n    width: 100%;\n  }\n\n  .ddls-control-btn {\n    background-color: #323234;\n    color: white;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    flex-direction: column;\n    height: 100%;\n    width: 100%;\n    gap: 0.5rem;\n    text-align: center;\n    user-select: none;\n  }\n\n  .ddls-control-btn.hide {\n    display: none;\n  }\n\n  .ddls-control-btn.disabled {\n    opacity: 0.4;\n    pointer-events: none;\n    cursor: default;\n  }\n\n  .ddls-control-icon-wrapper {\n    flex: 0.75;\n    display: flex;\n    align-items: flex-end;\n    justify-content: center;\n    min-height: 40px;\n  }\n\n  .ddls-control-icon img,\n  .ddls-control-icon svg {\n    width: 32px;\n    height: 32px;\n    fill: #fe8e14;\n  }\n\n  .ddls-control-text {\n    flex: 0.5;\n    display: flex;\n    align-items: flex-start;\n    justify-content: center;\n  }\n\n  @media (orientation: landscape) and (max-width: 1024px) {\n    .ddls-controls {\n      flex-direction: column;\n      height: 100%;\n      width: 8rem;\n    }\n  }\n");const i=document.createElement("div");return i.className="ddls-controls",e.forEach((e=>{const t=document.createElement("div");t.className=`ddls-control-btn ${null==e?void 0:e.className}`;const n=document.createElement("div");if(n.className="ddls-control-icon-wrapper",(a=e.icon).trim().startsWith("<svg")&&a.trim().endsWith("</svg>"))n.innerHTML=e.icon;else{const t=document.createElement("img");t.src=e.icon,t.alt=e.label,t.width=24,t.height=24,n.appendChild(t)}var a;const s=document.createElement("div");s.className="ddls-control-text",s.textContent=e.label,e.isDisabled&&t.classList.add("disabled"),e.isHidden&&t.classList.add("hide"),t.appendChild(n),t.appendChild(s),e.onClick&&!e.isDisabled&&t.addEventListener("click",e.onClick),i.appendChild(t)})),i}function c(e){return[a.SMART_CAPTURE,a.UPLOADED_IMAGE,a.MANUAL].includes(e)}function l(e,t){if(!document.getElementById(e)){const i=document.createElement("style");i.id=e,i.textContent=t,document.head.appendChild(i)}}const d=e=>!e||0===Object.keys(e).length,u={"4k":{width:3840,height:2160},"2k":{width:2560,height:1440},"1080p":{width:1920,height:1080},"720p":{width:1280,height:720},"480p":{width:640,height:480}};const h=(e,t,i=15)=>{const n=e.reduce(((e,t)=>(e.x+=t.x,e.y+=t.y,e)),{x:0,y:0});n.x/=e.length,n.y/=e.length;const a=e.map((e=>{const t=e.x-n.x,a=e.y-n.y,s=Math.sqrt(t**2+a**2),o=t/s,r=a/s;return{x:e.x+i*o,y:e.y+i*r}}));return a.some((e=>(e=>e.x<0||e.x>t.width||e.y<0||e.y>t.height)(e)))?e:a},m={fullImage:'\n  <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="25" viewBox="0 0 25 25">\n  <defs>\n    <clipPath id="fullImageclip-path">\n      <rect id="Rectangle_2776" data-name="Rectangle 2776" width="25" height="25" fill="#fff"/>\n    </clipPath>\n  </defs>\n  <g id="full-image" transform="translate(0 0)">\n    <g id="Group_586" data-name="Group 586" transform="translate(0 0)" clip-path="url(#fullImageclip-path)">\n      <path id="Path_1528" data-name="Path 1528" d="M.621,3.618A.621.621,0,0,0,1.242,3V1.809a.569.569,0,0,1,.567-.567H3A.621.621,0,0,0,3,0H1.809A1.811,1.811,0,0,0,0,1.809V3a.621.621,0,0,0,.621.621" transform="translate(0 0)" fill="#fff"/>\n      <path id="Path_1529" data-name="Path 1529" d="M17.842,1.242H19.03a.568.568,0,0,1,.566.567V3a.621.621,0,1,0,1.242,0V1.809A1.811,1.811,0,0,0,19.03,0H17.842a.621.621,0,0,0,0,1.242" transform="translate(4.162 0)" fill="#fff"/>\n      <path id="Path_1530" data-name="Path 1530" d="M9.562,0H5.4a.621.621,0,0,0,0,1.242H9.562A.621.621,0,0,0,9.562,0" transform="translate(1.156 0)" fill="#fff"/>\n      <path id="Path_1531" data-name="Path 1531" d="M11.623,1.242h4.158a.621.621,0,0,0,0-1.242H11.623a.621.621,0,0,0,0,1.242" transform="translate(2.659 0)" fill="#fff"/>\n      <path id="Path_1532" data-name="Path 1532" d="M3,19.6H1.808a.568.568,0,0,1-.566-.567V17.841a.621.621,0,1,0-1.242,0v1.188a1.81,1.81,0,0,0,1.808,1.809H3A.621.621,0,0,0,3,19.6" transform="translate(0 4.161)" fill="#fff"/>\n      <path id="Path_1533" data-name="Path 1533" d="M9.562,19.134H5.4a.621.621,0,1,0,0,1.242H9.562a.621.621,0,1,0,0-1.242" transform="translate(1.156 4.624)" fill="#fff"/>\n      <path id="Path_1534" data-name="Path 1534" d="M.621,10.183a.621.621,0,0,0,.621-.621V5.4A.621.621,0,0,0,0,5.4V9.562a.621.621,0,0,0,.621.621" transform="translate(0 1.156)" fill="#fff"/>\n      <path id="Path_1535" data-name="Path 1535" d="M.621,16.4a.621.621,0,0,0,.621-.621V11.624a.621.621,0,1,0-1.242,0v4.157a.621.621,0,0,0,.621.621" transform="translate(0 2.659)" fill="#fff"/>\n      <path id="Path_1536" data-name="Path 1536" d="M20.376,5.4a.621.621,0,1,0-1.242,0V9.563a.621.621,0,1,0,1.242,0Z" transform="translate(4.624 1.156)" fill="#fff"/>\n      <path id="Path_1537" data-name="Path 1537" d="M20.217,17.221a.621.621,0,0,0-.621.621V19.03a.568.568,0,0,1-.567.566H17.841a.621.621,0,1,0,0,1.242h1.188a1.811,1.811,0,0,0,1.809-1.808V17.842a.621.621,0,0,0-.621-.621" transform="translate(4.162 4.162)" fill="#fff"/>\n      <path id="Path_1538" data-name="Path 1538" d="M15.781,19.134H11.623a.621.621,0,1,0,0,1.242h4.158a.621.621,0,0,0,0-1.242" transform="translate(2.659 4.624)" fill="#fff"/>\n      <path id="Path_1539" data-name="Path 1539" d="M19.755,11a.621.621,0,0,0-.621.621v4.157a.621.621,0,0,0,1.242,0V11.624A.621.621,0,0,0,19.755,11" transform="translate(4.624 2.659)" fill="#fff"/>\n      <path id="Path_1540" data-name="Path 1540" d="M7.5,18.3a.621.621,0,0,0-.621-.621H4.733l5.149-5.149A.621.621,0,0,0,9,11.656L3.855,16.806V14.579a.621.621,0,0,0-1.242,0V18.3a.611.611,0,0,0,.048.238A.606.606,0,0,0,3,18.877a.606.606,0,0,0,.238.048H6.878A.621.621,0,0,0,7.5,18.3" transform="translate(0.632 2.773)" fill="#fff"/>\n      <path id="Path_1541" data-name="Path 1541" d="M14.173,3.409a.619.619,0,0,0,.621.621h1.836L11.483,9.178a.621.621,0,0,0,.878.878l5.148-5.148V6.744a.621.621,0,1,0,1.242,0V3.41a.606.606,0,0,0-.048-.238.612.612,0,0,0-.335-.335.606.606,0,0,0-.238-.048H14.794a.621.621,0,0,0-.621.621" transform="translate(2.731 0.673)" fill="#fff"/>\n      <path id="Path_1542" data-name="Path 1542" d="M2.661,3.172a.615.615,0,0,0-.048.238V6.744a.621.621,0,0,0,1.242,0V4.908L9,10.057a.621.621,0,0,0,.878-.878L4.733,4.03H6.57a.621.621,0,1,0,0-1.242H3.235A.634.634,0,0,0,3,2.836a.624.624,0,0,0-.335.335" transform="translate(0.632 0.673)" fill="#fff"/>\n      <path id="Path_1543" data-name="Path 1543" d="M18.7,18.545a.617.617,0,0,0,.048-.24h0V14.581a.62.62,0,1,0-1.24,0v2.226l-5.148-5.15a.621.621,0,0,0-.878.878l5.147,5.149H14.4a.621.621,0,0,0-.621.621.623.623,0,0,0,.621.621h3.71a.616.616,0,0,0,.453-.18.6.6,0,0,0,.117-.175c0-.009.012-.016.016-.025" transform="translate(2.731 2.773)" fill="#fff"/>\n    </g>\n  </g>\n</svg>\n\n',autoBounds:'<svg xmlns="http://www.w3.org/2000/svg" width="25.04" height="25" viewBox="0 0 25.04 25">\n  <g id="bounds-detection" transform="translate(0.02)">\n    <g id="Group_306" data-name="Group 306" transform="translate(-0.02)">\n      <path id="Path_982" data-name="Path 982" d="M.791,8.146h.02a.468.468,0,0,0,.516-.416.455.455,0,0,0,0-.063V1.927a1,1,0,0,1,1-1H7.957A.468.468,0,0,0,8.436.492.468.468,0,0,0,7.977.013H2.247A1.913,1.913,0,0,0,.333,1.927v5.74A.468.468,0,0,0,.791,8.146Z" transform="translate(-0.293 -0.012)" fill="#fff"/>\n      <path id="Path_983" data-name="Path 983" d="M140.092,132.044a.468.468,0,0,0-.458-.478h-.02a.468.468,0,0,0-.478.458q0,.01,0,.02v5.74a1,1,0,0,1-1,1h-5.671a.5.5,0,0,0,0,1h5.711a1.913,1.913,0,0,0,1.915-1.912q0-.041,0-.081Z" transform="translate(-115.132 -114.777)" fill="#fff"/>\n      <path id="Path_984" data-name="Path 984" d="M7.665,138.7H1.955a1,1,0,0,1-1-1v-5.661a.468.468,0,0,0-.458-.478H.48a.468.468,0,0,0-.478.458q0,.01,0,.02v5.74A1.914,1.914,0,0,0,1.914,139.7H7.665a.5.5,0,1,0,0-1Z" transform="translate(-0.001 -114.777)" fill="#fff"/>\n      <path id="Path_985" data-name="Path 985" d="M138.405,0l-.081,0h-5.711a.468.468,0,0,0-.478.458q0,.01,0,.02a.468.468,0,0,0,.458.478h5.731a1,1,0,0,1,1,1v5.7a.5.5,0,0,0,1,0V1.915A1.913,1.913,0,0,0,138.405,0Z" transform="translate(-115.277)" fill="#fff"/>\n      <path id="Path_986" data-name="Path 986" d="M32.226,33.132v14.81a1.227,1.227,0,0,0,1.227,1.227H48.265a1.217,1.217,0,0,0,1.227-1.206V33.132a1.217,1.217,0,0,0-1.206-1.227H33.453A1.227,1.227,0,0,0,32.226,33.132Zm16.251-.045a.19.19,0,0,1,0,.045v14.81a.19.19,0,0,1-.179.2H33.453a.19.19,0,0,1-.211-.168.182.182,0,0,1,0-.033V33.132a.19.19,0,0,1,.212-.212H48.265A.191.191,0,0,1,48.477,33.087Z" transform="translate(-28.359 -28.076)" fill="#fff"/>\n      <path id="Path_987" data-name="Path 987" d="M59.363,95.652h9.209a.478.478,0,0,0,.478-.478.488.488,0,0,0-.478-.478H59.363a.488.488,0,0,0-.478.478A.478.478,0,0,0,59.363,95.652Z" transform="translate(-51.309 -82.838)" fill="#fff"/>\n      <path id="Path_988" data-name="Path 988" d="M59.363,128.6h9.209a.478.478,0,0,0,.478-.478.488.488,0,0,0-.478-.478H59.363a.488.488,0,0,0-.478.478A.478.478,0,0,0,59.363,128.6Z" transform="translate(-51.309 -111.663)" fill="#fff"/>\n      <path id="Path_989" data-name="Path 989" d="M59.364,64.6h4.285a.488.488,0,0,0,.478-.478.478.478,0,0,0-.478-.478H59.364a.468.468,0,0,0-.478.458q0,.01,0,.02A.478.478,0,0,0,59.364,64.6Z" transform="translate(-51.443 -55.678)" fill="#fff"/>\n    </g>\n  </g>\n</svg>\n',finish:'<svg id="finish" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24" viewBox="0 0 24 24">\n  <defs>\n    <clipPath id="finishclip-path">\n      <rect id="Rectangle_2775" data-name="Rectangle 2775" width="24" height="24" fill="currentColor"/>\n    </clipPath>\n  </defs>\n  <g id="Group_584" data-name="Group 584" clip-path="url(#finishclip-path)">\n    <path id="Path_1526" data-name="Path 1526" d="M17.6,6.7l-6.691,9.081L6.313,12.11a.5.5,0,0,0-.625.781l5,4a.508.508,0,0,0,.378.1.493.493,0,0,0,.337-.2l7-9.5A.5.5,0,1,0,17.6,6.7" fill="currentColor"/>\n    <path id="Path_1527" data-name="Path 1527" d="M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0m0,23A11,11,0,1,1,23,12,11.013,11.013,0,0,1,12,23" fill="currentColor"/>\n  </g>\n</svg>\n',upload:'<svg id="Layer_2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">\n  <defs>\n    <style>\n      .cls-1 {\n        fill: #fff;\n        stroke-width: 0px;\n      }\n    </style>\n  </defs>\n  <g id="Layer_1-2">\n    <path class="cls-1"\n      d="m17.05,14.93c-.27,0-.48.22-.48.5v5.95l-2.97-6.18c-.1-.21-.32-.32-.54-.26-.22.05-.37.25-.37.49v8.07c0,.28.21.5.48.5s.48-.22.48-.5v-5.95l2.97,6.18c.08.17.25.28.43.28.04,0,.07,0,.11-.01.22-.05.37-.25.37-.49v-8.07c0-.28-.21-.5-.48-.5Z" />\n    <path class="cls-1"\n      d="m8.64,14.93h-1.94c-.27,0-.48.22-.48.5v8.07c0,.28.21.5.48.5s.48-.22.48-.5v-3.53h1.46c1.34,0,2.42-1.13,2.42-2.52s-1.09-2.52-2.42-2.52Zm0,4.03h-1.46v-3.04h1.46c.81,0,1.46.68,1.46,1.52s-.66,1.52-1.46,1.52Z" />\n    <path class="cls-1"\n      d="m23.52,18.62c.27,0,.48-.22.48-.5v-.67c0-1.39-1.09-2.52-2.42-2.52s-2.42,1.13-2.42,2.52v4.03c0,1.39,1.09,2.52,2.42,2.52s2.42-1.13,2.42-2.52v-.67c0-.28-.21-.5-.48-.5h-1.29c-.27,0-.48.22-.48.5s.21.5.48.5h.81v.17c0,.84-.65,1.52-1.46,1.52s-1.46-.68-1.46-1.52v-4.03c0-.84.65-1.52,1.46-1.52s1.46.68,1.46,1.52v.67c0,.28.21.5.48.5Z" />\n    <path class="cls-1"\n      d="m3.65,22.96H1.58c-.27,0-.49-.21-.49-.48V1.52c0-.26.22-.48.49-.48h12.45c.16,0,.31.03.47.05v3.42c0,.84.71,1.52,1.58,1.52h3.55c.01.15.05.3.05.45v6.01c0,.29.24.52.54.52s.54-.23.54-.52v-6.01c0-.33-.03-.65-.08-.97,0,0,0,0,0,0,0,0,0-.02,0-.02-.45-2.77-2.72-4.97-5.6-5.4-.01,0-.02,0-.03,0,0,0,0,0,0,0-.33-.05-.66-.08-1-.08H1.58C.71,0,0,.68,0,1.52v20.96c0,.84.71,1.52,1.58,1.52h2.07c.3,0,.54-.23.54-.52s-.24-.52-.54-.52ZM15.58,1.28c1.86.52,3.31,1.92,3.85,3.71h-3.36c-.27,0-.49-.21-.49-.48V1.28Z" />\n    <path class="cls-1" transform="scale(1, -1) translate(0, -14)"\n      d="m10.32,7.11l-1.65,1.53v-4.58c0-.3-.26-.55-.59-.55s-.59.25-.59.55v4.58l-1.65-1.53c-.23-.21-.6-.21-.84,0s-.23.56,0,.78l2.66,2.47c.05.05.12.09.19.12.07.03.15.04.23.04s.15-.01.23-.04c.07-.03.14-.07.19-.12l2.66-2.47c.23-.21.23-.56,0-.78-.23-.21-.6-.21-.84,0Z" />\n  </g>\n</svg>\n',share:'\n<svg id="sharePng" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">\n  <defs>\n    <style>\n      .cls-1 {\n        fill: #fff;\n        stroke-width: 0px;\n      }\n    </style>\n  </defs>\n  <g id="sharePng">\n    <path class="cls-1"\n      d="m17.05,14.93c-.27,0-.48.22-.48.5v5.95l-2.97-6.18c-.1-.21-.32-.32-.54-.26-.22.05-.37.25-.37.49v8.07c0,.28.21.5.48.5s.48-.22.48-.5v-5.95l2.97,6.18c.08.17.25.28.43.28.04,0,.07,0,.11-.01.22-.05.37-.25.37-.49v-8.07c0-.28-.21-.5-.48-.5Z" />\n    <path class="cls-1"\n      d="m8.64,14.93h-1.94c-.27,0-.48.22-.48.5v8.07c0,.28.21.5.48.5s.48-.22.48-.5v-3.53h1.46c1.34,0,2.42-1.13,2.42-2.52s-1.09-2.52-2.42-2.52Zm0,4.03h-1.46v-3.04h1.46c.81,0,1.46.68,1.46,1.52s-.66,1.52-1.46,1.52Z" />\n    <path class="cls-1"\n      d="m23.52,18.62c.27,0,.48-.22.48-.5v-.67c0-1.39-1.09-2.52-2.42-2.52s-2.42,1.13-2.42,2.52v4.03c0,1.39,1.09,2.52,2.42,2.52s2.42-1.13,2.42-2.52v-.67c0-.28-.21-.5-.48-.5h-1.29c-.27,0-.48.22-.48.5s.21.5.48.5h.81v.17c0,.84-.65,1.52-1.46,1.52s-1.46-.68-1.46-1.52v-4.03c0-.84.65-1.52,1.46-1.52s1.46.68,1.46,1.52v.67c0,.28.21.5.48.5Z" />\n    <path class="cls-1"\n      d="m3.65,22.96H1.58c-.27,0-.49-.21-.49-.48V1.52c0-.26.22-.48.49-.48h12.45c.16,0,.31.03.47.05v3.42c0,.84.71,1.52,1.58,1.52h3.55c.01.15.05.3.05.45v6.01c0,.29.24.52.54.52s.54-.23.54-.52v-6.01c0-.33-.03-.65-.08-.97,0,0,0,0,0,0,0,0,0-.02,0-.02-.45-2.77-2.72-4.97-5.6-5.4-.01,0-.02,0-.03,0,0,0,0,0,0,0-.33-.05-.66-.08-1-.08H1.58C.71,0,0,.68,0,1.52v20.96c0,.84.71,1.52,1.58,1.52h2.07c.3,0,.54-.23.54-.52s-.24-.52-.54-.52ZM15.58,1.28c1.86.52,3.31,1.92,3.85,3.71h-3.36c-.27,0-.49-.21-.49-.48V1.28Z" />\n    <path transform="scale(0.4, -0.4) translate(8, -30)" stroke="#fff" fill="#fff" stroke-width="1px" d="M19.489,15.009h0c-.008,0-.014,0-.022,0a4.465,4.465,0,0,0-3.749,2.052l-7-3.5a4.482,4.482,0,0,0,0-3.1l7-3.5a4.466,4.466,0,0,0,3.771,2.053l.018,0A4.516,4.516,0,1,0,15.282,6.06L8.257,9.574a4.49,4.49,0,1,0-4.793,6.814,4.548,4.548,0,0,0,1.043.122,4.468,4.468,0,0,0,3.755-2.056l7.018,3.511a4.485,4.485,0,1,0,4.209-2.956M17.13,1.914a3.508,3.508,0,1,1,2.366,6.1h-.01l-.011,0a3.476,3.476,0,0,1-3.112-1.932l0-.006a3.525,3.525,0,0,1,.769-4.162M3.693,15.415a3.5,3.5,0,1,1,3.931-4.967v0a3.47,3.47,0,0,1,0,3.119l0,0a3.479,3.479,0,0,1-3.931,1.842m17.636,7.066a3.5,3.5,0,0,1-4.971-4.53l0,0a3.477,3.477,0,0,1,3.126-1.936l.011,0a3.5,3.5,0,0,1,1.831,6.472" />\n  </g>\n</svg>\n',normalize:'<svg id="normalize" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="19" height="24" viewBox="0 0 19 24">\n<defs>\n  <clipPath id="normalizeclip-path">\n    <rect id="Rectangle_2772" data-name="Rectangle 2772" width="19" height="24" fill="#fff"/>\n  </clipPath>\n</defs>\n<g id="Group_578" data-name="Group 578" clip-path="url(#normalizeclip-path)">\n  <path id="Path_1510" data-name="Path 1510" d="M3.483,18.987a.521.521,0,0,0,.52.522H14.9a.522.522,0,0,0,0-1.044H4a.521.521,0,0,0-.52.522" fill="#fff"/>\n  <path id="Path_1511" data-name="Path 1511" d="M4,13.52h8.75a.522.522,0,0,0,0-1.043H4A.522.522,0,0,0,4,13.52" fill="#fff"/>\n  <path id="Path_1512" data-name="Path 1512" d="M4,10.526h7.448a.522.522,0,0,0,0-1.043H4a.522.522,0,0,0,0,1.043" fill="#fff"/>\n  <path id="Path_1513" data-name="Path 1513" d="M4,7.532H9.927a.522.522,0,0,0,0-1.043H4A.522.522,0,0,0,4,7.532" fill="#fff"/>\n  <path id="Path_1514" data-name="Path 1514" d="M4.005,15.471H4a.522.522,0,0,0,0,1.043l9.79.039h0a.522.522,0,0,0,0-1.043Z" fill="#fff"/>\n  <path id="Path_1515" data-name="Path 1515" d="M9.33,1.044H11.5A.522.522,0,0,0,11.5,0H9.33a.522.522,0,0,0,0,1.043" fill="#fff"/>\n  <path id="Path_1516" data-name="Path 1516" d="M13.679,1.044h2.174a.522.522,0,0,0,0-1.043H13.679a.522.522,0,0,0,0,1.043" fill="#fff"/>\n  <path id="Path_1517" data-name="Path 1517" d="M18.48,17.548a.516.516,0,0,0-.367.152c-.572-3.035-1.506-7.61-3.012-14.546a.524.524,0,0,0-.139-.256,1.432,1.432,0,0,0-.972-.437L6.806,1.044h.349A.522.522,0,0,0,7.155,0H4.981A.522.522,0,0,0,4.46.522a.426.426,0,0,0,.013.062L3.291.351A.516.516,0,0,0,2.805,0H1.765a.515.515,0,0,0-.124.025L1.515,0A1.52,1.52,0,0,0,0,1.52V22.481A1.519,1.519,0,0,0,1.515,24H18.432a.142.142,0,0,0,.022,0,.238.238,0,0,0,.026,0,.52.52,0,0,0,.52-.521V22.435a.522.522,0,0,0-.152-.369c-.047-.358-.111-.8-.2-1.329A.516.516,0,0,0,19,20.25V18.069a.519.519,0,0,0-.52-.521M1.515,22.957a.475.475,0,0,1-.474-.476V1.52a.491.491,0,0,1,.373-.486L13.89,3.495a.468.468,0,0,1,.233.061c1.449,6.682,3.613,17.143,3.823,19.4Z" fill="#fff"/>\n  <path id="Path_1518" data-name="Path 1518" d="M18.48,4.461a.52.52,0,0,0-.52.522v2.18a.52.52,0,1,0,1.04,0V4.983a.52.52,0,0,0-.52-.522" fill="#fff"/>\n  <path id="Path_1519" data-name="Path 1519" d="M18.29.366a.521.521,0,0,0-.638.824.827.827,0,0,1,.308.653V2.8A.52.52,0,1,0,19,2.8V1.843A1.877,1.877,0,0,0,18.29.366" fill="#fff"/>\n  <path id="Path_1520" data-name="Path 1520" d="M18.48,13.185a.52.52,0,0,0-.52.522v2.181a.52.52,0,1,0,1.04,0V13.707a.52.52,0,0,0-.52-.522" fill="#fff"/>\n  <path id="Path_1521" data-name="Path 1521" d="M18.48,8.823a.52.52,0,0,0-.52.522v2.181a.52.52,0,1,0,1.04,0V9.345a.52.52,0,0,0-.52-.522" fill="#fff"/>\n</g>\n</svg>\n',retake:'<svg id="re-take" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="28.761" height="23" viewBox="0 0 28.761 23">\n<defs>\n<clipPath id="retakeclip-path">\n  <rect id="Rectangle_2773" data-name="Rectangle 2773" width="28.761" height="23" fill="#fff"/>\n</clipPath>\n</defs>\n<g id="Group_580" data-name="Group 580" clip-path="url(#retakeclip-path)">\n<path id="Path_1522" data-name="Path 1522" d="M25.877,3.639H21.663a.7.7,0,0,1-.575-.288l-.575-.764C19.264.961,18.59,0,17.44,0H11.4C10.151,0,9.486.961,8.336,2.588l-.674.764a.7.7,0,0,1-.575.288H2.875C.476,3.639,0,5.077,0,6.227v13.9C0,22.041,1.051,23,2.974,23H25.787c1.914,0,2.974-.961,2.974-2.776v-14c-.008-1.147-.485-2.585-2.884-2.585m-.1,18.411H2.974c-1.339,0-2.013-.575-2.013-1.824v-14c0-.863.189-1.626,1.914-1.626H7.188a1.666,1.666,0,0,0,1.339-.674L9.1,3.162c1.15-1.626,1.536-2.2,2.2-2.2H17.34c.674,0,1.15.575,2.3,2.2l.575.764a1.562,1.562,0,0,0,1.339.674h4.313c1.725,0,1.914.764,1.914,1.626v14h.009c0,1.249-.673,1.824-2.012,1.824" fill="#fff"/>\n<path id="Path_1523" data-name="Path 1523" d="M15.978,9.16H9.462l1.745-1.743A.5.5,0,0,0,10.5,6.71l-2.6,2.6a.484.484,0,0,0-.108.162.5.5,0,0,0,0,.382.479.479,0,0,0,.108.163l2.6,2.6a.5.5,0,0,0,.708-.708L9.462,10.16h6.516a4.028,4.028,0,0,1,0,8.055H10.255a.5.5,0,1,0,0,1h5.723a5.028,5.028,0,0,0,0-10.055" fill="#fff"/>\n</g>\n</svg>\n',complete:'\n<svg id="continue" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24" viewBox="0 0 24 24">\n<defs>\n<clipPath id="continueclip-path">\n  <rect id="Rectangle_2774" data-name="Rectangle 2774" width="24" height="24" fill="currentColor"/>\n</clipPath>\n</defs>\n<g id="Group_582" data-name="Group 582" clip-path="url(#continueclip-path)">\n<path id="Path_1524" data-name="Path 1524" d="M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0m0,23A11,11,0,1,1,23,12,11.013,11.013,0,0,1,12,23" fill="currentColor"/>\n<path id="Path_1525" data-name="Path 1525" d="M19.862,12a.17.17,0,0,0,0-.024.512.512,0,0,0-.033-.168.532.532,0,0,0-.113-.17l-4.219-4.29a.5.5,0,0,0-.714,0,.51.51,0,0,0,0,.719l3.371,3.428H4.643a.509.509,0,0,0,0,1.018h13.5l-3.373,3.428a.512.512,0,0,0,0,.72.5.5,0,0,0,.714,0l4.224-4.295a.438.438,0,0,0,.056-.086.5.5,0,0,0,.051-.078A.521.521,0,0,0,19.862,12h0" fill="currentColor"/>\n</g>\n</svg>\n',downloadPNG:'\n<svg id="Layer_2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">\n<defs>\n<style>\n  .cls-1 {\n    fill: #fff;\n    stroke-width: 0px;\n  }\n</style>\n</defs>\n<g id="Layer_1-2">\n<path class="cls-1"\n  d="m17.05,14.93c-.27,0-.48.22-.48.5v5.95l-2.97-6.18c-.1-.21-.32-.32-.54-.26-.22.05-.37.25-.37.49v8.07c0,.28.21.5.48.5s.48-.22.48-.5v-5.95l2.97,6.18c.08.17.25.28.43.28.04,0,.07,0,.11-.01.22-.05.37-.25.37-.49v-8.07c0-.28-.21-.5-.48-.5Z" />\n<path class="cls-1"\n  d="m8.64,14.93h-1.94c-.27,0-.48.22-.48.5v8.07c0,.28.21.5.48.5s.48-.22.48-.5v-3.53h1.46c1.34,0,2.42-1.13,2.42-2.52s-1.09-2.52-2.42-2.52Zm0,4.03h-1.46v-3.04h1.46c.81,0,1.46.68,1.46,1.52s-.66,1.52-1.46,1.52Z" />\n<path class="cls-1"\n  d="m23.52,18.62c.27,0,.48-.22.48-.5v-.67c0-1.39-1.09-2.52-2.42-2.52s-2.42,1.13-2.42,2.52v4.03c0,1.39,1.09,2.52,2.42,2.52s2.42-1.13,2.42-2.52v-.67c0-.28-.21-.5-.48-.5h-1.29c-.27,0-.48.22-.48.5s.21.5.48.5h.81v.17c0,.84-.65,1.52-1.46,1.52s-1.46-.68-1.46-1.52v-4.03c0-.84.65-1.52,1.46-1.52s1.46.68,1.46,1.52v.67c0,.28.21.5.48.5Z" />\n<path class="cls-1"\n  d="m3.65,22.96H1.58c-.27,0-.49-.21-.49-.48V1.52c0-.26.22-.48.49-.48h12.45c.16,0,.31.03.47.05v3.42c0,.84.71,1.52,1.58,1.52h3.55c.01.15.05.3.05.45v6.01c0,.29.24.52.54.52s.54-.23.54-.52v-6.01c0-.33-.03-.65-.08-.97,0,0,0,0,0,0,0,0,0-.02,0-.02-.45-2.77-2.72-4.97-5.6-5.4-.01,0-.02,0-.03,0,0,0,0,0,0,0-.33-.05-.66-.08-1-.08H1.58C.71,0,0,.68,0,1.52v20.96c0,.84.71,1.52,1.58,1.52h2.07c.3,0,.54-.23.54-.52s-.24-.52-.54-.52ZM15.58,1.28c1.86.52,3.31,1.92,3.85,3.71h-3.36c-.27,0-.49-.21-.49-.48V1.28Z" />\n<path class="cls-1"\n  d="m10.32,7.11l-1.65,1.53v-4.58c0-.3-.26-.55-.59-.55s-.59.25-.59.55v4.58l-1.65-1.53c-.23-.21-.6-.21-.84,0s-.23.56,0,.78l2.66,2.47c.05.05.12.09.19.12.07.03.15.04.23.04s.15-.01.23-.04c.07-.03.14-.07.19-.12l2.66-2.47c.23-.21.23-.56,0-.78-.23-.21-.6-.21-.84,0Z" />\n</g>\n</svg>\n',failed:'\n  <svg\n  xmlns="http://www.w3.org/2000/svg"\n  width="20"\n  height="20"\n  viewBox="0 0 20 20"\n  fill="none"\n  stroke="#ef4444"\n  stroke-width="2"\n  stroke-linecap="round"\n  stroke-linejoin="round"\n>\n  <path d="M18 6l-12 12" />\n  <path d="M6 6l12 12" />\n</svg>\n',info:'\n<svg\n  xmlns="http://www.w3.org/2000/svg"\n  width="24"\n  height="24"\n  viewBox="0 0 24 24"\n  fill="none"\n  stroke="white"\n  stroke-width="2"\n  stroke-linecap="round"\n  stroke-linejoin="round"\n>\n  <path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0" />\n  <path d="M12 9h.01" />\n  <path d="M11 12h1v4h1" />\n</svg>\n',cancel:'\n  <svg\n  xmlns="http://www.w3.org/2000/svg"\n  width="20"\n  height="20"\n  viewBox="0 0 20 20"\n  fill="none"\n  stroke="white"\n  stroke-width="2"\n  stroke-linecap="round"\n  stroke-linejoin="round"\n>\n  <path d="M18 6l-12 12" />\n  <path d="M6 6l12 12" />\n</svg>\n\n'};var g,f,v;!function(e){e.Image="image",e.Barcode="barcode"}(g||(g={})),e.EnumDriverLicenseScanSide=void 0,(f=e.EnumDriverLicenseScanSide||(e.EnumDriverLicenseScanSide={})).Front="frontSide",f.Back="backSide",function(e){e.Scanner="scanner",e.Result="scan-result",e.Verify="scan-verify",e.Correction="correction"}(v||(v={}));const p="DL_detect",w="DL_normalize",C="DL_barcode";var S,y;function E(e,t){try{return e.getFieldValue(t)||void 0}catch(e){return void console.warn(`Failed to get field value for ${t}:`,e)}}function D(e,i){try{return e.getFieldValidationStatus(i)===t.EnumValidationStatus.VS_FAILED}catch(e){return!1}}function R(e,t,i,n,a){if(!e)return{year:void 0,month:void 0,day:void 0};try{const s=function(e,t,i){if(!(null==e?void 0:e.trim()))return{year:void 0,month:void 0,day:void 0};let n,a,s;try{if(i){if(4===e.length){const t=parseInt(e.slice(0,2),10),i=parseInt(e.slice(2,4),10);t<=99&&i>=1&&i<=12?(n=t>50?1900+t:2e3+t,a=i,console.log(`Parsed as YYMM: ${e} -> ${n}-${a}`)):t>=1&&t<=12&&i<=99&&(a=t,n=i>50?1900+i:2e3+i,console.log(`Parsed as MMYY: ${e} -> ${n}-${a}`))}else if(6===e.length){const t=parseInt(e.slice(0,2),10),i=parseInt(e.slice(2,4),10),o=parseInt(e.slice(4,6),10);t<=99&&i>=1&&i<=12&&o>=1&&o<=31?(n=t>50?1900+t:2e3+t,a=i,s=o,console.log(`Parsed as YYMMDD: ${e} -> ${n}-${a}-${s}`)):t>=1&&t<=12&&i>=1&&i<=31&&o<=99&&(a=t,s=i,n=o>50?1900+o:2e3+o,console.log(`Parsed as MMDDYY: ${e} -> ${n}-${a}-${s}`))}else if(8===e.length){const t=parseInt(e.slice(0,4),10),i=parseInt(e.slice(4,6),10),o=parseInt(e.slice(6,8),10);if(t>=1900&&t<=2100&&i>=1&&i<=12&&o>=1&&o<=31)n=t,a=i,s=o,console.log(`Parsed as YYYYMMDD: ${e} -> ${n}-${a}-${s}`);else{const o=parseInt(e.slice(4,8),10);t>=1&&t<=12&&i>=1&&i<=31&&o>=1900&&o<=2100&&(a=t,s=i,n=o,console.log(`Parsed as MMDDYYYY: ${e} -> ${n}-${a}-${s}`))}}else if(2===e.length){const t=parseInt(e,10);t<=99&&(t>12?(n=t>50?1900+t:2e3+t,console.log(`Parsed as YY: ${e} -> ${n}`)):(n=t>50?1900+t:2e3+t,console.log(`Parsed as YY (ambiguous): ${e} -> ${n}`)))}n||a||s||(console.log(`Magstripe parsing failed for: ${e}, falling back to standard parsing`),i=!1)}if(!i){if("USA"===t)e.length>=2&&(a=parseInt(e.slice(0,2),10)),e.length>=4&&(s=parseInt(e.slice(2,4),10)),e.length>=6&&(n=parseInt(e.slice(4),10),n<100&&(n=n>50?1900+n:2e3+n));else if(e.length>=4&&(n=parseInt(e.slice(0,4),10)),e.length>=6&&(a=parseInt(e.slice(4,6),10)),e.length>=8&&(s=parseInt(e.slice(6,8),10)),e.includes("-")||e.includes("/")){const t=e.split(/[-\/]/);t.length>=1&&4===t[0].length&&(n=parseInt(t[0],10)),t.length>=2&&(a=parseInt(t[1],10)),t.length>=3&&(s=parseInt(t[2],10))}return void 0!==n&&(n<1900||n>2100)&&(n=void 0),void 0!==a&&(a<1||a>12)&&(a=void 0),void 0!==s&&(s<1||s>31)&&(s=void 0),{year:n,month:a,day:s}}}catch(e){return{year:void 0,month:void 0,day:void 0}}}(e,t,a);return s.year||s.month||s.day?s:(i&&n&&i.push(n),{year:void 0,month:void 0,day:void 0})}catch(e){return console.warn(`Failed to parse date field ${n}:`,e),i&&n&&i.push(n),{year:void 0,month:void 0,day:void 0}}}function b(e,t,i,n,a,s){if(t||i||n){const e=function(e,t,i){if(!e&&!t&&!i)return;const n=e?parseInt(e,10):void 0,a=t?parseInt(t,10):void 0,s=i?parseInt(i,10):void 0;let o=n;n&&n<100&&(o=n>50?1900+n:2e3+n);return{year:o,month:a,day:s}}(t,i,n);if(e&&(e.year||e.month||e.day))return e}if(null==e?void 0:e.trim()){const t=R(e,"USA",a,s,!0);if(t&&(t.year||t.month||t.day))return t;const i=R(e,"USA",a,s,!1);if(i&&(i.year||i.month||i.day))return i;const n=R(e,void 0,a,s,!1);if(n&&(n.year||n.month||n.day))return n}return{year:void 0,month:void 0,day:void 0}}function I(e){if(!e.year)return 0;const t=new Date,i=t.getFullYear(),n=t.getMonth()+1,a=t.getDate();let s=i-e.year;return e.month&&(n<e.month?s--:n===e.month&&e.day?a<e.day&&s--:n!==e.month||e.day||s--),Math.max(s,0)}function V(e){if(!e)return!1;const t=e.year&&e.year>=1900&&e.year<=2100,i=e.month&&e.month>=1&&e.month<=12,n=e.day&&e.day>=1&&e.day<=31;return!!(t||i||n)}function L(...e){return e.filter(Boolean).join(" ")||"N/A"}function N(...e){return e.filter(Boolean).join(", ")||"N/A"}function x(){return{status:{code:e.EnumResultStatus.RS_SUCCESS,message:"Success"}}}function A(e){const t=[],i=E(e,"AAMVAVersionNumber"),n=E(e,"issuerIdentificationNumber"),a=E(e,"jurisdictionVersionNumber"),s=E(e,"licenseNumber"),o=E(e,"issuingCountry")||E(e,"issuingState"),r=E(e,"documentDiscriminator"),c=E(e,"complianceType"),l=E(e,"firstName")||E(e,"givenName"),d=E(e,"lastName")||E(e,"familyName"),u=E(e,"middleName")||E(e,"middleInitial"),h=E(e,"fullName"),m=E(e,"prefix")||E(e,"namePrefix"),g=E(e,"suffix")||E(e,"nameSuffix"),f=E(e,"sex")||E(e,"gender"),v=E(e,"nameAlias"),p=E(e,"firstNameAlias")||E(e,"givenNameAlias"),w=E(e,"lastNameAlias"),C=E(e,"middleNameAlias"),b=E(e,"prefixAlias"),A=E(e,"suffixAlias"),P=E(e,"alternativeBirthDate"),k=E(e,"alternativeSocialSecurityNumber"),_=E(e,"birthDate")||E(e,"dateOfBirth"),M=E(e,"expirationDate")||E(e,"expiryDate"),T=E(e,"issuedDate")||E(e,"issueDate"),F=E(e,"issueTimestamp"),O=E(e,"cardRevisionDate"),B=E(e,"hazmatEndorsementExpirationDate"),z=E(e,"under18Until"),H=E(e,"under19Until"),U=E(e,"under21Until"),j=R(_,o,t,S.DateOfBirth,!1),$=R(M,o,t,S.ExpiryDate,!1),q=R(T,o,t,S.IssueDate,!1),G=R(P,o),W=R(O,o),Z=R(B,o),Y=R(z,o),Q=R(H,o),K=R(U,o),J=E(e,"height"),X=E(e,"heightInCentimeters"),ee=E(e,"weight"),te=E(e,"weightInKilograms"),ie=E(e,"weightInPounds"),ne=E(e,"weightRange"),ae=E(e,"eyeColor"),se=E(e,"hairColor"),oe=E(e,"race"),re=E(e,"street_1")||E(e,"addressLine1"),ce=E(e,"street_2")||E(e,"addressLine2"),le=E(e,"city"),de=E(e,"jurisdictionCode")||E(e,"stateOrProvince"),ue=E(e,"postalCode")||E(e,"zipCode"),he=E(e,"residenceStreet_1"),me=E(e,"residenceStreet_2"),ge=E(e,"residenceCity"),fe=E(e,"residenceJurisdictionCode"),ve=E(e,"residencePostalCode"),pe=E(e,"vehicleClass"),we=E(e,"standardVehicleClassification"),Ce=E(e,"vehicleCodeDescription"),Se=E(e,"restrictionCode"),ye=E(e,"standardRestrictionCode"),Ee=E(e,"restrictionCodeDescription"),De=E(e,"endorsementsCode"),Re=E(e,"standardEndorsementsCode"),be=E(e,"endorsementsCodeDescription"),Ie=E(e,"permitClassificationCode"),Ve=E(e,"permitIdentifier"),Le=E(e,"permitExpirationDate"),Ne=E(e,"permitIssuedDate"),xe=E(e,"permitRestrictionCode"),Ae=E(e,"permitEndorsementCode"),Pe=R(Le,o),ke=R(Ne,o),_e=E(e,"customerIdentifier"),Me=E(e,"socialSecurityNumber"),Te=E(e,"inventoryControlNumber"),Fe=E(e,"numberOfDuplicates"),Oe=E(e,"medicalIndicator"),Be=E(e,"organDonorIndicator"),ze=E(e,"nonResidentIndicator"),He=E(e,"veteranIndicator"),Ue=E(e,"limitedDurationDocumentIndicator"),je=E(e,"federalCommercialVehicleCodes"),$e=E(e,"familyNameTruncation"),qe=E(e,"firstNameTruncation"),Ge=E(e,"middleNameTruncation"),We=E(e,"birthPlace"),Ze=E(e,"auditInfomation")||E(e,"auditInformation"),Ye=E(e,"jurisdictionSubfiles"),Qe=j&&V(j)?I(j):0,Ke={[S.LicenseNumber]:["licenseNumber"],[S.FirstName]:["firstName","givenName"],[S.LastName]:["lastName","familyName"],[S.Sex]:["sex","gender"]};return Object.entries(Ke).forEach((([i,n])=>{n.some((t=>D(e,t)))&&t.push(i)})),Object.assign(Object.assign({},x()),{[S.InvalidFields]:t,[S.LicenseType]:y.AAMVA_DL_ID,[S.LicenseNumber]:s||"N/A",[S.AAMVAVersionNumber]:i,[S.IssuerIdentificationNumber]:n,[S.JurisdictionVersionNumber]:a,[S.DocumentDiscriminator]:r,[S.IssuingCountry]:o,[S.ComplianceType]:c,[S.FullName]:h||L(m,l,u,d,g),[S.FirstName]:l||"",[S.LastName]:d||"",[S.MiddleName]:u,[S.NamePrefix]:m,[S.NameSuffix]:g,[S.DateOfBirth]:j,[S.Age]:Qe,[S.Sex]:f||"N/A",[S.NameAlias]:v,[S.FirstNameAlias]:p,[S.LastNameAlias]:w,[S.MiddleNameAlias]:C,[S.PrefixAlias]:b,[S.SuffixAlias]:A,[S.AlternativeBirthDate]:G,[S.AlternativeSocialSecurityNumber]:k,[S.Height]:J,[S.HeightInCentimeters]:X,[S.Weight]:ee,[S.WeightInKilograms]:te,[S.WeightInPounds]:ie,[S.WeightRange]:ne,[S.EyeColor]:ae,[S.HairColor]:se,[S.Race]:oe,[S.Address]:N(re,ce,le,de,ue),[S.Street1]:re,[S.Street2]:ce,[S.City]:le,[S.State]:de,[S.PostalCode]:ue,[S.ResidenceStreet1]:he,[S.ResidenceStreet2]:me,[S.ResidenceCity]:ge,[S.ResidenceState]:fe,[S.ResidencePostalCode]:ve,[S.ExpiryDate]:$,[S.IssueDate]:q,[S.IssueTimestamp]:F,[S.CardRevisionDate]:W,[S.HazmatEndorsementExpiryDate]:Z,[S.Under18Until]:Y,[S.Under19Until]:Q,[S.Under21Until]:K,[S.VehicleClass]:pe||we,[S.StandardVehicleClassification]:we,[S.VehicleCodeDescription]:Ce,[S.Restrictions]:Se,[S.RestrictionsCode]:Se,[S.StandardRestrictionCode]:ye,[S.RestrictionCodeDescription]:Ee,[S.Endorsements]:De,[S.EndorsementsCode]:De,[S.StandardEndorsementsCode]:Re,[S.EndorsementsCodeDescription]:be,[S.PermitClassificationCode]:Ie,[S.PermitIdentifier]:Ve,[S.PermitExpirationDate]:Pe,[S.PermitIssuedDate]:ke,[S.PermitRestrictionCode]:xe,[S.PermitEndorsementCode]:Ae,[S.CustomerIdentifier]:_e,[S.SocialSecurityNumber]:Me,[S.InventoryControlNumber]:Te,[S.NumberOfDuplicates]:Fe,[S.MedicalIndicator]:Oe,[S.OrganDonorIndicator]:Be,[S.NonResidentIndicator]:ze,[S.VeteranIndicator]:He,[S.LimitedDurationDocumentIndicator]:Ue,[S.FederalCommercialVehicleCodes]:je,[S.FamilyNameTruncation]:$e,[S.FirstNameTruncation]:qe,[S.MiddleNameTruncation]:Ge,[S.BirthPlace]:We,[S.AuditInformation]:Ze,[S.JurisdictionSubfiles]:Ye})}function P(t){if(!t)return console.error("No parsed result provided"),null;try{const e=t.codeType;switch(e){case y.AAMVA_DL_ID:return A(t);case y.AAMVA_DL_ID_WITH_MAG_STRIPE:return function(e){const t=[],i=E(e,"DLorID_Number")||E(e,"licenseNumber"),n=E(e,"documentDiscriminator"),a=E(e,"name"),s=E(e,"sex")||E(e,"gender"),o=E(e,"birthDate"),r=E(e,"birthYear"),c=E(e,"birthMonth"),l=E(e,"birthDay"),d=E(e,"expirationDate"),u=E(e,"expirationYear"),h=E(e,"expirationMonth"),m=E(e,"height"),g=E(e,"weight"),f=E(e,"eyeColor"),v=E(e,"hairColor"),p=E(e,"address"),w=E(e,"city"),C=E(e,"stateOrProvince"),R=E(e,"postalCode"),L=E(e,"issuingCountry")||E(e,"issuingState"),N=E(e,"class"),A=E(e,"restrictions"),P=E(e,"endorsements"),k=E(e,"track1"),_=E(e,"track2"),M=E(e,"track3"),T=E(e,"LRCforTrack1"),F=E(e,"LRCforTrack2"),O=E(e,"LRCforTrack3"),B=E(e,"ISOIIN"),z=E(e,"DLorID_NumberOverflow"),H=E(e,"magStripeVersion");E(e,"jurisdictionVersion");const U=E(e,"discretionaryData1"),j=E(e,"discretionaryData2"),$=E(e,"securityFunction"),q=b(o,r,c,l,t,S.DateOfBirth),G=b(d,u,h,void 0,t,S.ExpiryDate);let W=w,Z=C;if(!W&&p){const e=p.split(",").map((e=>e.trim()));e.length>=2&&(W=e[e.length-2],Z=e[e.length-1])}const Y=q&&V(q)?I(q):0,Q={[S.LicenseNumber]:["DLorID_Number","licenseNumber"],[S.FullName]:["name"],[S.Sex]:["sex","gender"]};return Object.entries(Q).forEach((([i,n])=>{n.some((t=>D(e,t)))&&t.push(i)})),Object.assign(Object.assign({},x()),{[S.InvalidFields]:t,[S.LicenseType]:y.AAMVA_DL_ID_WITH_MAG_STRIPE,[S.LicenseNumber]:i||"N/A",[S.FullName]:a||"N/A",[S.FirstName]:"",[S.LastName]:"",[S.MiddleName]:void 0,[S.DateOfBirth]:q,[S.ExpiryDate]:G,[S.IssueDate]:void 0,[S.Age]:Y,[S.Sex]:s||"N/A",[S.Height]:m,[S.Weight]:g,[S.EyeColor]:f,[S.HairColor]:v,[S.Address]:p||"N/A",[S.City]:W,[S.State]:Z,[S.PostalCode]:R,[S.VehicleClass]:N,[S.Restrictions]:A,[S.Endorsements]:P,[S.IssuingCountry]:L,[S.DocumentDiscriminator]:n,[S.Track1]:k,[S.Track2]:_,[S.Track3]:M,[S.LRCforTrack1]:T,[S.LRCforTrack2]:F,[S.LRCforTrack3]:O,[S.ISOIIN]:B,[S.DLorID_NumberOverflow]:z,[S.MagStripeVersion]:H,[S.DiscretionaryData1]:U,[S.DiscretionaryData2]:j,[S.SecurityFunction]:$})}(t);case y.SOUTH_AFRICA_DL:return function(e){const t=[],i=E(e,"licenseNumber"),n=E(e,"licenseIssuedCountry")||"ZA",a=E(e,"idNumber"),s=E(e,"idNumberType"),o=E(e,"idIssuedCountry"),r=E(e,"licenseIssuedCountry"),c=E(e,"licenseIssueNumber"),l=E(e,"surname"),d=E(e,"initials"),u=E(e,"gender"),h=E(e,"birthDate"),m=E(e,"licenseValidityFrom"),g=E(e,"licenseValidityTo"),f=E(e,"professionalDrivingPermitExpiryDate"),v=R(h,n,t,S.DateOfBirth),p=R(m,n),w=R(g,n),C=R(f,n),b=E(e,"vehicleCode_1")||E(e,"vehicleCode1"),N=E(e,"vehicleCode_2")||E(e,"vehicleCode2"),A=E(e,"vehicleCode_3")||E(e,"vehicleCode3"),P=E(e,"vehicleCode_4")||E(e,"vehicleCode4"),k=E(e,"vehicleRestriction_1")||E(e,"vehicleRestriction1"),_=E(e,"vehicleRestriction_2")||E(e,"vehicleRestriction2"),M=E(e,"vehicleRestriction_3")||E(e,"vehicleRestriction3"),T=E(e,"vehicleRestriction_4")||E(e,"vehicleRestriction4"),F=E(e,"licenseCodeIssuedDate_1")||E(e,"licenseCodeIssuedDate1"),O=E(e,"licenseCodeIssuedDate_2")||E(e,"licenseCodeIssuedDate2"),B=E(e,"licenseCodeIssuedDate_3")||E(e,"licenseCodeIssuedDate3"),z=E(e,"licenseCodeIssuedDate_4")||E(e,"licenseCodeIssuedDate4"),H=R(F,n),U=R(O,n),j=R(B,n),$=R(z,n),q=E(e,"professionalDrivingPermitCodes"),G=E(e,"vehicleLicense"),W=E(e,"driverRestrictionCodes"),Z=L(l,d),Y=[b,N,A,P].filter(Boolean).join(", "),Q=v&&V(v)?I(v):0,K={[S.LicenseNumber]:["licenseNumber"],[S.Surname]:["surname"],[S.Initials]:["initials"],[S.Sex]:["gender"],[S.IdNumber]:["idNumber"]};return Object.entries(K).forEach((([i,n])=>{n.some((t=>D(e,t)))&&t.push(i)})),Object.assign(Object.assign({},x()),{[S.InvalidFields]:t,[S.LicenseType]:y.SOUTH_AFRICA_DL,[S.LicenseNumber]:i||"N/A",[S.FullName]:Z,[S.FirstName]:d||"",[S.LastName]:l||"",[S.MiddleName]:void 0,[S.DateOfBirth]:v,[S.ExpiryDate]:w,[S.IssueDate]:p,[S.Age]:Q,[S.Sex]:u||"N/A",[S.Height]:void 0,[S.Weight]:void 0,[S.EyeColor]:void 0,[S.HairColor]:void 0,[S.Address]:"N/A",[S.City]:void 0,[S.State]:void 0,[S.PostalCode]:void 0,[S.VehicleClass]:Y||void 0,[S.Restrictions]:W,[S.Endorsements]:void 0,[S.IssuingCountry]:n,[S.DocumentDiscriminator]:a,[S.IdNumber]:a,[S.IdNumberType]:s,[S.IdIssuedCountry]:o,[S.Surname]:l,[S.Initials]:d,[S.LicenseIssuedCountry]:r,[S.LicenseIssueNumber]:c,[S.LicenseValidityFrom]:p,[S.LicenseValidityTo]:w,[S.ProfessionalDrivingPermitExpiryDate]:C,[S.ProfessionalDrivingPermitCodes]:q,[S.VehicleLicense]:G,[S.VehicleCode1]:b,[S.VehicleCode2]:N,[S.VehicleCode3]:A,[S.VehicleCode4]:P,[S.VehicleRestriction1]:k,[S.VehicleRestriction2]:_,[S.VehicleRestriction3]:M,[S.VehicleRestriction4]:T,[S.LicenseCodeIssuedDate1]:H,[S.LicenseCodeIssuedDate2]:U,[S.LicenseCodeIssuedDate3]:j,[S.LicenseCodeIssuedDate4]:$})}(t);default:return console.warn("Unknown license type, defaulting to AAMVA standard:",e),A(t)}}catch(t){return console.error("Error processing driver license data:",t),{status:{code:e.EnumResultStatus.RS_FAILED,message:`Processing failed: ${(null==t?void 0:t.message)||t}`}}}}!function(e){e.InvalidFields="invalidFields",e.LicenseType="licenseType",e.LicenseNumber="licenseNumber",e.AAMVAVersionNumber="aamvaVersionNumber",e.IssuerIdentificationNumber="issuerIdentificationNumber",e.JurisdictionVersionNumber="jurisdictionVersionNumber",e.DocumentDiscriminator="documentDiscriminator",e.IssuingCountry="issuingCountry",e.ComplianceType="complianceType",e.FullName="fullName",e.FirstName="firstName",e.LastName="lastName",e.MiddleName="middleName",e.NamePrefix="namePrefix",e.NameSuffix="nameSuffix",e.DateOfBirth="dateOfBirth",e.Age="age",e.Sex="sex",e.NameAlias="nameAlias",e.FirstNameAlias="firstNameAlias",e.LastNameAlias="lastNameAlias",e.MiddleNameAlias="middleNameAlias",e.PrefixAlias="prefixAlias",e.SuffixAlias="suffixAlias",e.AlternativeBirthDate="alternativeBirthDate",e.AlternativeSocialSecurityNumber="alternativeSocialSecurityNumber",e.Height="height",e.HeightInCentimeters="heightInCentimeters",e.Weight="weight",e.WeightInKilograms="weightInKilograms",e.WeightInPounds="weightInPounds",e.WeightRange="weightRange",e.EyeColor="eyeColor",e.HairColor="hairColor",e.Race="race",e.Address="address",e.Street1="street1",e.Street2="street2",e.City="city",e.State="state",e.PostalCode="postalCode",e.ResidenceStreet1="residenceStreet1",e.ResidenceStreet2="residenceStreet2",e.ResidenceCity="residenceCity",e.ResidenceState="residenceState",e.ResidencePostalCode="residencePostalCode",e.ExpiryDate="expiryDate",e.IssueDate="issueDate",e.IssueTimestamp="issueTimestamp",e.CardRevisionDate="cardRevisionDate",e.HazmatEndorsementExpiryDate="hazmatEndorsementExpiryDate",e.Under18Until="under18Until",e.Under19Until="under19Until",e.Under21Until="under21Until",e.VehicleClass="vehicleClass",e.StandardVehicleClassification="standardVehicleClassification",e.VehicleCodeDescription="vehicleCodeDescription",e.Restrictions="restrictions",e.RestrictionsCode="restrictionsCode",e.StandardRestrictionCode="standardRestrictionCode",e.RestrictionCodeDescription="restrictionCodeDescription",e.Endorsements="endorsements",e.EndorsementsCode="endorsementsCode",e.StandardEndorsementsCode="standardEndorsementsCode",e.EndorsementsCodeDescription="endorsementsCodeDescription",e.PermitClassificationCode="permitClassificationCode",e.PermitIdentifier="permitIdentifier",e.PermitExpirationDate="permitExpirationDate",e.PermitIssuedDate="permitIssuedDate",e.PermitRestrictionCode="permitRestrictionCode",e.PermitEndorsementCode="permitEndorsementCode",e.CustomerIdentifier="customerIdentifier",e.SocialSecurityNumber="socialSecurityNumber",e.InventoryControlNumber="inventoryControlNumber",e.NumberOfDuplicates="numberOfDuplicates",e.MedicalIndicator="medicalIndicator",e.OrganDonorIndicator="organDonorIndicator",e.NonResidentIndicator="nonResidentIndicator",e.VeteranIndicator="veteranIndicator",e.LimitedDurationDocumentIndicator="limitedDurationDocumentIndicator",e.FederalCommercialVehicleCodes="federalCommercialVehicleCodes",e.FamilyNameTruncation="familyNameTruncation",e.FirstNameTruncation="firstNameTruncation",e.MiddleNameTruncation="middleNameTruncation",e.BirthPlace="birthPlace",e.AuditInformation="auditInformation",e.JurisdictionSubfiles="jurisdictionSubfiles",e.Track1="track1",e.Track2="track2",e.Track3="track3",e.LRCforTrack1="LRCforTrack1",e.LRCforTrack2="LRCforTrack2",e.LRCforTrack3="LRCforTrack3",e.ISOIIN="ISOIIN",e.DLorID_NumberOverflow="DLorID_NumberOverflow",e.MagStripeVersion="magStripeVersion",e.DiscretionaryData1="discretionaryData1",e.DiscretionaryData2="discretionaryData2",e.SecurityFunction="securityFunction",e.IdNumber="idNumber",e.IdNumberType="idNumberType",e.IdIssuedCountry="idIssuedCountry",e.Surname="surname",e.Initials="initials",e.LicenseIssuedCountry="licenseIssuedCountry",e.LicenseIssueNumber="licenseIssueNumber",e.LicenseValidityFrom="licenseValidityFrom",e.LicenseValidityTo="licenseValidityTo",e.ProfessionalDrivingPermitExpiryDate="professionalDrivingPermitExpiryDate",e.ProfessionalDrivingPermitCodes="professionalDrivingPermitCodes",e.VehicleLicense="vehicleLicense",e.VehicleCode1="vehicleCode1",e.VehicleCode2="vehicleCode2",e.VehicleCode3="vehicleCode3",e.VehicleCode4="vehicleCode4",e.VehicleRestriction1="vehicleRestriction1",e.VehicleRestriction2="vehicleRestriction2",e.VehicleRestriction3="vehicleRestriction3",e.VehicleRestriction4="vehicleRestriction4",e.LicenseCodeIssuedDate1="licenseCodeIssuedDate1",e.LicenseCodeIssuedDate2="licenseCodeIssuedDate2",e.LicenseCodeIssuedDate3="licenseCodeIssuedDate3",e.LicenseCodeIssuedDate4="licenseCodeIssuedDate4"}(S||(S={})),function(e){e.AAMVA_DL_ID="AAMVA_DL_ID",e.AAMVA_DL_ID_WITH_MAG_STRIPE="AAMVA_DL_ID_WITH_MAG_STRIPE",e.SOUTH_AFRICA_DL="SOUTH_AFRICA_DL"}(y||(y={}));const k={[S.InvalidFields]:"Invalid Fields",[S.LicenseType]:"License Type",[S.LicenseNumber]:"License Number",[S.AAMVAVersionNumber]:"AAMVA Version Number",[S.IssuerIdentificationNumber]:"Issuer ID Number",[S.JurisdictionVersionNumber]:"Jurisdiction Version",[S.DocumentDiscriminator]:"Document Discriminator",[S.IssuingCountry]:"Issuing Country",[S.ComplianceType]:"Compliance Type",[S.FullName]:"Full Name",[S.FirstName]:"First Name",[S.LastName]:"Last Name",[S.MiddleName]:"Middle Name",[S.NamePrefix]:"Name Prefix",[S.NameSuffix]:"Name Suffix",[S.DateOfBirth]:"Date of Birth",[S.Age]:"Age",[S.Sex]:"Sex",[S.NameAlias]:"Name Alias",[S.FirstNameAlias]:"First Name Alias",[S.LastNameAlias]:"Last Name Alias",[S.MiddleNameAlias]:"Middle Name Alias",[S.PrefixAlias]:"Prefix Alias",[S.SuffixAlias]:"Suffix Alias",[S.AlternativeBirthDate]:"Alternative Birth Date",[S.AlternativeSocialSecurityNumber]:"Alternative SSN",[S.Height]:"Height",[S.HeightInCentimeters]:"Height (cm)",[S.Weight]:"Weight",[S.WeightInKilograms]:"Weight (kg)",[S.WeightInPounds]:"Weight (lbs)",[S.WeightRange]:"Weight Range",[S.EyeColor]:"Eye Color",[S.HairColor]:"Hair Color",[S.Race]:"Race/Ethnicity",[S.Address]:"Address",[S.Street1]:"Street 1",[S.Street2]:"Street 2",[S.City]:"City",[S.State]:"State/Province",[S.PostalCode]:"Postal Code",[S.ResidenceStreet1]:"Residence Street 1",[S.ResidenceStreet2]:"Residence Street 2",[S.ResidenceCity]:"Residence City",[S.ResidenceState]:"Residence State",[S.ResidencePostalCode]:"Residence Postal Code",[S.ExpiryDate]:"Expiry Date",[S.IssueDate]:"Issue Date",[S.IssueTimestamp]:"Issue Timestamp",[S.CardRevisionDate]:"Card Revision Date",[S.HazmatEndorsementExpiryDate]:"Hazmat Endorsement Expiry",[S.Under18Until]:"Under 18 Until",[S.Under19Until]:"Under 19 Until",[S.Under21Until]:"Under 21 Until",[S.VehicleClass]:"Vehicle Class",[S.StandardVehicleClassification]:"Standard Vehicle Class",[S.VehicleCodeDescription]:"Vehicle Code Description",[S.Restrictions]:"Restrictions",[S.RestrictionsCode]:"Restriction Code",[S.StandardRestrictionCode]:"Standard Restriction Code",[S.RestrictionCodeDescription]:"Restriction Description",[S.Endorsements]:"Endorsements",[S.EndorsementsCode]:"Endorsement Code",[S.StandardEndorsementsCode]:"Standard Endorsement Code",[S.EndorsementsCodeDescription]:"Endorsement Description",[S.PermitClassificationCode]:"Permit Classification",[S.PermitIdentifier]:"Permit Identifier",[S.PermitExpirationDate]:"Permit Expiry Date",[S.PermitIssuedDate]:"Permit Issue Date",[S.PermitRestrictionCode]:"Permit Restriction Code",[S.PermitEndorsementCode]:"Permit Endorsement Code",[S.CustomerIdentifier]:"Customer Identifier",[S.SocialSecurityNumber]:"Social Security Number",[S.InventoryControlNumber]:"Inventory Control Number",[S.NumberOfDuplicates]:"Number of Duplicates",[S.MedicalIndicator]:"Medical Indicator",[S.OrganDonorIndicator]:"Organ Donor",[S.NonResidentIndicator]:"Non-Resident",[S.VeteranIndicator]:"Veteran",[S.LimitedDurationDocumentIndicator]:"Limited Duration Document",[S.FederalCommercialVehicleCodes]:"Federal Commercial Vehicle Codes",[S.FamilyNameTruncation]:"Family Name Truncation",[S.FirstNameTruncation]:"First Name Truncation",[S.MiddleNameTruncation]:"Middle Name Truncation",[S.BirthPlace]:"Birth Place",[S.AuditInformation]:"Audit Information",[S.JurisdictionSubfiles]:"Jurisdiction Subfiles",[S.Track1]:"Track 1 Data",[S.Track2]:"Track 2 Data",[S.Track3]:"Track 3 Data",[S.LRCforTrack1]:"Track 1 LRC",[S.LRCforTrack2]:"Track 2 LRC",[S.LRCforTrack3]:"Track 3 LRC",[S.ISOIIN]:"ISO IIN",[S.DLorID_NumberOverflow]:"DL/ID Number Overflow",[S.MagStripeVersion]:"Mag Stripe Version",[S.DiscretionaryData1]:"Discretionary Data 1",[S.DiscretionaryData2]:"Discretionary Data 2",[S.SecurityFunction]:"Security Function",[S.IdNumber]:"ID Number",[S.IdNumberType]:"ID Number Type",[S.IdIssuedCountry]:"ID Issued Country",[S.Surname]:"Surname",[S.Initials]:"Initials",[S.LicenseIssuedCountry]:"License Issued Country",[S.LicenseIssueNumber]:"License Issue Number",[S.LicenseValidityFrom]:"License Valid From",[S.LicenseValidityTo]:"License Valid To",[S.ProfessionalDrivingPermitExpiryDate]:"PrDP Permit Expiry Date",[S.ProfessionalDrivingPermitCodes]:"PrDP Codes",[S.VehicleLicense]:"Vehicle License",[S.VehicleCode1]:"Vehicle Code 1",[S.VehicleCode2]:"Vehicle Code 2",[S.VehicleCode3]:"Vehicle Code 3",[S.VehicleCode4]:"Vehicle Code 4",[S.VehicleRestriction1]:"Vehicle Restriction 1",[S.VehicleRestriction2]:"Vehicle Restriction 2",[S.VehicleRestriction3]:"Vehicle Restriction 3",[S.VehicleRestriction4]:"Vehicle Restriction 4",[S.LicenseCodeIssuedDate1]:"License Code Issue Date 1",[S.LicenseCodeIssuedDate2]:"License Code Issue Date 2",[S.LicenseCodeIssuedDate3]:"License Code Issue Date 3",[S.LicenseCodeIssuedDate4]:"License Code Issue Date 4"},_=[S.DateOfBirth,S.ExpiryDate,S.IssueDate,S.AlternativeBirthDate,S.CardRevisionDate,S.HazmatEndorsementExpiryDate,S.Under18Until,S.Under19Until,S.Under21Until,S.PermitExpirationDate,S.PermitIssuedDate,S.LicenseValidityFrom,S.LicenseValidityTo,S.ProfessionalDrivingPermitExpiryDate,S.LicenseCodeIssuedDate1,S.LicenseCodeIssuedDate2,S.LicenseCodeIssuedDate3,S.LicenseCodeIssuedDate4];function M(e){if(!e||!e.year&&!e.month&&!e.day)return"N/A";const t=e=>void 0!==e?1===e.toString().length?`0${e}`:e.toString():"";return e.year&&e.month&&e.day?`${e.year}-${t(e.month)}-${t(e.day)}`:e.year&&e.month?`${e.year}-${t(e.month)}`:e.year?`${e.year}`:e.month&&e.day?`${t(e.month)}-${t(e.day)}`:e.month?`${t(e.month)}`:e.day?`${t(e.day)}`:"N/A"}class T{constructor(e,t){var i,n,a;this.resources=e,this.config=t,this.imageEditorView=null,this.layer=null,this.config.utilizedTemplateNames={detect:(null===(i=t.utilizedTemplateNames)||void 0===i?void 0:i.detect)||p,normalize:(null===(n=t.utilizedTemplateNames)||void 0===n?void 0:n.normalize)||w,barcode:(null===(a=t.utilizedTemplateNames)||void 0===a?void 0:a.barcode)||C}}async initialize(){if(!this.resources.result)throw Error("Captured image is missing. Please capture an image first!");if(!this.config.container)throw new Error("Please create an Correction View Container element");l("ddls-correction-view-style",F);const e=document.createElement("div");e.className="ddls-correction-view-container";const i=document.createElement("div");Object.assign(i.style,{width:"100%",height:"100%"}),e.appendChild(i),o(this.config.container).appendChild(e),this.imageEditorView=await t.ImageEditorView.createInstance(i),this.layer=this.imageEditorView.createDrawingLayer(),this.setupDrawingLayerStyle(),this.setupInitialDetectedQuad(),this.setupCorrectionControls(),this.setupQuadConstraints()}setupDrawingLayerStyle(){const e=t.DrawingStyleManager.createDrawingStyle({lineWidth:5,fillStyle:"transparent",strokeStyle:"#FE8E14",paintMode:"stroke"});this.layer.setDefaultStyle(e)}setupQuadConstraints(){const e=this.layer.fabricCanvas;e.defaultCursor="default",e.hoverCursor="default",e.moveCursor="default",e.on("object:scaling",(t=>{const i=t.target,n=i.points,a=this.getCanvasBounds();n.forEach((e=>{e.x=Math.max(0,Math.min(a.width,e.x)),e.y=Math.max(0,Math.min(a.height,e.y))})),i.set({points:n,dirty:!0}),e.renderAll()})),e.on("object:modified",(t=>{const i=t.target;if(!i)return;const n=i.points,a=this.getCanvasBounds();let s=!1;n.forEach((e=>{(e.x<0||e.x>a.width||e.y<0||e.y>a.height)&&(s=!0)})),s&&(n.forEach((e=>{e.x=Math.max(0,Math.min(a.width,e.x)),e.y=Math.max(0,Math.min(a.height,e.y))})),i.set({points:n,dirty:!0}),e.renderAll())}))}getCanvasBounds(){const e=this.layer.fabricCanvas;return{width:e.getWidth(),height:e.getHeight()}}addQuadToLayer(e){this.layer.clearDrawingItems();const t=e._getFabricObject();t.cornerSize=60,t.lockMovementX=!0,t.lockMovementY=!0,t.on("mousedown",(function(e){var t;e.target&&e.target.controls&&(this.cornerColor="transparent",this.dirty=!0,null===(t=this.canvas)||void 0===t||t.renderAll())})),t.on("mouseup",(function(){var e;this.cornerColor="#FE8E14",this.dirty=!0,null===(e=this.canvas)||void 0===e||e.renderAll()})),this.layer.renderAll(),this.layer.addDrawingItems([e]),this.layer.fabricCanvas.setActiveObject(t),this.layer.fabricCanvas.renderAll()}setupInitialDetectedQuad(){}createControls(){var e,t,i,n,a,s,o,c,l,d,u,h,g,f;const{toolbarButtonsConfig:v}=this.config;return r([{id:"ddls-correction-fullImage",icon:(null===(e=null==v?void 0:v.fullImage)||void 0===e?void 0:e.icon)||m.fullImage,label:(null===(t=null==v?void 0:v.fullImage)||void 0===t?void 0:t.label)||"Full Image",className:`${(null===(i=null==v?void 0:v.fullImage)||void 0===i?void 0:i.className)||""}`,isHidden:(null===(n=null==v?void 0:v.fullImage)||void 0===n?void 0:n.isHidden)||!1,onClick:()=>this.setFullImageBoundary()},{id:"ddls-correction-detectBorders",icon:(null===(a=null==v?void 0:v.detectBorders)||void 0===a?void 0:a.icon)||m.autoBounds,label:(null===(s=null==v?void 0:v.detectBorders)||void 0===s?void 0:s.label)||"Detect Borders",className:`${(null===(o=null==v?void 0:v.detectBorders)||void 0===o?void 0:o.className)||""}`,isHidden:(null===(c=null==v?void 0:v.detectBorders)||void 0===c?void 0:c.isHidden)||!1,onClick:()=>this.setBoundaryAutomatically()},{id:"ddls-correction-apply",icon:(null===(l=null==v?void 0:v.apply)||void 0===l?void 0:l.icon)||(!1===(null===(d=this.config)||void 0===d?void 0:d._showResultView)?m.complete:m.finish),label:(null===(u=null==v?void 0:v.apply)||void 0===u?void 0:u.label)||(!1===(null===(h=this.config)||void 0===h?void 0:h._showResultView)?"Done":"Apply"),className:`${(null===(g=null==v?void 0:v.apply)||void 0===g?void 0:g.className)||""}`,isHidden:(null===(f=null==v?void 0:v.apply)||void 0===f?void 0:f.isHidden)||!1,onClick:()=>this.confirmCorrection()}])}setupCorrectionControls(){try{const e=this.createControls(),t=o(this.config.container).firstElementChild;t&&t.appendChild(e)}catch(e){throw console.error("Error setting up correction controls:",e),new Error(`Failed to setup correction controls: ${e.message}`)}}setFullImageBoundary(){}async setBoundaryAutomatically(){this.config.templateFilePath&&await this.resources.cvRouter.initSettings(this.config.templateFilePath),this.resources.cvRouter.maxImageSideLength=1/0}async confirmCorrection(){const e=this.layer.getDrawingItems()[0];if(!e)throw new Error("No quad drawing item found");const t=e.getQuad();await this.correctImage(null==t?void 0:t.points),this.dispose(),this.hideView()}async launch(){try{return o(this.config.container).textContent="",await this.initialize(),o(this.config.container).style.display="flex",new Promise((e=>{this.currentCorrectionResolver=e}))}catch(e){let t=(null==e?void 0:e.message)||e;console.error(t)}}hideView(){o(this.config.container).style.display="none"}async correctImage(e){const{cvRouter:t}=this.resources;this.config.templateFilePath&&await this.resources.cvRouter.initSettings(this.config.templateFilePath);const i=await t.getSimplifiedSettings(this.config.utilizedTemplateNames.normalize);i.roiMeasuredInPercentage=!1,i.roi.points=e,await t.updateSettings(this.config.utilizedTemplateNames.normalize,i)}dispose(){var e,t;(null===(e=this.imageEditorView)||void 0===e?void 0:e.dispose)&&this.imageEditorView.dispose(),this.layer=null,(null===(t=this.config)||void 0===t?void 0:t.container)&&(o(this.config.container).textContent=""),this.currentCorrectionResolver=void 0}}const F="\n  .ddls-correction-view-container {\n    display: flex;\n    width: 100%;\n    height: 100%;\n    background-color:#575757;\n    font-size: 12px;\n    flex-direction: column;\n    align-items: center;\n  }\n\n  @media (orientation: landscape) and (max-width: 1024px) {\n    .ddls-correction-view-container {\n      flex-direction: row;\n    }\n  }\n";function O(e,t={}){const{message:i,spinnerSize:n=32}=t,a=document.createElement("div");a.className="ddls-loading-screen";const s=document.createElement("div");s.className="ddls-loading";const o=document.createElement("div");o.className="ddls-loading-content";const r=`\n    <svg \n      xmlns="http://www.w3.org/2000/svg" \n      viewBox="0 0 24 24" \n      fill="none" \n      stroke="white" \n      stroke-linecap="round" \n      stroke-linejoin="round" \n      width="${n}" \n      height="${n}" \n      stroke-width="0.75"\n    > \n      <path d="M12 3a9 9 0 1 0 9 9"></path> \n    </svg>\n  `;if(o.innerHTML=r,i){const e=document.createElement("div");e.className="ddls-loading-message",e.textContent=i,o.appendChild(e)}return s.appendChild(o),a.appendChild(s),e.appendChild(a),{element:a,updateMessage:e=>{let t=s.querySelector(".ddls-loading-message");null!==e?t?t.textContent=e:(t=document.createElement("div"),t.className="ddls-loading-message",t.textContent=e,o.appendChild(t)):null==t||t.remove()},hide:()=>{a&&a.parentNode&&(a.classList.add("fade-out"),setTimeout((()=>{var e;null===(e=a.parentNode)||void 0===e||e.removeChild(a)}),200))}}}const B='\n  .ddls-loading-screen {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background-color: #323234;\n    z-index: 998;\n    opacity: 1;\n    transition: opacity 0.2s ease-out;\n  }\n\n  .ddls-loading-screen.fade-out {\n    opacity: 0;\n  }\n\n  .ddls-loading {\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    color: white;\n    z-index: 999;\n    transform: translate(-50%, -50%);\n  }\n\n  .ddls-loading-content {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 16px;\n  }\n\n  .ddls-loading svg {\n    animation: spin 1s linear infinite;\n  }\n\n  .ddls-loading-message {\n    color: white;\n    font-family: "Verdana";\n    font-size: 14px;\n    text-align: center;\n    max-width: 200px;\n    line-height: 1.4;\n    opacity: 0.9;\n  }\n\n  @keyframes spin {\n    from {\n      transform: rotate(0deg);\n    }\n    to {\n      transform: rotate(360deg);\n    }\n  }\n',z={openingCamera:"Opening camera...",processingImage:"Processing image...",hintStart:"Position the front of the license in the frame",hintInProgress:"Keep steady while we complete the scan",hintMoveCloser:"Move the license closer to the camera",hintBlurry:"License is blurry. Move license back",hintRotateHorizontal:"Rotate license to horizontal"},H={openingCamera:"Opening camera...",processingImage:"Processing image...",hintStart:"Position the back of the license in the frame",hintInProgress:"Keep steady while we complete the scan",hintMoveCloser:"Move the license closer to the camera",hintRotateHorizontal:"Rotate license to horizontal",hintBlurry:"License is blurry. Move license back",hintScanningBarcode:"Scanning barcode"},U={title:"Verify Front of License",hintVerify:"Please check if the details are clear",barcodeNotFound:"Failed to read barcode. Please retry!"},j={title:"Verify Back of License",hintVerify:"Please check if the details are clear",barcodeNotFound:"Failed to read barcode. Please retry!"},$={title:"Scan Result"};class q{constructor(){"undefined"!=typeof document&&(this.tmpCanvas=document.createElement("canvas"),this.tmpCtx=this.tmpCanvas.getContext("2d"))}getPixels(e){let t,i=null;if(e.getContext){t=e;try{i=t.getContext("2d")}catch(e){}}return i||(t=this.getCanvas(e.width,e.height),i=t.getContext("2d"),i.drawImage(e,0,0)),i.getImageData(0,0,t.width,t.height)}getCanvas(e,t){const i=document.createElement("canvas");return i.width=e,i.height=t,i}createImageData(e,t){return this.tmpCtx?this.tmpCtx.createImageData(e,t):{width:e,height:t,data:new Uint8ClampedArray(e*t*4)}}luminance(e){const t=this.createImageData(e.width,e.height),i=t.data,n=e.data;for(let e=0;e<n.length;e+=4){const t=.2126*n[e]+.7152*n[e+1]+.0722*n[e+2];i[e]=i[e+1]=i[e+2]=t,i[e+3]=n[e+3]}return t}gaussianBlur(e,t){if((t=Math.abs(t))<=1)return this.identity(e);const i=t/2,n=Math.ceil(t)+(1-Math.ceil(t)%2),a=new Float32Array(n),s=(i+.5)/3,o=s*s,r=1/Math.sqrt(2*Math.PI*o),c=-1/(2*s*s);let l=0;const d=Math.floor(n/2);for(let e=0;e<n;e++){const t=e-d,i=r*Math.exp(t*t*c);a[e]=i,l+=i}for(let e=0;e<a.length;e++)a[e]/=l;return this.separableConvolve(e,a,a)}identity(e){const t=this.createImageData(e.width,e.height),i=t.data,n=e.data;for(let e=0;e<n.length;e++)i[e]=n[e];return t}convolve(e,t,i=!0){const n=Math.round(Math.sqrt(t.length)),a=Math.floor(n/2),s=e.data,o=e.width,r=e.height,c=this.createImageData(o,r),l=c.data,d=i?1:0;for(let e=0;e<r;e++)for(let i=0;i<o;i++){const c=4*(e*o+i);let u=0,h=0,m=0,g=0;for(let c=0;c<n;c++)for(let l=0;l<n;l++){const d=4*(Math.min(r-1,Math.max(0,e+c-a))*o+Math.min(o-1,Math.max(0,i+l-a))),f=t[c*n+l];u+=s[d]*f,h+=s[d+1]*f,m+=s[d+2]*f,g+=s[d+3]*f}l[c]=u,l[c+1]=h,l[c+2]=m,l[c+3]=g+d*(255-g)}return c}separableConvolve(e,t,i){return this.horizontalConvolve(this.verticalConvolve(e,i),t)}verticalConvolve(e,t){const i=t.length,n=Math.floor(i/2),a=e.data,s=e.width,o=e.height,r=this.createImageData(s,o),c=r.data;for(let e=0;e<o;e++)for(let r=0;r<s;r++){const l=4*(e*s+r);let d=0,u=0,h=0,m=0;for(let c=0;c<i;c++){const i=4*(Math.min(o-1,Math.max(0,e+c-n))*s+r),l=t[c];d+=a[i]*l,u+=a[i+1]*l,h+=a[i+2]*l,m+=a[i+3]*l}c[l]=d,c[l+1]=u,c[l+2]=h,c[l+3]=m}return r}horizontalConvolve(e,t){const i=t.length,n=Math.floor(i/2),a=e.data,s=e.width,o=e.height,r=this.createImageData(s,o),c=r.data;for(let e=0;e<o;e++)for(let o=0;o<s;o++){const r=4*(e*s+o);let l=0,d=0,u=0,h=0;for(let r=0;r<i;r++){const i=4*(e*s+Math.min(s-1,Math.max(0,o+r-n))),c=t[r];l+=a[i]*c,d+=a[i+1]*c,u+=a[i+2]*c,h+=a[i+3]*c}c[r]=l,c[r+1]=d,c[r+2]=u,c[r+3]=h}return r}}function G(e){const t=new q;let i;i="data"in e?e:t.getPixels(e);const n=function(e,t){const i=e.width>=360?t.gaussianBlur(e,5):e,n=t.luminance(i),a=new Float32Array([1,0,-1,2,0,-2,1,0,-1]);return t.convolve(n,a,!0)}(i,t),a=function(e){const{data:t,width:i}=e,n=4*i,a=[];for(let e=0;e<t.length;e+=n){const s=new Uint8ClampedArray(i);let o=0;for(let i=e;i<e+n;i+=4)s[o]=t[i],o+=1;a.push(s)}return a}(n);return function(e){const t=e[0].length,i=e.length;let n=0,a=0;for(let s=0;s<i;s+=1){let i=-1;for(let o=0;o<t;o+=1){const t=e[s][o];if(i>=0&&o>i){const r=e[s][o-1];t<r&&(r>=20&&(n+=1,a+=o-i-1),i=-1)}0===t&&(i=o)}}const s=0===n?0:a/n;return{width:t,height:i,num_edges:n,avg_edge_width:s,avg_edge_width_perc:0===n?0:s/t*100}}(a)}var W;!function(e){e.FRONT_LICENSE="front-license",e.BACK_LICENSE="back-license",e.MOVE_CLOSER="move-closer",e.CHANGE_ORIENTATION="change-orientation",e.NONE="none"}(W||(W={}));class Z{showScannerLoadingOverlay(e){const t=o(this.config.container);this.loadingScreen=O(t,{message:e}),t.style.display="block",t.style.position="relative"}hideScannerLoadingOverlay(e=!1){this.loadingScreen&&(this.loadingScreen.hide(),this.loadingScreen=null,e&&(o(this.config.container).style.display="none"))}toggleSoundFeedback(e){this.isSoundFeedbackOn=void 0!==e?e:!this.isSoundFeedbackOn;const t=o(this.config.container),i=t.children[t.children.length-1];if(!(null==i?void 0:i.shadowRoot))return;const n=i.shadowRoot.querySelector(".dce-mn-sound-feedback"),a=n.querySelector(".dce-mn-sound-feedback-on");n.querySelector(".dce-mn-sound-feedback-off").style.display=this.isSoundFeedbackOn?"none":"block",a.style.display=this.isSoundFeedbackOn?"block":"none"}getText(){var t;const i=null===(t=this.config.textConfig)||void 0===t?void 0:t[this.currentScanSide],n=this.currentScanSide===e.EnumDriverLicenseScanSide.Front?z:H;return Object.assign(Object.assign({},n),i||{})}constructor(t,i){var n,a,s;this.resources=t,this.config=i,this.currentScanMode=g.Image,this.currentScanSide=e.EnumDriverLicenseScanSide.Front,this.boundsDetectionEnabled=!1,this.smartCaptureEnabled=!1,this.autoCropEnabled=!1,this.isSoundFeedbackOn=!1,this.licenseVerificationCount=0,this.originalImageData=null,this.initialized=!1,this.initializedDCE=!1,this.resizeTimer=null,this.DCE_ELEMENTS={soundFeedbackBtn:null,selectCameraBtn:null,uploadImageBtn:null,closeScannerBtn:null,takePhotoBtn:null,boundsDetectionBtn:null,smartCaptureBtn:null,autoCropBtn:null,hintTopMessage:null},this.currentGuideType=W.NONE,this.DCE_SCANGUIDE_ELEMENTS={[W.FRONT_LICENSE]:null,[W.BACK_LICENSE]:null,[W.MOVE_CLOSER]:null,[W.CHANGE_ORIENTATION]:null,[W.NONE]:null},this.loadingScreen=null,this.handleResize=()=>{this.toggleScanGuide(!1,W.NONE),this.resizeTimer&&window.clearTimeout(this.resizeTimer),this.resizeTimer=window.setTimeout((()=>{this.toggleScanGuide(!0,this.currentGuideType)}),500)},this.MIN_QUAD_TO_REGION_RATIO=.2,this.config.utilizedTemplateNames={detect:(null===(n=i.utilizedTemplateNames)||void 0===n?void 0:n.detect)||p,normalize:(null===(a=i.utilizedTemplateNames)||void 0===a?void 0:a.normalize)||w,barcode:(null===(s=i.utilizedTemplateNames)||void 0===s?void 0:s.barcode)||C}}async initialize(){if(!this.initialized){l("dynamsoft-ddls-loading-screen-style",B);try{const{cameraView:e,cameraEnhancer:i,cvRouter:n}=this.resources;e.setVideoFit("cover"),n.setInput(i);const a=new t.CapturedResultReceiver;a.onCapturedResultReceived=e=>this.handleBoundsDetection(e),await n.addResultReceiver(a),this.boundsDetectionEnabled=!0,this.smartCaptureEnabled=!0,this.autoCropEnabled=!0,!1===this.config.showScanGuide&&this.toggleScanGuide(!1,W.NONE),this.initialized=!0}catch(t){let i=(null==t?void 0:t.message)||t;console.error(i),alert(i),this.closeCamera();const n={status:{code:e.EnumResultStatus.RS_FAILED,message:"DDLS Init error"}};this.currentScanResolver(n)}}}async processBarcodeFromImage(t){var i,n,a;if(!(null===(i=this.config._workflowConfig)||void 0===i?void 0:i.readBarcode))return{status:{code:e.EnumResultStatus.RS_SUCCESS,message:"Barcode processing disabled"}};try{console.log("Processing barcode from captured image...");const{cvRouter:i}=this.resources,s=this.config.utilizedTemplateNames.barcode,o=await i.capture(t,s);if((null===(a=null===(n=null==o?void 0:o.parsedResult)||void 0===n?void 0:n.parsedResultItems)||void 0===a?void 0:a.length)>0){const t=P(o.parsedResult.parsedResultItems[0]);if(t)return console.log("Barcode successfully processed:",t),Object.assign(Object.assign({},t),{status:{code:e.EnumResultStatus.RS_SUCCESS,message:`Barcode successfully processed from ${this.currentScanSide} side`}})}return{status:{code:e.EnumResultStatus.RS_FAILED,message:`No readable barcode found in ${this.currentScanSide} image`}}}catch(t){return console.error("Error processing barcode:",t),{status:{code:e.EnumResultStatus.RS_FAILED,message:`Barcode processing failed: ${(null==t?void 0:t.message)||t}`}}}}async performBarcodeVerification(e){const{barcodeVerificationCallback:t}=this.config._workflowConfig||{};if(!t)return{success:!0,barcodeData:e};try{return await t(e)?{success:!0,barcodeData:e}:{success:!1,errorMessage:"Barcode verification failed - information could not be validated",barcodeData:e}}catch(t){return{success:!1,errorMessage:`Verification error: ${(null==t?void 0:t.message)||t}`,barcodeData:e}}}async processAndUpdateBarcodeData(t){var i,n,a,s;const o=null!==(n=null===(i=this.config._workflowConfig)||void 0===i?void 0:i.barcodeScanSide)&&void 0!==n?n:e.EnumDriverLicenseScanSide.Back;if((null===(a=this.config._workflowConfig)||void 0===a?void 0:a.readBarcode)&&this.currentScanSide===o)try{const i=await this.processBarcodeFromImage(t);if(i.status.code===e.EnumResultStatus.RS_SUCCESS)if((null===(s=this.config._workflowConfig)||void 0===s?void 0:s.enableBarcodeVerification)&&this.currentScanSide){const e=await this.performBarcodeVerification(i),t=Object.assign(Object.assign({},i),{licenseVerificationStatus:{isVerified:e.success,errorMessage:e.errorMessage}});this.resources.onResultUpdated&&this.resources.onResultUpdated(Object.assign(Object.assign({},this.resources.result),{licenseData:t}))}else this.resources.onResultUpdated&&this.resources.onResultUpdated(Object.assign(Object.assign({},this.resources.result),{licenseData:i}))}catch(e){console.error("Error processing barcode data:",e)}}async initializeElements(){const e=o(this.config.container),t=e.children[e.children.length-1];if(!(null==t?void 0:t.shadowRoot))throw new Error("Shadow root not found");this.DCE_ELEMENTS={soundFeedbackBtn:t.shadowRoot.querySelector(".dce-mn-sound-feedback"),selectCameraBtn:t.shadowRoot.querySelector(".dce-mn-select-camera-icon"),uploadImageBtn:t.shadowRoot.querySelector(".dce-mn-upload-image-icon"),closeScannerBtn:t.shadowRoot.querySelector(".dce-mn-close"),takePhotoBtn:t.shadowRoot.querySelector(".dce-mn-take-photo"),boundsDetectionBtn:t.shadowRoot.querySelector(".dce-mn-bounds-detection"),smartCaptureBtn:t.shadowRoot.querySelector(".dce-mn-smart-capture"),autoCropBtn:t.shadowRoot.querySelector(".dce-mn-auto-crop"),hintTopMessage:t.shadowRoot.querySelector(".dce-hint-top")},this.DCE_SCANGUIDE_ELEMENTS={[W.FRONT_LICENSE]:t.shadowRoot.querySelector(".dce-scanguide-dl-front"),[W.BACK_LICENSE]:t.shadowRoot.querySelector(".dce-scanguide-dl-back"),[W.MOVE_CLOSER]:t.shadowRoot.querySelector(".dce-scanguide-move-closer"),[W.CHANGE_ORIENTATION]:t.shadowRoot.querySelector(".dce-scanguide-rotate-dl"),[W.NONE]:null},await this.toggleBoundsDetection(this.boundsDetectionEnabled),await this.toggleSmartCapture(this.smartCaptureEnabled),await this.toggleAutoCrop(this.autoCropEnabled),this.assignDCEClickEvents(),!1===this.config._showCorrectionView&&(this.DCE_ELEMENTS.smartCaptureBtn.style.display="none"),this.initializedDCE=!0}assignDCEClickEvents(){if(!Object.values(this.DCE_ELEMENTS).every(Boolean))throw new Error("Camera control elements not found");this.takePhoto=this.takePhoto.bind(this),this.toggleBoundsDetection=this.toggleBoundsDetection.bind(this),this.toggleSmartCapture=this.toggleSmartCapture.bind(this),this.toggleAutoCrop=this.toggleAutoCrop.bind(this),this.closeCamera=this.closeCamera.bind(this),this.DCE_ELEMENTS.takePhotoBtn.onclick=this.takePhoto,this.DCE_ELEMENTS.boundsDetectionBtn.onclick=async()=>{await this.toggleBoundsDetection()},this.DCE_ELEMENTS.smartCaptureBtn.onclick=async()=>{},this.DCE_ELEMENTS.autoCropBtn.onclick=async()=>{await this.toggleAutoCrop()},this.DCE_ELEMENTS.closeScannerBtn.onclick=async()=>{await this.handleCloseBtn()},this.DCE_ELEMENTS.selectCameraBtn.onclick=e=>{e.stopPropagation(),this.toggleSelectCameraBox()},this.DCE_ELEMENTS.uploadImageBtn.onclick=()=>{this.uploadImage()},this.DCE_ELEMENTS.soundFeedbackBtn.onclick=()=>this.toggleSoundFeedback()}async handleCloseBtn(){this.closeCamera({hideContainer:!0}),this.currentScanResolver&&this.currentScanResolver({status:{code:e.EnumResultStatus.RS_CANCELLED,message:"Cancelled"}})}attachOptionClickListeners(){const t=o(this.config.container),i=t.children[t.children.length-1];if(!(null==i?void 0:i.shadowRoot))return;const n=i.shadowRoot.querySelector(".dce-mn-camera-and-resolution-settings"),a=i.shadowRoot.querySelectorAll(".dce-mn-camera-option"),s=i.shadowRoot.querySelectorAll(".dce-mn-resolution-option"),r=this.currentScanSide===e.EnumDriverLicenseScanSide.Front?W.FRONT_LICENSE:W.BACK_LICENSE;[...a,...s].forEach((e=>{e.addEventListener("click",(async()=>{const t=e.getAttribute("data-davice-id"),i=e.getAttribute("data-height"),a=e.getAttribute("data-width");t?this.resources.cameraEnhancer.selectCamera(t).then((()=>{this.toggleScanGuide(!0,r)})):i&&a&&this.resources.cameraEnhancer.setResolution({width:parseInt(a),height:parseInt(i)}).then((()=>{this.toggleScanGuide(!0,r)})),"none"!==n.style.display&&this.toggleSelectCameraBox()}))}))}highlightCameraAndResolutionOption(){const e=o(this.config.container),t=e.children[e.children.length-1];if(!(null==t?void 0:t.shadowRoot))return;const i=t.shadowRoot.querySelector(".dce-mn-camera-and-resolution-settings"),n=i.querySelectorAll(".dce-mn-camera-option"),a=i.querySelectorAll(".dce-mn-resolution-option"),s=this.resources.cameraEnhancer.getSelectedCamera(),r=this.resources.cameraEnhancer.getResolution();n.forEach((e=>{const t=e;t.getAttribute("data-davice-id")===(null==s?void 0:s.deviceId)?t.style.border="2px solid #fe814a":t.style.border="none"}));const c={"480p":"480","720p":"720","1080p":"1080","2k":"1440","4k":"2160"},l=function(e){const t=e.width*e.height,i=e.width/e.height;let n="480p",a=Number.MAX_VALUE;for(const[e,s]of Object.entries(u)){const o=s.width*s.height,r=s.width/s.height,c=.7*Math.abs(o-t)+Math.abs(r-i)*o*.3;c<a&&(a=c,n=e)}return n}(r);a.forEach((e=>{const t=e,i=t.getAttribute("data-height");t.style.border=i===c[l]?"2px solid #fe814a":"none"}))}toggleSelectCameraBox(){const e=o(this.config.container),t=e.children[e.children.length-1];if(!(null==t?void 0:t.shadowRoot))return;const i=t.shadowRoot.querySelector(".dce-mn-resolution-box");this.highlightCameraAndResolutionOption(),this.attachOptionClickListeners(),i.click()}async uploadImage(){var t,i,n,s,o,r,c,l,d;const u=document.createElement("input");u.type="file",u.accept="image/*",u.style.display="none",document.body.appendChild(u);try{const{cameraEnhancer:m,result:g,onResultUpdated:f}=this.resources;this.showScannerLoadingOverlay("Processing image and reading barcode...");const v=await new Promise(((e,t)=>{u.onchange=i=>{var n;const a=null===(n=i.target.files)||void 0===n?void 0:n[0];(null==a?void 0:a.type.startsWith("image/"))?e(a):t(new Error("Please select an image file"))},u.addEventListener("cancel",(()=>this.hideScannerLoadingOverlay(!1))),u.click()}));if(!v)return void this.hideScannerLoadingOverlay(!1);this.closeCamera({hideContainer:!1});const{blob:p}=await this.fileToBlob(v);this.capturedResult=await this.resources.cvRouter.capture(p,this.config.utilizedTemplateNames.detect),this.originalImageData=null===(n=null===(i=null===(t=this.capturedResult)||void 0===t?void 0:t.items)||void 0===i?void 0:i[0])||void 0===n?void 0:n.imageData;let w=null;if((null===(o=null===(s=this.capturedResult)||void 0===s?void 0:s.items)||void 0===o?void 0:o.length)<=1){const{width:e,height:t}=this.originalImageData;w={points:[{x:0,y:0},{x:e,y:0},{x:e,y:t},{x:0,y:t}],area:t*e}}else w=null===(d=null===(l=null===(c=null===(r=this.capturedResult)||void 0===r?void 0:r.processedDocumentResult)||void 0===c?void 0:c.detectedQuadResultItems)||void 0===l?void 0:l[0])||void 0===d?void 0:d.location;w.points=h(w.points,this.originalImageData,15);const C=await this.normalizeImage(w.points,this.originalImageData);await this.processAndUpdateBarcodeData(C.imageData);const S={status:{code:e.EnumResultStatus.RS_SUCCESS,message:"Success"},originalImageResult:this.originalImageData,deskewedImageResult:C,detectedQuadrilateral:w,_flowType:a.UPLOADED_IMAGE,imageData:!0,_imageData:C};null==f||f(Object.assign(Object.assign({},g),{[this.currentScanSide]:S})),this.currentScanResolver(S)}catch(t){let i=(null==t?void 0:t.message)||t;console.error(i),alert(i),this.closeCamera();const n={status:{code:e.EnumResultStatus.RS_FAILED,message:"Error processing uploaded image"}};this.currentScanResolver(n)}finally{document.body.removeChild(u),this.hideScannerLoadingOverlay(!0)}}async fileToBlob(e){return new Promise(((t,i)=>{const n=new Image;n.onload=()=>{const a=document.createElement("canvas");a.width=n.width,a.height=n.height;const s=a.getContext("2d");null==s||s.drawImage(n,0,0),a.toBlob((e=>{e?t({blob:e,width:n.width,height:n.height}):i(new Error("Failed to create blob"))}),e.type)},n.onerror=i,n.src=URL.createObjectURL(e)}))}async toggleAutoCaptureAnimation(e){const t=o(this.config.container),i=t.children[t.children.length-1];if(!(null==i?void 0:i.shadowRoot))return;const n=i.shadowRoot.querySelector(".dce-loading-auto-capture-animation");n.style.borderLeftColor=e?"transparent":"#fe8e14",n.style.borderBottomColor=e?"transparent":"#fe8e14"}async toggleBoundsDetection(e){const t=o(this.config.container),i=t.children[t.children.length-1];if(!(null==i?void 0:i.shadowRoot))return;const n=i.shadowRoot.querySelector(".dce-mn-bounds-detection"),a=i.shadowRoot.querySelector(".dce-mn-bounds-detection-on"),s=i.shadowRoot.querySelector(".dce-mn-bounds-detection-off");if(!a||!s)return;this.toggleAutoCaptureAnimation(!1);const r=void 0!==e?e:!this.boundsDetectionEnabled;r||await this.toggleSmartCapture(!1);const{cvRouter:c}=this.resources;this.boundsDetectionEnabled=r,n.style.color=this.boundsDetectionEnabled?"#fe814a":"#fff",s.style.display=this.boundsDetectionEnabled?"none":"block",a.style.display=this.boundsDetectionEnabled?"block":"none",this.initialized&&this.boundsDetectionEnabled?await c.startCapturing(this.config.utilizedTemplateNames.detect):this.initialized&&!this.boundsDetectionEnabled&&this.stopCapturing()}async toggleSmartCapture(e){const t=o(this.config.container),i=t.children[t.children.length-1];if(!(null==i?void 0:i.shadowRoot))return;const n=i.shadowRoot.querySelector(".dce-mn-smart-capture"),a=i.shadowRoot.querySelector(".dce-mn-smart-capture-on"),s=i.shadowRoot.querySelector(".dce-mn-smart-capture-off");if(!a||!s)return;const r=void 0!==e?e:!this.smartCaptureEnabled;this.toggleAutoCaptureAnimation(r),r&&!this.boundsDetectionEnabled?await this.toggleBoundsDetection(!0):r||!1===this.config._showCorrectionView||await this.toggleAutoCrop(!1),this.smartCaptureEnabled=r,n.style.color=this.smartCaptureEnabled?"#fe814a":"#fff",s.style.display=this.smartCaptureEnabled?"none":"block",a.style.display=this.smartCaptureEnabled?"block":"none",this.licenseVerificationCount=0}async toggleAutoCrop(e){const t=o(this.config.container),i=t.children[t.children.length-1];if(!(null==i?void 0:i.shadowRoot))return;const n=i.shadowRoot.querySelector(".dce-mn-auto-crop"),a=i.shadowRoot.querySelector(".dce-mn-auto-crop-on"),s=i.shadowRoot.querySelector(".dce-mn-auto-crop-off");if(!a||!s)return;const r=void 0!==e?e:!this.autoCropEnabled;!r||this.boundsDetectionEnabled&&this.smartCaptureEnabled||(await this.toggleBoundsDetection(!0),await this.toggleSmartCapture(!0)),r||!1!==this.config._showCorrectionView||await this.toggleSmartCapture(!1),this.autoCropEnabled=r,n.style.color=this.autoCropEnabled?"#fe814a":"#fff",s.style.display=this.autoCropEnabled?"none":"block",a.style.display=this.autoCropEnabled?"block":"none"}toggleScanGuide(e,t){const i=o(this.config.container),n=i.children[i.children.length-1];(null==n?void 0:n.shadowRoot)&&(Object.entries(this.DCE_SCANGUIDE_ELEMENTS).forEach((([i,n])=>{t===W.NONE||!1===e||!1===this.config.showScanGuide?n&&(n.style.display="none"):n&&(n.style.display=i===t?"block":"none")})),this.currentGuideType=t,this.calculateScanRegion())}toggleScanHintMessage(e=!0,t=""){!1!==this.config.showScanHint?(this.DCE_ELEMENTS.hintTopMessage.style.display=e?"block":"none",this.DCE_ELEMENTS.hintTopMessage.innerText=t):this.DCE_ELEMENTS.hintTopMessage.style.display="none"}calculateScanRegion(){const{cameraEnhancer:e,cameraView:t}=this.resources;if(!e||!e.isOpen())return;let i;i={left:0,right:100,top:0,bottom:100,isMeasuredInPercentage:!0},null==t||t.setScanRegionMaskVisible(!0),e.setScanRegion(i)}async openCamera(){try{const{cameraEnhancer:e,cameraView:t}=this.resources,i=o(this.config.container);if(i.style.display="block",e.isOpen())e.isPaused()&&await e.resume();else{const n=t.getUIElement();n.parentElement||i.append(n),await e.open()}if(await e.setResolution({width:2560,height:1440}),!this.initializedDCE&&e.isOpen()){await this.initializeElements();t.getDrawingLayer(2).setVisible(!1)}window.addEventListener("resize",this.handleResize),this.toggleScanHintMessage(!0,this.getText().hintStart);const n=i.children[i.children.length-1];if(!(null==n?void 0:n.shadowRoot))throw new Error("Shadow root not found");n.shadowRoot.querySelector(".dce-mn-torch-off").style.display="none",n.shadowRoot.querySelector(".dce-mn-torch-on").style.display="none"}catch(t){let i=(null==t?void 0:t.message)||t;console.error(i),alert(i),this.closeCamera();const n={status:{code:e.EnumResultStatus.RS_FAILED,message:"Driver License Scanner Open Camera Error"}};this.currentScanResolver(n)}}closeCamera(e={}){const{hideContainer:t=!0,keepLoadingScreen:i=!1}=e;try{window.removeEventListener("resize",this.handleResize),this.resizeTimer&&(window.clearTimeout(this.resizeTimer),this.resizeTimer=null);const{cameraEnhancer:e,cameraView:n}=this.resources,a=o(this.config.container);i||(a.style.display=t?"none":"block"),(null==n?void 0:n.getUIElement().parentElement)&&a.removeChild(n.getUIElement()),e.close(),this.stopCapturing()}catch(e){let t=(null==e?void 0:e.message)||e;console.error(`Close Camera error: ${t}`)}}pauseCamera(){const{cameraEnhancer:e}=this.resources;e.pause()}stopCapturing(){const{cameraView:e,cvRouter:t}=this.resources;t.stopCapturing(),e.clearAllInnerDrawingItems()}getFlowType(){return this.autoCropEnabled?a.AUTO_CROP:this.smartCaptureEnabled?a.SMART_CAPTURE:a.MANUAL}async takePhoto(){var t,i,n,a,s;try{this.showScannerLoadingOverlay("Processing image and reading barcode...");const{cameraEnhancer:o,result:r,onResultUpdated:c}=this.resources,l=!this.boundsDetectionEnabled||this.boundsDetectionEnabled&&(!(null===(t=this.capturedResult)||void 0===t?void 0:t.items)||this.capturedResult.items.length<=1);this.originalImageData=l?o.fetchImage():this.originalImageData;let d=null,u=null;if(l){const{width:e,height:t}=this.originalImageData;u={points:[{x:0,y:0},{x:e,y:0},{x:e,y:t},{x:0,y:t}],area:t*e}}else u=null===(s=null===(a=null===(n=null===(i=this.capturedResult)||void 0===i?void 0:i.processedDocumentResult)||void 0===n?void 0:n.detectedQuadResultItems)||void 0===a?void 0:a[0])||void 0===s?void 0:s.location,u.points=u.points.map((e=>this.resources.cameraEnhancer.convertToScanRegionCoordinates(e))),u.points=h(u.points,this.originalImageData,15);const m=this.getFlowType();await this.toggleSmartCapture(!1),this.closeCamera({hideContainer:!1,keepLoadingScreen:!0}),d=await this.normalizeImage(u.points,this.originalImageData),await this.processAndUpdateBarcodeData(d.imageData);const g={status:{code:e.EnumResultStatus.RS_SUCCESS,message:"Success"},originalImageResult:this.originalImageData,deskewedImageResult:d,detectedQuadrilateral:u,_flowType:m,imageData:!0,_imageData:d};null==c||c(Object.assign(Object.assign({},r),{[this.currentScanSide]:g})),this.hideScannerLoadingOverlay(!0),this.currentScanResolver(g)}catch(t){let i=(null==t?void 0:t.message)||t;console.error(i),alert(i),this.hideScannerLoadingOverlay(!1),this.closeCamera({hideContainer:!0});const n={status:{code:e.EnumResultStatus.RS_FAILED,message:"Error capturing image"}};this.currentScanResolver(n)}}async handleBoundsDetection(e){var i,n;if(!(null===(i=e.items)||void 0===i?void 0:i.length))return;this.capturedResult=e;const a=e.items.filter((e=>e.type===t.EnumCapturedResultItemType.CRIT_ORIGINAL_IMAGE));this.originalImageData=a.length&&(null===(n=a[0])||void 0===n?void 0:n.imageData),(this.smartCaptureEnabled||this.autoCropEnabled)&&this.handleAutoCaptureMode(e)}async handleAutoCaptureMode(i){var n,a,s,o,r,c,l,d;const u=this.currentScanSide===e.EnumDriverLicenseScanSide.Front?W.FRONT_LICENSE:W.BACK_LICENSE;if(i.items.length<=1)return void this.showStartingState(u);const h=null===(a=null===(n=null==i?void 0:i.processedDocumentResult)||void 0===n?void 0:n.detectedQuadResultItems)||void 0===a?void 0:a[0],m=null!==(r=null===(o=null===(s=null==i?void 0:i.decodedBarcodesResult)||void 0===s?void 0:s.barcodeResultItems)||void 0===o?void 0:o[0])&&void 0!==r?r:null,g=this.calculateVisibleRegionArea(i),f=h.location.area/g,v=function(e,t=.1){if(!e)return{isValid:!1,orientation:null,matchedRatio:null};let i=1/0,n=-1/0,a=1/0,s=-1/0;for(const t of e)i=Math.min(i,t.x),n=Math.max(n,t.x),a=Math.min(a,t.y),s=Math.max(s,t.y);const o=n-i,r=s-a;if(r>o)return{isValid:!1,orientation:"vertical",matchedRatio:null};const c=o/r,l=Math.abs(c-1.588)/1.588<=t,d=Math.abs(c-2.2);return l?{isValid:!0,orientation:"horizontal",matchedRatio:"card"}:d/2.2<=t?{isValid:!0,orientation:"horizontal",matchedRatio:"magstripe"}:{isValid:!1,orientation:null,matchedRatio:null}}(null!==(l=null===(c=null==h?void 0:h.location)||void 0===c?void 0:c.points)&&void 0!==l?l:null),p={hasValidLicenseRatio:v.isValid,hasGoodSize:f>=this.MIN_QUAD_TO_REGION_RATIO,isVerticalOrientation:"vertical"===v.orientation,isReadyForCapture:1===this.licenseVerificationCount,barcodeRecognized:!(null===(d=this.config._workflowConfig)||void 0===d?void 0:d.readBarcode)||this.currentScanSide!==e.EnumDriverLicenseScanSide.Back||!!m};if(p.hasValidLicenseRatio&&p.hasGoodSize&&p.isReadyForCapture){const e=function(e){const t=e.width*e.height,i=[{minPixels:8294400,threshold:.3},{minPixels:3686400,threshold:.3},{minPixels:2073600,threshold:.5},{minPixels:921600,threshold:1},{minPixels:307200,threshold:1}];for(const{minPixels:e,threshold:n}of i)if(t>=e)return n;return.6}({width:this.resources.cameraEnhancer.getResolution().width,height:this.resources.cameraEnhancer.getResolution().height}),i=G(Object.assign(Object.assign({},this.originalImageData),{data:this.originalImageData.bytes})).avg_edge_width_perc.toFixed(2);return Number(i)>=e?void this.handleBlurryLicense():(this.isSoundFeedbackOn&&t.Feedback.beep(),void await this.takePhoto())}p.hasValidLicenseRatio?p.hasGoodSize?this.handleProgressState(u):this.handleTooSmallQuad():this.handleInvalidLicenseRatio(u,p.isVerticalOrientation)}showStartingState(e){this.toggleScanGuide(!0,e),this.toggleScanHintMessage(!0,this.getText().hintStart),this.resources.cameraView.clearAllInnerDrawingItems()}handleBlurryLicense(){const e=this.getText().hintBlurry;this.toggleScanHintMessage(!0,e)}handleInvalidLicenseRatio(e,t){this.toggleScanGuide(!0,t?W.CHANGE_ORIENTATION:e),this.resources.cameraView.clearAllInnerDrawingItems();const i=t?this.getText().hintRotateHorizontal:this.getText().hintStart;this.toggleScanHintMessage(!0,i)}handleTooSmallQuad(){this.toggleScanGuide(!0,W.MOVE_CLOSER),this.resources.cameraView.clearAllInnerDrawingItems(),this.toggleScanHintMessage(!0,this.getText().hintMoveCloser)}handleProgressState(e){this.toggleScanGuide(!0,e),this.toggleScanHintMessage(!0,this.getText().hintInProgress),this.licenseVerificationCount++}calculateVisibleRegionArea(e){const t=null==e?void 0:e.originalImageTag;return(null==t?void 0:t.currentHeight)*(null==t?void 0:t.currentWidth)}async launch(i=e.EnumDriverLicenseScanSide.Front,n=g.Image){try{this.currentScanSide=i,this.currentGuideType=i===e.EnumDriverLicenseScanSide.Front?W.FRONT_LICENSE:W.BACK_LICENSE,this.currentScanMode=n,await this.initialize();const{cvRouter:a,cameraEnhancer:s}=this.resources;return new Promise((async i=>{this.currentScanResolver=i,this.showScannerLoadingOverlay(this.getText().openingCamera),await this.openCamera();const n=this.currentScanSide===e.EnumDriverLicenseScanSide.Front?W.FRONT_LICENSE:W.BACK_LICENSE;if(this.toggleScanGuide(!0,n),this.hideScannerLoadingOverlay(),this.boundsDetectionEnabled){const e=this.currentScanMode===g.Image?this.config.utilizedTemplateNames.detect:this.config.utilizedTemplateNames.barcode;await a.startCapturing(e)}s.setPixelFormat(t.EnumImagePixelFormat.IPF_ABGR_8888)}))}catch(t){let i=(null==t?void 0:t.message)||t;console.error("Driver License Scanner Launch error: ",i),this.closeCamera();const n={status:{code:e.EnumResultStatus.RS_FAILED,message:"Driver License Scanner Launch error"}};this.currentScanResolver(n)}}async normalizeImage(e,t){var i;const{cvRouter:n}=this.resources,a=await n.getSimplifiedSettings(this.config.utilizedTemplateNames.normalize);a.roiMeasuredInPercentage=!1,a.roi.points=e,await n.updateSettings(this.config.utilizedTemplateNames.normalize,a);const s=await n.capture(t,this.config.utilizedTemplateNames.normalize);if(null===(i=null==s?void 0:s.processedDocumentResult.deskewedImageResultItems)||void 0===i?void 0:i[0])return s.processedDocumentResult.deskewedImageResultItems[0]}}class Y{constructor(t,i,n,a){this.resources=t,this.config=i,this.scannerView=n,this.correctionView=a,this.editedFields={},this.currentScanMode=e.EnumDriverLicenseScanSide.Front}async launch(){try{return o(this.config.container).textContent="",await this.initialize(),o(this.config.container).style.display="flex",new Promise((e=>{this.currentScanResultViewResolver=e}))}catch(e){let t=(null==e?void 0:e.message)||e;throw console.error(t),t}}async handleUploadAndShareBtn(e){var t,i;try{const{result:n}=this.resources;if(!(null===(t=n[this.currentScanMode])||void 0===t?void 0:t.deskewedImageResult))throw new Error("No image to upload");"upload"===e&&(null===(i=this.config)||void 0===i?void 0:i.onUpload)?await this.config.onUpload(n):"share"===e&&await this.handleShare()}catch(e){console.error("Error on upload/share:",e),alert("Failed")}}async handleShare(){var e,t;try{const{result:i}=this.resources;if(!(null===(e=i[this.currentScanMode])||void 0===e?void 0:e.deskewedImageResult))throw new Error("No image result provided");const n=await i[this.currentScanMode].deskewedImageResult.toBlob("image/png");if(!n)throw new Error("Failed to convert image to blob");const a=new File([n],`ddls-${Date.now()}.png`,{type:n.type});if(navigator.share&&(null===(t=navigator.canShare)||void 0===t?void 0:t.call(navigator,{files:[a]})))await navigator.share({files:[a],title:"Dynamsoft Driver License Scanner Shared Image"});else{const e=URL.createObjectURL(n),t=document.createElement("a");t.href=e,t.download=a.name,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(e)}return!0}catch(e){if("AbortError"!==e.name){let t=(null==e?void 0:e.message)||e;console.error("Error sharing image:",t),alert(`Error sharing image: ${t}`)}}}async handleCorrectImage(){try{if(!this.correctionView)return void console.error("Correction View not initialized");this.hideView();const e=await this.correctionView.launch();e.deskewedImageResult&&(this.resources.onResultUpdated&&this.resources.onResultUpdated(Object.assign(Object.assign({},this.resources.result),{[this.currentScanMode]:{deskewedImageResult:e.deskewedImageResult,_imageData:e.deskewedImageResult}})),this.dispose(!0),await this.initialize(),o(this.config.container).style.display="flex")}catch(t){if(console.error("DriverLicenseImageResultView - Handle Correction View Error:",t),this.currentScanResultViewResolver){const i=(null==t?void 0:t.message)||t;console.error(i);const n={[e.EnumDriverLicenseScanSide.Front]:{status:{code:e.EnumResultStatus.RS_FAILED,message:i}},[e.EnumDriverLicenseScanSide.Back]:{status:{code:e.EnumResultStatus.RS_FAILED,message:i}},licenseData:{status:{code:e.EnumResultStatus.RS_FAILED,message:i}}};this.currentScanResultViewResolver(n)}throw t}}async handleCancel(){try{const t={[e.EnumDriverLicenseScanSide.Front]:{status:{code:e.EnumResultStatus.RS_CANCELLED,message:"Scan cancelled by user"}},[e.EnumDriverLicenseScanSide.Back]:{status:{code:e.EnumResultStatus.RS_CANCELLED,message:"Scan cancelled by user"}},licenseData:{status:{code:e.EnumResultStatus.RS_CANCELLED,message:"Scan cancelled by user"}}};this.resources.onResultUpdated&&this.resources.onResultUpdated(t),this.currentScanResultViewResolver&&this.currentScanResultViewResolver(t),this.hideView(),this.dispose()}catch(t){if(console.error("Error in cancel handler:",t),this.currentScanResultViewResolver){const i=(null==t?void 0:t.message)||t;console.error(i);const n={[e.EnumDriverLicenseScanSide.Front]:{status:{code:e.EnumResultStatus.RS_FAILED,message:i}},[e.EnumDriverLicenseScanSide.Back]:{status:{code:e.EnumResultStatus.RS_FAILED,message:i}},licenseData:{status:{code:e.EnumResultStatus.RS_FAILED,message:i}}};this.currentScanResultViewResolver(n)}throw t}}async handleDone(){var t,i;try{(null===(t=this.resources.result)||void 0===t?void 0:t.licenseData)&&!d(this.editedFields)&&(this.resources.result.licenseData=Object.assign(Object.assign({},this.resources.result.licenseData),this.editedFields),this.resources.onResultUpdated&&this.resources.onResultUpdated(this.resources.result)),(null===(i=this.config)||void 0===i?void 0:i.onDone)&&await this.config.onDone(this.resources.result),this.currentScanResultViewResolver&&this.resources.result&&this.currentScanResultViewResolver(this.resources.result),this.hideView(),this.dispose()}catch(t){const i=(null==t?void 0:t.message)||t;if(console.error(i),this.currentScanResultViewResolver){const t={[e.EnumDriverLicenseScanSide.Front]:{status:{code:e.EnumResultStatus.RS_FAILED,message:i}},[e.EnumDriverLicenseScanSide.Back]:{status:{code:e.EnumResultStatus.RS_FAILED,message:i}},licenseData:{status:{code:e.EnumResultStatus.RS_FAILED,message:i}}};this.currentScanResultViewResolver(t)}throw t}}handleFieldEdit(e,t){if(e===S.DateOfBirth||e===S.ExpiryDate||e===S.IssueDate)try{const[i,n,a]=t.split(/[\/\-\.]/);a&&n&&i&&(this.editedFields[e]={day:parseInt(a,10),month:parseInt(n,10),year:parseInt(i,10)})}catch(e){console.error("Error parsing date",e)}else this.editedFields[e]=t}createImagesDisplay(){var t,i,n,a;const s=document.createElement("div");s.className="ddls-images-container";const o=document.createElement("div");o.className="ddls-section-header",o.textContent="Captured Images",s.appendChild(o);const r=document.createElement("div");r.className="ddls-images-content";const{result:c}=this.resources;if(null===(t=c[e.EnumDriverLicenseScanSide.Front])||void 0===t?void 0:t.deskewedImageResult){const t=document.createElement("div");t.className="ddls-image-section";const n=document.createElement("div");n.className="ddls-image-label",n.textContent="Front Image:";const a=document.createElement("div");a.className="ddls-image-wrapper";const s=null===(i=c[e.EnumDriverLicenseScanSide.Front].deskewedImageResult)||void 0===i?void 0:i.toCanvas();Object.assign(s.style,{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}),a.appendChild(s),t.appendChild(n),t.appendChild(a),r.appendChild(t)}if(null===(n=c[e.EnumDriverLicenseScanSide.Back])||void 0===n?void 0:n.deskewedImageResult){const t=document.createElement("div");t.className="ddls-image-section";const i=document.createElement("div");i.className="ddls-image-label",i.textContent="Back Image:";const n=document.createElement("div");n.className="ddls-image-wrapper";const s=null===(a=c[e.EnumDriverLicenseScanSide.Back].deskewedImageResult)||void 0===a?void 0:a.toCanvas();Object.assign(s.style,{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}),n.appendChild(s),t.appendChild(i),t.appendChild(n),r.appendChild(t)}return s.appendChild(r),s}createDriverLicenseDataDisplay(){var t,i,n,a;const s=(null===(t=this.resources.result)||void 0===t?void 0:t.licenseData)||{},o=!!this.config.allowResultEditing,r=s.invalidFields||[],c=[S.InvalidFields,"status","flow","licenseVerificationStatus"],l=document.createElement("div");l.className="ddls-license-data-container";const u=document.createElement("div");u.className="ddls-section-header",u.textContent="Extracted Data",l.appendChild(u);const h=document.createElement("div");if(h.className="ddls-data-content",d(s)||(null===(i=s.status)||void 0===i?void 0:i.code)!==e.EnumResultStatus.RS_SUCCESS){const e=document.createElement("div");e.className="ddls-data-row empty",e.innerText=null!==(a=null===(n=this.config)||void 0===n?void 0:n.emptyResultMessage)&&void 0!==a?a:"The license information could not be detected. Please try again.",h.appendChild(e)}else{if(r.length>0){const e=document.createElement("div");e.className="ddls-error-notification",e.innerHTML=`\n        <div class="ddls-error-icon">${m.failed}</div>\n        <div class="ddls-error-message">\n          ${o?"Some fields require correction. Please review highlighted fields.":"Some fields contain invalid information. Please retake the scan."}\n        </div>\n      `,h.appendChild(e)}else if(0===r.length&&o){const e=document.createElement("div");e.className="ddls-info-notification",e.innerHTML=`\n        <div class="ddls-info-icon">${m.info}</div>\n        <div class="ddls-info-message">\n          Please review all fields to ensure the information is correct.\n        </div>\n      `,h.appendChild(e)}Object.entries(s).forEach((([e,t])=>{if(c.includes(e))return;const i=_.includes(e);if(!t&&!i)return;const n=document.createElement("div");n.className="ddls-data-row";const a=r.includes(e);a&&n.classList.add("invalid-field");const s=[S.LicenseType,S.Age,S.IssuingCountry],l=document.createElement("span");if(l.className="ddls-data-label",l.innerText=k[e]||e,a){const e=document.createElement("span");if(e.className="ddls-error-icon",e.innerHTML=m.failed,l.appendChild(e),o){const e=document.createElement("span");e.className="ddls-error-hint",e.textContent="Please correct this field",l.appendChild(e)}}const d=document.createElement("div");if(d.className="ddls-data-value",o&&!s.includes(e)){const s=document.createElement("input");if(s.className="ddls-data-input",a&&s.classList.add("invalid"),i){const e=t?M(t):"";s.value="N/A"===e?"":e,s.setAttribute("placeholder","YYYY-MM-DD")}else s.value=t||"";s.addEventListener("input",(t=>{if(this.handleFieldEdit(e,t.target.value),a){s.classList.remove("invalid"),n.classList.remove("invalid-field"),this.editedFields.invalidFields||(this.editedFields.invalidFields=[...r]);const t=this.editedFields.invalidFields.indexOf(e);t>-1&&this.editedFields.invalidFields.splice(t,1)}})),d.appendChild(s)}else d.innerText=i?t?M(t):"N/A":t||"N/A",a&&d.classList.add("invalid-value");n.appendChild(l),n.appendChild(d),h.appendChild(n)}))}return l.appendChild(h),l}createControls(){var e,t,i,n,a,s,o,c;const{toolbarButtonsConfig:l,onUpload:d}=this.config,u=new Blob(["mock-png-data"],{type:"image/png"}),h=new File([u],"test.png",{type:"image/png"});"share"in navigator&&navigator.canShare({files:[h]});return r([{id:"ddls-scanResult-cancel",icon:(null===(e=null==l?void 0:l.cancel)||void 0===e?void 0:e.icon)||m.cancel,label:(null===(t=null==l?void 0:l.cancel)||void 0===t?void 0:t.label)||"Cancel",onClick:()=>this.handleCancel(),className:`${(null===(i=null==l?void 0:l.cancel)||void 0===i?void 0:i.className)||""}`,isHidden:(null===(n=null==l?void 0:l.cancel)||void 0===n?void 0:n.isHidden)||!1,isDisabled:!1},{id:"ddls-scanResult-done",icon:(null===(a=null==l?void 0:l.done)||void 0===a?void 0:a.icon)||m.complete,label:(null===(s=null==l?void 0:l.done)||void 0===s?void 0:s.label)||"Done",className:`${(null===(o=null==l?void 0:l.done)||void 0===o?void 0:o.className)||""}`,isHidden:(null===(c=null==l?void 0:l.done)||void 0===c?void 0:c.isHidden)||!1,onClick:()=>this.handleDone()}])}getText(){const e=this.config.textConfig,t=$;return Object.assign(Object.assign({},t),e||{})}async initialize(){try{if(!this.resources.result)throw Error("Captured image is missing. Please capture an image first!");if(!this.config.container)throw new Error("Please create a Scan Result View Container element");l("ddls-result-view-style",Q);const e=document.createElement("div");e.className="ddls-result-view-container";const t=document.createElement("div");t.className="ddls-result-view-header",t.textContent=this.getText().title,e.appendChild(t);const i=document.createElement("div");if(i.className="ddls-content-container",!1!==this.config.showOriginalImages){const e=this.createImagesDisplay();i.appendChild(e)}const n=this.createDriverLicenseDataDisplay();i.appendChild(n),e.appendChild(i);const a=this.createControls();e.appendChild(a),o(this.config.container).appendChild(e)}catch(e){let t=(null==e?void 0:e.message)||e;console.error(t),alert(t)}}hideView(){o(this.config.container).style.display="none"}dispose(e=!1){o(this.config.container).textContent="",e||(this.currentScanResultViewResolver=void 0)}}const Q="\n  .ddls-result-view-container {\n    display: flex;\n    width: 100%;\n    height: 100%;\n    background-color: #575757;\n    font-size: 12px;\n    flex-direction: column;\n    align-items: center;\n  }\n\n  .ddls-result-view-header {\n    height: 3rem;\n    width: 100%;\n    background-color: #323234;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: white;\n    font-family: Verdana;\n    font-size: 18px;\n  }\n\n\n  .ddls-content-container {\n    box-sizing: border-box;\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n    width: 100%;\n    overflow-y: auto;\n    background-color: black;\n    gap: 1rem;\n    padding: 1rem 0.5rem;\n  }\n\n  .ddls-section-header {\n    background-color: #323234;\n    color: white;\n    font-family: Verdana;\n    font-size: 16px;\n    padding: 12px 2rem;\n    text-align: left;\n    border-radius: 0.5rem 0.5rem 0 0;\n  }\n\n  .ddls-images-container {\n    display: flex;\n    width: 100%;\n    background-color: #575757;\n    flex-direction: column;\n    border-radius: 0.5rem\n  }\n\n  .ddls-images-content {\n    display: flex;\n    flex-direction: column;\n    padding: 1rem 0;\n    gap: 1rem;\n  }\n\n  .ddls-image-section {\n    display: flex;\n    flex-direction: column;\n    padding: 0 1rem;\n  }\n\n  .ddls-image-label {\n    color: white;\n    font-family: Verdana;\n    font-size: 14px;\n    text-align: left;\n    margin-bottom: 0.5rem;\n  }\n\n  .ddls-image-wrapper {\n    flex: 1;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    min-height: 0;\n    background-color: #323234;\n    border-radius: 0.5rem;\n    max-width: 800px;\n    max-height: 504px;\n  }\n\n  .ddls-license-data-container {\n    font-size: 16px;\n    font-family: Verdana;\n    color: white;\n    width: 100%;\n    display: flex;\n    flex-direction: column;\n    border-radius: 0.5rem;\n    background-color: #575757;\n  }\n\n  .ddls-data-content {\n    flex: 1;\n    padding: 0.5rem 0;\n  }\n\n  .ddls-data-row {\n    padding: 0.5rem 2rem;\n    display: flex;\n    flex-direction: column;\n    gap: 0.5rem;\n    transition: background-color 0.3s ease;\n  }\n\n  .ddls-image-section {\n    padding:  0 2rem;\n  }\n\n  .ddls-data-row.invalid-field {\n    background-color: rgba(231, 76, 60, 0.1);\n    border-left: 3px solid #e74c3c;\n    padding-left: calc(2rem - 3px);\n  }\n\n  .ddls-data-label {\n    color: #aaa;\n    display: flex;\n    gap: 0.5rem;\n    align-items: end;\n    flex-wrap: wrap;\n  }\n\n  .ddls-error-notification,\n  .ddls-info-notification {\n    color: white;\n    padding: 1rem;\n    margin: 0.5rem 2rem;\n    border-radius: 4px;\n    display: flex;\n    align-items: center;\n    gap: 1rem;\n    text-align: start;\n  }\n\n  .ddls-error-notification {\n    background-color: rgba(231, 76, 60, 0.2);\n  }\n\n  .ddls-info-notification {\n    background-color: rgba(254, 142, 20, 0.2);\n    border: 1px solid #fe8e14;\n  }\n\n  .ddls-error-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: #e74c3c;\n  }\n\n  .ddls-info-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: #fe8e14;\n  }\n\n  .ddls-info-message,\n  .ddls-error-message {\n    flex: 1;\n  }\n\n  .ddls-error-hint {\n    font-size: 0.8rem;\n    color: #e74c3c;\n  }\n\n  .ddls-data-value {\n    word-wrap: break-word;\n    text-align: start;\n  }\n\n  .ddls-data-value.invalid-value {\n    color: #e74c3c;\n    text-decoration: wavy underline #e74c3c;\n    text-decoration-skip-ink: none;\n  }\n\n  .ddls-data-input {\n    width: 100%;\n    padding: 8px;\n    background-color: rgba(255, 255, 255, 0.1);\n    border: 1px solid rgba(255, 255, 255, 0.3);\n    color: white;\n    border-radius: 4px;\n    font-size: 14px;\n    transition: all 0.3s ease;\n  }\n\n  .ddls-data-input.invalid {\n    background-color: rgba(231, 76, 60, 0.1);\n    border-color: #e74c3c;\n  }\n\n  .ddls-data-input:focus {\n    background-color: rgba(255, 255, 255, 0.2);\n    border-color: #fe8e14;\n    outline: none;\n  }\n\n  .ddls-data-row.empty {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    height: 100%;\n    padding-top: 0;\n    padding-bottom: 0;\n    text-align: center;\n  }\n\n  @media (orientation: landscape) and (max-width: 1024px) {\n    .ddls-result-view-container {\n   flex-direction: row;\n  }\n\n    .ddls-images-content {\n      flex-direction: column;\n    }\n\n    .ddls-image-section:not(:last-child) {\n      border-right: none;\n      border-bottom: 1px solid #666;\n    }\n    \n    .ddls-license-data-container {\n      height: 100%;\n    }\n\n    .ddls-data-row:first-of-type {\n      padding-top: 1rem;\n    }\n\n    .ddls-data-row:last-of-type {\n      padding-bottom: 1rem;\n    }\n  }\n\n  @media (max-width: 600px) {\n    .ddls-image-wrapper {\n      justify-content: center;\n    }\n\n    .ddls-image-section {\n      padding:  0 1rem;\n    }\n    \n    .ddls-data-row {\n      padding: 0.5rem 1rem;\n    }\n    \n    .ddls-error-notification,\n    .ddls-info-notification {\n      margin: 1rem;\n      padding: 0.5rem;\n    }\n\n    .ddls-section-header {\n      font-size: 14px;\n      padding: 10px 1rem;\n    }\n  }\n";class K{constructor(t,i,n,a){this.resources=t,this.config=i,this.scannerView=n,this.correctionView=a,this.currentScanMode=e.EnumDriverLicenseScanSide.Front}getText(){var t;const i=null===(t=this.config.textConfig)||void 0===t?void 0:t[this.currentScanMode],n=this.currentScanMode===e.EnumDriverLicenseScanSide.Front?U:j;return Object.assign(Object.assign({},n),i||{})}getVerificationStatus(){var t,i,n,a;const s=null!==(n=null===(i=null===(t=this.config)||void 0===t?void 0:t._workflowConfig)||void 0===i?void 0:i.barcodeScanSide)&&void 0!==n?n:e.EnumDriverLicenseScanSide.Back;if(this.currentScanMode!==s)return{isVerified:!0,errorMessage:void 0};const o=null===(a=this.resources.result)||void 0===a?void 0:a.licenseData;return(null==o?void 0:o.licenseVerificationStatus)?{isVerified:o.licenseVerificationStatus.isVerified,errorMessage:o.licenseVerificationStatus.errorMessage}:{isVerified:!1,errorMessage:void 0}}hasBarcodeData(){var t,i,n,a,s;const o=null!==(n=null===(i=null===(t=this.config)||void 0===t?void 0:t._workflowConfig)||void 0===i?void 0:i.barcodeScanSide)&&void 0!==n?n:e.EnumDriverLicenseScanSide.Back;if(this.currentScanMode!==o)return!0;const r=null===(a=this.resources.result)||void 0===a?void 0:a.licenseData;return(null===(s=null==r?void 0:r.status)||void 0===s?void 0:s.code)===e.EnumResultStatus.RS_SUCCESS}async launch(t=e.EnumDriverLicenseScanSide.Front){try{return this.currentScanMode=t,o(this.config.container).textContent="",await this.initialize(),o(this.config.container).style.display="flex",new Promise((e=>{this.currentScanVerifyViewResolver=e}))}catch(e){let t=(null==e?void 0:e.message)||e;throw console.error(t),t}}async handleUploadAndShareBtn(e){var t,i;try{const{result:n}=this.resources;if(!(null===(t=n[this.currentScanMode])||void 0===t?void 0:t.deskewedImageResult))throw new Error("No image to upload");"upload"===e&&(null===(i=this.config)||void 0===i?void 0:i.onUpload)?await this.config.onUpload(n[this.currentScanMode]):"share"===e&&await this.handleShare()}catch(e){console.error("Error on upload/share:",e),alert("Failed")}}async handleShare(){var e,t;try{const{result:i}=this.resources;if(!(null===(e=i[this.currentScanMode])||void 0===e?void 0:e.deskewedImageResult))throw new Error("No image result provided");const n=await i[this.currentScanMode].deskewedImageResult.toBlob("image/png");if(!n)throw new Error("Failed to convert image to blob");const a=new File([n],`ddls-${Date.now()}.png`,{type:n.type});if(navigator.share&&(null===(t=navigator.canShare)||void 0===t?void 0:t.call(navigator,{files:[a]})))await navigator.share({files:[a],title:"Dynamsoft Driver License Scanner Shared Image"});else{const e=URL.createObjectURL(n),t=document.createElement("a");t.href=e,t.download=a.name,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(e)}return!0}catch(e){if("AbortError"!==e.name){let t=(null==e?void 0:e.message)||e;console.error("Error sharing image:",t),alert(`Error sharing image: ${t}`)}}}async handleCorrectImage(){try{if(!this.correctionView)return void console.error("Correction View not initialized");this.hideView();const e=await this.correctionView.launch();e.deskewedImageResult&&(this.resources.onResultUpdated&&this.resources.onResultUpdated(Object.assign(Object.assign({},this.resources.result),{[this.currentScanMode]:{deskewedImageResult:e.deskewedImageResult,_imageData:e.deskewedImageResult}})),this.dispose(!0),await this.initialize(),o(this.config.container).style.display="flex")}catch(t){throw console.error("DriverLicenseverifyView - Handle Correction View Error:",t),this.currentScanVerifyViewResolver&&this.currentScanVerifyViewResolver({status:{code:e.EnumResultStatus.RS_FAILED,message:(null==t?void 0:t.message)||t}}),t}}async handleRetake(){var t;try{if(!this.scannerView)return void console.error("Scanner View not initialized");this.hideView();const i=await this.scannerView.launch(this.currentScanMode);if((null===(t=null==i?void 0:i.status)||void 0===t?void 0:t.code)===e.EnumResultStatus.RS_FAILED)return void(this.currentScanVerifyViewResolver&&this.currentScanVerifyViewResolver(i));this.resources.onResultUpdated&&((null==i?void 0:i.status.code)===e.EnumResultStatus.RS_CANCELLED?this.resources.onResultUpdated(this.resources.result):(null==i?void 0:i.status.code)===e.EnumResultStatus.RS_SUCCESS&&this.resources.onResultUpdated(Object.assign(Object.assign({},this.resources.result),{[this.currentScanMode]:i}))),this.correctionView&&(null==i?void 0:i._flowType)&&c(null==i?void 0:i._flowType)&&await this.handleCorrectImage(),this.dispose(!0),await this.initialize(),o(this.config.container).style.display="flex"}catch(t){throw console.error("Error in retake handler:",t),this.currentScanVerifyViewResolver&&this.currentScanVerifyViewResolver({status:{code:e.EnumResultStatus.RS_FAILED,message:(null==t?void 0:t.message)||t}}),t}}async handleDone(){var t;try{if(!this.getVerificationStatus().isVerified)return console.warn("Cannot proceed - barcode verification failed"),void alert("Failed to read information. Please retake.");(null===(t=this.config)||void 0===t?void 0:t.onDone)&&await this.config.onDone(this.resources.result[this.currentScanMode]),this.currentScanVerifyViewResolver&&this.resources.result[this.currentScanMode]&&this.currentScanVerifyViewResolver(this.resources.result[this.currentScanMode]),this.hideView(),this.dispose()}catch(t){throw console.error("Error in done handler:",t),this.currentScanVerifyViewResolver&&this.currentScanVerifyViewResolver({status:{code:e.EnumResultStatus.RS_FAILED,message:(null==t?void 0:t.message)||t}}),t}}createControls(){var e,t,i,n,a,s,o,c;const{toolbarButtonsConfig:l,onUpload:d}=this.config,u=this.getVerificationStatus(),h=new Blob(["mock-png-data"],{type:"image/png"}),g=new File([h],"test.png",{type:"image/png"});"share"in navigator&&navigator.canShare({files:[g]});return r([{id:"ddls-scanVerify-retake",icon:(null===(e=null==l?void 0:l.retake)||void 0===e?void 0:e.icon)||m.retake,label:(null===(t=null==l?void 0:l.retake)||void 0===t?void 0:t.label)||"Re-take",onClick:()=>this.handleRetake(),className:`${(null===(i=null==l?void 0:l.retake)||void 0===i?void 0:i.className)||""}`,isHidden:(null===(n=null==l?void 0:l.retake)||void 0===n?void 0:n.isHidden)||!1,isDisabled:!this.scannerView},{id:"ddls-scanVerify-done",icon:(null===(a=null==l?void 0:l.done)||void 0===a?void 0:a.icon)||m.complete,label:(null===(s=null==l?void 0:l.done)||void 0===s?void 0:s.label)||"Done",className:`${(null===(o=null==l?void 0:l.done)||void 0===o?void 0:o.className)||""} ${u.isVerified?"":"ddls-disabled-button"}`,isHidden:(null===(c=null==l?void 0:l.done)||void 0===c?void 0:c.isHidden)||!1,isDisabled:!u.isVerified,onClick:()=>this.handleDone()}])}async initialize(){var e;try{if(!this.resources.result)throw Error("Captured image is missing. Please capture an image first!");if(!this.config.container)throw new Error("Please create a Scan Verify View Container element");l("ddls-verify-view-style",J);const t=document.createElement("div");t.className="ddls-verify-view-container";const i=document.createElement("div");i.className="ddls-verify-header",i.textContent=this.getText().title;const n=document.createElement("div");n.className="ddls-verify-image-container",n.appendChild(i);const a=null===(e=this.resources.result[this.currentScanMode].deskewedImageResult)||void 0===e?void 0:e.toCanvas();Object.assign(a.style,{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"});const s=this.getVerificationStatus(),r=(this.hasBarcodeData(),document.createElement("div"));r.className="ddls-verify-message "+(s.isVerified?"":"ddls-error-message"),s.isVerified?r.textContent=this.getText().hintVerify:r.textContent=s.errorMessage||this.getText().barcodeNotFound,n.appendChild(r),n.appendChild(a),t.appendChild(n);const c=this.createControls();t.appendChild(c),o(this.config.container).appendChild(t)}catch(e){let t=(null==e?void 0:e.message)||e;console.error(t),alert(t)}}hideView(){o(this.config.container).style.display="none"}dispose(e=!1){o(this.config.container).textContent="",e||(this.currentScanVerifyViewResolver=void 0)}}const J="\n  .ddls-verify-view-container {\n    display: flex;\n    width: 100%;\n    height: 100%;\n    background-color:#575757;\n    font-size: 12px;\n    flex-direction: column;\n    align-items: center;\n  }\n\n  .ddls-verify-header {\n    position: absolute;\n    top: 0;\n    height: 3rem;\n    width: 100%;\n    background-color: #323234;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: white;\n    font-family: Verdana;\n    font-size: 18px;\n    z-index: 10;\n    box-sizing: border-box;\n  }\n\n  .ddls-verify-message{\n    position: absolute;\n    left: 50%;\n    transform: translateX(-50%);\n    top: 5rem;\n    font-family: Verdana;\n    padding: 0.5rem;\n    user-select: none;\n    color: black;\n    font-size: 14px;\n    border-radius: 8px;\n    background-color: rgba(255, 255, 255, 0.8);\n    text-align: center;\n    width: max-content;\n  }\n\n  .ddls-error-message {\n    background-color: rgba(255, 0, 0, 0.8);\n    color: white;\n  }\n\n  .ddls-disabled-button {\n    opacity: 0.5;\n    cursor: not-allowed;\n    pointer-events: none;\n  }\n\n  .ddls-verify-image-container {\n    width: 100%;\n    height: 100%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    min-height: 0;\n    position: relative;\n    padding-top: 3rem;\n    box-sizing: border-box;\n  }\n\n  @media (orientation: landscape) and (max-width: 1024px) {\n    .ddls-verify-view-container {\n      flex-direction: row;\n    }\n    \n    .ddls-verify-view-container div canvas {\n      max-height: 80% !important;\n    }\n  \n    .ddls-verify-message{\n      top: 0.5rem;\n      border: none;\n      background-color: transparent;\n      color: white;\n    }\n\n    .ddls-error-message {\n      color: #ffabab;\n    }\n\n    .ddls-verify-header{\n      display: none; \n    }\n\n    .ddls-verify-image-container{\n      padding-top: 1rem;\n    }\n  }\n",X={rootDirectory:"https://cdn.jsdelivr.net/npm/"};class ee{showLoadingOverlay(e){var t,i,n;const a=o(null===(t=this.config.scannerViewConfig)||void 0===t?void 0:t.container)||o(null===(i=this.config.verifyViewConfig)||void 0===i?void 0:i.container)||o(null===(n=this.config.resultViewConfig)||void 0===n?void 0:n.container);this.loadingScreen=O(a,{message:e}),a.style.display="block",a.style.position="relative"}hideLoadingOverlay(e=!1){var t,i,n,a;const s=o(null===(t=this.config.scannerViewConfig)||void 0===t?void 0:t.container)||o(null===(i=this.config.verifyViewConfig)||void 0===i?void 0:i.container)||o(null===(n=this.config.resultViewConfig)||void 0===n?void 0:n.container);this.loadingScreen&&(this.loadingScreen.hide(),this.loadingScreen=null,s.style.display="none",e&&(null===(a=this.config)||void 0===a?void 0:a.container)&&(o(this.config.container).style.display="none"))}constructor(t){this.config=t,this.fullResult={[e.EnumDriverLicenseScanSide.Front]:null,[e.EnumDriverLicenseScanSide.Back]:null},this.resources={},this.isInitialized=!1,this.isCapturing=!1,this.isDynamsoftResourcesLoaded=!1,this.isFileMode=!1,this.currentScanStep=0,this.scanSequence=[],this.loadingScreen=null,this.isDynamsoftResourcesLoaded||(this.initializeDDLSConfig(),this.initializeDynamsoftResources())}initializeDynamsoftResources(){var e;t.CoreModule.engineResourcePaths=d(null===(e=this.config)||void 0===e?void 0:e.engineResourcePaths)?X:this.config.engineResourcePaths,t.CoreModule.loadWasm();const{readBarcode:i}=this.config.workflowConfig,n=i;t.CoreModule.loadWasm(),n&&(t.CodeParserModule.loadSpec("AAMVA_DL_ID"),t.CodeParserModule.loadSpec("AAMVA_DL_ID_WITH_MAG_STRIPE"),t.CodeParserModule.loadSpec("SOUTH_AFRICA_DL")),this.isDynamsoftResourcesLoaded=!0}async initializeDCVResources(){var e,i;try{this.isDynamsoftResourcesLoaded||this.initializeDynamsoftResources(),t.LicenseManager._onAuthMessage=e=>e.replace("(https://www.dynamsoft.com/customer/license/trialLicense?product=unknown&deploymenttype=unknown)","(https://www.dynamsoft.com/customer/license/trialLicense?product=ddls&deploymenttype=web)"),t.LicenseManager.initLicense((null===(e=this.config)||void 0===e?void 0:e.license)||"",{executeNow:!0}),this.isFileMode||(this.resources.cameraView=await t.CameraView.createInstance(null===(i=this.config.scannerViewConfig)||void 0===i?void 0:i.uiPath),this.resources.cameraEnhancer=await t.CameraEnhancer.createInstance(this.resources.cameraView)),this.resources.cvRouter=await t.CaptureVisionRouter.createInstance(),await this.resources.cvRouter.initSettings(this.config.templateFilePath),this.resources.cvRouter.maxImageSideLength=1/0}catch(e){let t=(null==e?void 0:e.message)||e;const i=(null==t?void 0:t.toLowerCase().includes("license"))?"The license for the Driver License Scanner is no longer valid or has expired. Please contact the site administrator to resolve this issue.":`Resource Initialization Failed: ${t}`;throw console.error(i),new Error(i)}}async initialize(){if(this.isInitialized)return{resources:this.resources,components:{scannerView:this.scannerView,correctionView:this.correctionView,scanVerifyView:this.scanVerifyView,scanResultView:this.scanResultView}};try{if(!this.initializeDDLSConfig())return console.error("Failed to initialize driver license scanner config"),{resources:this.resources,components:{}};l("dynamsoft-ddls-loading-screen-style",B),this.showLoadingOverlay("Loading..."),await this.initializeDCVResources(),this.resources.onResultUpdated=e=>{var t;this.resources.result=Object.assign(Object.assign({},(null===(t=this.resources)||void 0===t?void 0:t.result)||{}),e)};const e={};return this.config.scannerViewConfig&&(this.scannerView=new Z(this.resources,this.config.scannerViewConfig),e.scannerView=this.scannerView,await this.scannerView.initialize()),this.config.correctionViewConfig&&(this.correctionView=new T(this.resources,this.config.correctionViewConfig),e.correctionView=this.correctionView),this.config.verifyViewConfig&&(this.scanVerifyView=new K(this.resources,this.config.verifyViewConfig,this.scannerView,this.correctionView),e.scanVerifyView=this.scanVerifyView),this.config.resultViewConfig&&(this.scanResultView=new Y(this.resources,this.config.resultViewConfig,this.scannerView,this.correctionView),e.scanResultView=this.scanResultView),this.isInitialized=!0,{resources:this.resources,components:e}}catch(e){this.isInitialized=!1;let t=(null==e?void 0:e.message)||e;throw new Error(`Initialization Failed: ${t}`)}finally{this.hideLoadingOverlay(!0)}}shouldCreateDefaultContainer(){var e,t,i;const n=!this.config.container,a=!((null===(e=this.config.scannerViewConfig)||void 0===e?void 0:e.container)||(null===(t=this.config.resultViewConfig)||void 0===t?void 0:t.container)||(null===(i=this.config.correctionViewConfig)||void 0===i?void 0:i.container));return n&&a}createDefaultDDLSContainer(){const e=document.createElement("div");return e.className="ddls-main-container",Object.assign(e.style,{display:"none",height:"100dvh",width:"100%",position:"absolute",left:"0",top:"0",zIndex:"999"}),document.body.append(e),e}checkForTemporaryLicense(e){return!(null==e?void 0:e.length)||(null==e?void 0:e.startsWith("A"))||(null==e?void 0:e.startsWith("L"))||(null==e?void 0:e.startsWith("P"))||(null==e?void 0:e.startsWith("Y"))?"DLS2eyJvcmdhbml6YXRpb25JRCI6IjIwMDAwMSJ9":e}validateViewConfigs(){var e,t,i,n,a,s,r,c;if(!this.config.container){if(this.config.showCorrectionView&&!(null===(e=this.config.correctionViewConfig)||void 0===e?void 0:e.container)){const e="CorrectionView container is required when showCorrectionView is true and no main container is provided";return alert(e),console.error(e),!1}if(this.config.showResultView&&!(null===(t=this.config.resultViewConfig)||void 0===t?void 0:t.container)){const e="ResultView container is required when showResultView is true and no main container is provided";return alert(e),console.error(e),!1}}try{if(this.config.container&&!o(this.config.container)){const e="Invalid main container reference";return alert(e),console.error(e),!1}if((null===(i=this.config.scannerViewConfig)||void 0===i?void 0:i.container)&&!o(null===(n=this.config.scannerViewConfig)||void 0===n?void 0:n.container)){const e="Invalid scanner view container reference";return alert(e),console.error(e),!1}if((null===(a=this.config.correctionViewConfig)||void 0===a?void 0:a.container)&&!o(null===(s=this.config.correctionViewConfig)||void 0===s?void 0:s.container)){const e="Invalid correction view container reference";return alert(e),console.error(e),!1}if((null===(r=this.config.resultViewConfig)||void 0===r?void 0:r.container)&&!o(null===(c=this.config.resultViewConfig)||void 0===c?void 0:c.container)){const e="Invalid result view container reference";return alert(e),console.error(e),!1}}catch(e){const t=`Error accessing container references: ${e.message}`;return alert(t),console.error(t),!1}return!0}showCorrectionView(){var e,t;return!1!==this.config.showCorrectionView&&(this.config.container?!(void 0!==this.config.showCorrectionView||!(null===(e=this.config.correctionViewConfig)||void 0===e?void 0:e.container)&&!this.config.container)||!!this.config.showCorrectionView:this.config.showCorrectionView&&!!(null===(t=this.config.correctionViewConfig)||void 0===t?void 0:t.container))}showVerifyView(){var e,t;return!1!==this.config.showVerifyView&&(this.config.container?!(void 0!==this.config.showVerifyView||!(null===(e=this.config.verifyViewConfig)||void 0===e?void 0:e.container)&&!this.config.container)||!!this.config.showVerifyView:this.config.showVerifyView&&!!(null===(t=this.config.verifyViewConfig)||void 0===t?void 0:t.container))}showResultView(){var e,t;return!1!==this.config.showResultView&&(this.config.container?!(void 0!==this.config.showResultView||!(null===(e=this.config.resultViewConfig)||void 0===e?void 0:e.container)&&!this.config.container)||!!this.config.showResultView:this.config.showResultView&&!!(null===(t=this.config.resultViewConfig)||void 0===t?void 0:t.container))}validateWorkflowConfig(e){const{captureFrontImage:t,captureBackImage:i,readBarcode:n}=e;if(!t&&!i&&!n){const e="Invalid workflow configuration: At least one capture mode must be enabled";return alert(e),console.error(e),!1}return!0}buildScanSequence(t){const{captureFrontImage:i,captureBackImage:n,scanOrder:a}=t;this.scanSequence=[];const s=a||[e.EnumDriverLicenseScanSide.Front,e.EnumDriverLicenseScanSide.Back];for(const t of s)t===e.EnumDriverLicenseScanSide.Front&&i&&this.scanSequence.push({side:e.EnumDriverLicenseScanSide.Front,mode:g.Image}),t===e.EnumDriverLicenseScanSide.Back&&n&&this.scanSequence.push({side:e.EnumDriverLicenseScanSide.Back,mode:g.Image})}initializeDDLSConfig(){var t,i,n,a,s,r,c,l,d,u;this.config=null!==(t=this.config)&&void 0!==t?t:{},this.config.workflowConfig=Object.assign({captureFrontImage:!0,captureBackImage:!0,readBarcode:!0,barcodeScanSide:e.EnumDriverLicenseScanSide.Back,scanOrder:[e.EnumDriverLicenseScanSide.Front,e.EnumDriverLicenseScanSide.Back],enableBarcodeVerification:!1,exitOnBarcodeVerificationFailure:!1,allowRetryOnVerificationFailure:!0},this.config.workflowConfig);if(!this.validateWorkflowConfig(this.config.workflowConfig))return!1;if(!this.validateViewConfigs())return!1;this.buildScanSequence(this.config.workflowConfig),this.config.showCorrectionView=!1,this.shouldCreateDefaultContainer()?this.config.container=this.createDefaultDDLSContainer():this.config.container&&(this.config.container=o(this.config.container));const h=this.config.container?this.createViewContainers(o(this.config.container)):{},m={license:this.checkForTemporaryLicense(this.config.license),utilizedTemplateNames:{detect:(null===(i=this.config.utilizedTemplateNames)||void 0===i?void 0:i.detect)||p,normalize:(null===(n=this.config.utilizedTemplateNames)||void 0===n?void 0:n.normalize)||w,barcode:(null===(a=this.config.utilizedTemplateNames)||void 0===a?void 0:a.barcode)||C},templateFilePath:(null===(s=this.config)||void 0===s?void 0:s.templateFilePath)||"../dist/ddls.template.json"},g=Object.assign(Object.assign({},this.config.scannerViewConfig),{container:h[v.Scanner]||(null===(r=this.config.scannerViewConfig)||void 0===r?void 0:r.container)||null,uiPath:(null===(c=this.config.scannerViewConfig)||void 0===c?void 0:c.uiPath)||"../dist/ddls.ui.html",templateFilePath:m.templateFilePath,utilizedTemplateNames:m.utilizedTemplateNames,_showCorrectionView:this.showCorrectionView(),_workflowConfig:this.config.workflowConfig}),f=this.showCorrectionView()?Object.assign(Object.assign({},this.config.correctionViewConfig),{container:h[v.Correction]||(null===(l=this.config.correctionViewConfig)||void 0===l?void 0:l.container)||null,templateFilePath:m.templateFilePath,utilizedTemplateNames:m.utilizedTemplateNames,_showResultView:this.showResultView()}):void 0,S=this.showVerifyView()?Object.assign(Object.assign({},this.config.verifyViewConfig),{container:h[v.Verify]||(null===(d=this.config.verifyViewConfig)||void 0===d?void 0:d.container)||null,_workflowConfig:this.config.workflowConfig}):void 0,y=this.showResultView()?Object.assign(Object.assign({},this.config.resultViewConfig),{container:h[v.Result]||(null===(u=this.config.resultViewConfig)||void 0===u?void 0:u.container)||null}):void 0;return Object.assign(this.config,Object.assign(Object.assign({},m),{scannerViewConfig:g,correctionViewConfig:f,verifyViewConfig:S,resultViewConfig:y})),!0}createViewContainers(e){e.textContent="";const t=[v.Scanner];return this.showCorrectionView()&&t.push(v.Correction),this.showVerifyView()&&t.push(v.Verify),this.showResultView()&&t.push(v.Result),t.reduce(((t,i)=>{const n=document.createElement("div");return n.className=`ddls-${i}-view-container`,Object.assign(n.style,{height:"100%",width:"100%",display:"none",position:"relative"}),e.append(n),t[i]=n,t}),{})}dispose(){var e,t,i,n;this.scanResultView&&(this.scanResultView.dispose(),this.scanResultView=null),this.scanVerifyView&&(this.scanVerifyView.dispose(),this.scanVerifyView=null),this.correctionView&&(this.correctionView.dispose(),this.correctionView=null),this.scannerView=null,this.resources.cameraEnhancer&&(this.resources.cameraEnhancer.dispose(),this.resources.cameraEnhancer=null),this.resources.cameraView&&(this.resources.cameraView.dispose(),this.resources.cameraView=null),this.resources.cvRouter&&(this.resources.cvRouter.dispose(),this.resources.cvRouter=null),this.resources.result=null,this.resources.onResultUpdated=null;const a=e=>{const t=o(e);t&&(t.style.display="none",t.textContent="")};a(this.config.container),a(null===(e=this.config.scannerViewConfig)||void 0===e?void 0:e.container),a(null===(t=this.config.correctionViewConfig)||void 0===t?void 0:t.container),a(null===(i=this.config.verifyViewConfig)||void 0===i?void 0:i.container),a(null===(n=this.config.resultViewConfig)||void 0===n?void 0:n.container),this.isInitialized=!1}async executeCurrentScanStep(t){const i=this.scanSequence[this.currentScanStep];if(!i)return{status:{code:e.EnumResultStatus.RS_SUCCESS,message:"All scan steps completed"}};if(i.mode===g.Image){const n=i.side===e.EnumDriverLicenseScanSide.Front?e.EnumDriverLicenseScanSide.Front:e.EnumDriverLicenseScanSide.Back,a=await t.scannerView.launch(n,i.mode);return console.log(a),(null==a?void 0:a.status.code)===e.EnumResultStatus.RS_SUCCESS&&(this.fullResult[n]=a,this.resources.onResultUpdated&&(console.log(Object.assign(Object.assign({},this.resources.result),this.fullResult)),this.resources.onResultUpdated(Object.assign(Object.assign({},this.resources.result),this.fullResult)))),a}return{status:{code:e.EnumResultStatus.RS_FAILED,message:"Unknown scan mode"}}}createErrorResult(t){return{[e.EnumDriverLicenseScanSide.Front]:{status:{code:e.EnumResultStatus.RS_FAILED,message:t}},[e.EnumDriverLicenseScanSide.Back]:{status:{code:e.EnumResultStatus.RS_FAILED,message:t}},licenseData:{status:{code:e.EnumResultStatus.RS_FAILED,message:t}}}}async launch(){if(this.isCapturing){const e="Capture session already in progress";return alert(e),console.error(e),this.createErrorResult(e)}try{this.isCapturing=!0;const{components:t}=await this.initialize();if(d(t))throw new Error("Driver License Scanner initialization failed");if(this.config.container&&(o(this.config.container).style.display="block"),!t.scannerView)throw new Error("Scanner view is required for capture operations");for(this.currentScanStep=0;this.currentScanStep<this.scanSequence.length;)try{const i=this.scanSequence[this.currentScanStep],n=await this.executeCurrentScanStep(t);if((null==n?void 0:n.status.code)!==e.EnumResultStatus.RS_SUCCESS){if((null==n?void 0:n.status.code)===e.EnumResultStatus.RS_CANCELLED)return console.log("Scan cancelled by user"),this.fullResult;console.error("Image capture step failed, stopping workflow");break}if(console.log(`Step ${this.currentScanStep+1} completed successfully`),i.mode===g.Image&&(null==n?void 0:n.status.code)===e.EnumResultStatus.RS_SUCCESS&&(t.correctionView&&c(n._flowType)&&await t.correctionView.launch(),t.scanVerifyView)){const n=i.side===e.EnumDriverLicenseScanSide.Front?e.EnumDriverLicenseScanSide.Front:e.EnumDriverLicenseScanSide.Back;await t.scanVerifyView.launch(n)}this.currentScanStep++}catch(e){throw console.error(`Critical error in step ${this.currentScanStep+1}:`,e),e}return t.scanResultView&&(console.log("Launching result view with final results:",this.fullResult),this.showLoadingOverlay("Preparing results..."),await new Promise((e=>setTimeout(e,400))),this.hideLoadingOverlay(),await t.scanResultView.launch()),console.log("Scan workflow completed successfully"),this.fullResult}catch(e){this.hideLoadingOverlay();const t=`Driver license capture flow failed. ${(null==e?void 0:e.message)||e}`;return alert(t),console.error("Driver license capture flow failed:",(null==e?void 0:e.message)||e),this.createErrorResult(t)}finally{this.isCapturing=!1,this.hideLoadingOverlay(),this.dispose()}}}const te={DriverLicenseScanner:ee,DriverLicenseNormalizerView:T,DriverLicenseScannerView:Z,DriverLicenseResultView:Y,EnumResultStatus:e.EnumResultStatus,EnumFlowType:a,EnumDriverLicenseScannerViews:v,EnumDriverLicenseScanSide:e.EnumDriverLicenseScanSide};e.Dynamsoft=s,e.DDLS=te,e.DriverLicenseNormalizerView=T,e.DriverLicenseResultView=Y,e.DriverLicenseScanner=ee,e.DriverLicenseScannerView=Z}));
