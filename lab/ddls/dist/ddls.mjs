/*!
* Dynamsoft Driver License Scanner JavaScript Library
* @product Dynamsoft Driver License Scanner JS Edition Bundle
* @website http://www.dynamsoft.com
* @copyright Copyright 2025, Dynamsoft Corporation
* @author Dynamsoft
* @version 2.0.0
* @fileoverview Dynamsoft Driver License Scanner is a ready-to-use SDK for capturing and enhancing document images with automatic border detection, correction, and customizable workflows. Uses Dynamsoft Capture Vision Bundle v2.6.1000.
* More info on Dynamsoft Driver License Scanner JS: https://www.dynamsoft.com/capture-vision/docs/web/programming/javascript/
*/
import{ImageEditorView as e,DrawingStyleManager as t,CapturedResultReceiver as n,EnumCapturedResultItemType as i,EnumImagePixelFormat as o,CoreModule as a,CodeParserModule as s,LicenseManager as r,CameraView as l,CameraEnhancer as c,CaptureVisionRouter as d}from"dynamsoft-capture-vision-bundle";import*as h from"dynamsoft-capture-vision-bundle";export{h as Dynamsoft};var u,g;function m(e){if("string"==typeof e){const t=document.querySelector(e);if(!t)throw new Error("Element not found");return t}return e instanceof HTMLElement?e:null}!function(e){e[e.RS_SUCCESS=0]="RS_SUCCESS",e[e.RS_CANCELLED=1]="RS_CANCELLED",e[e.RS_FAILED=2]="RS_FAILED"}(u||(u={})),function(e){e.MANUAL="manual",e.SMART_CAPTURE="smartCapture",e.AUTO_CROP="autoCrop",e.UPLOADED_IMAGE="uploadedImage",e.STATIC_FILE="staticFile"}(g||(g={}));function f(e,t){w("ddls-controls-style","\n  .ddls-controls {\n    display: flex;\n    height: 8rem;\n    background-color: #323234;\n    align-items: center;\n    font-size: 12px;\n    font-family: Verdana;\n    color: white;\n    width: 100%;\n  }\n\n  .ddls-control-btn {\n    background-color: #323234;\n    color: white;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    flex-direction: column;\n    height: 100%;\n    width: 100%;\n    gap: 0.5rem;\n    text-align: center;\n    user-select: none;\n  }\n\n  .ddls-control-btn.hide {\n    display: none;\n  }\n\n  .ddls-control-btn.disabled {\n    opacity: 0.4;\n    pointer-events: none;\n    cursor: default;\n  }\n\n  .ddls-control-icon-wrapper {\n    flex: 0.75;\n    display: flex;\n    align-items: flex-end;\n    justify-content: center;\n    min-height: 40px;\n  }\n\n  .ddls-control-icon img,\n  .ddls-control-icon svg {\n    width: 32px;\n    height: 32px;\n    fill: #fe8e14;\n  }\n\n  .ddls-control-text {\n    flex: 0.5;\n    display: flex;\n    align-items: flex-start;\n    justify-content: center;\n  }\n\n  @media (orientation: landscape) and (max-width: 1024px) {\n    .ddls-controls {\n      flex-direction: column;\n      height: 100%;\n      width: 8rem;\n    }\n  }\n");const n=document.createElement("div");return n.className="ddls-controls",e.forEach((e=>{const t=document.createElement("div");t.className=`ddls-control-btn ${null==e?void 0:e.className}`;const i=document.createElement("div");if(i.className="ddls-control-icon-wrapper",(o=e.icon).trim().startsWith("<svg")&&o.trim().endsWith("</svg>"))i.innerHTML=e.icon;else{const t=document.createElement("img");t.src=e.icon,t.alt=e.label,t.width=24,t.height=24,i.appendChild(t)}var o;const a=document.createElement("div");a.className="ddls-control-text",a.textContent=e.label,e.isDisabled&&t.classList.add("disabled"),e.isHidden&&t.classList.add("hide"),t.appendChild(i),t.appendChild(a),e.onClick&&!e.isDisabled&&t.addEventListener("click",e.onClick),n.appendChild(t)})),n}function p(e){return[g.SMART_CAPTURE,g.UPLOADED_IMAGE,g.MANUAL].includes(e)}function w(e,t){if(!document.getElementById(e)){const n=document.createElement("style");n.id=e,n.textContent=t,document.head.appendChild(n)}}const v=e=>!e||0===Object.keys(e).length,C={"4k":{width:3840,height:2160},"2k":{width:2560,height:1440},"1080p":{width:1920,height:1080},"720p":{width:1280,height:720},"480p":{width:640,height:480}};const y=(e,t,n=15)=>{const i=e.reduce(((e,t)=>(e.x+=t.x,e.y+=t.y,e)),{x:0,y:0});i.x/=e.length,i.y/=e.length;const o=e.map((e=>{const t=e.x-i.x,o=e.y-i.y,a=Math.sqrt(t**2+o**2),s=t/a,r=o/a;return{x:e.x+n*s,y:e.y+n*r}}));return o.some((e=>(e=>e.x<0||e.x>t.width||e.y<0||e.y>t.height)(e)))?e:o},S={fullImage:'\n  <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="25" viewBox="0 0 25 25">\n  <defs>\n    <clipPath id="fullImageclip-path">\n      <rect id="Rectangle_2776" data-name="Rectangle 2776" width="25" height="25" fill="#fff"/>\n    </clipPath>\n  </defs>\n  <g id="full-image" transform="translate(0 0)">\n    <g id="Group_586" data-name="Group 586" transform="translate(0 0)" clip-path="url(#fullImageclip-path)">\n      <path id="Path_1528" data-name="Path 1528" d="M.621,3.618A.621.621,0,0,0,1.242,3V1.809a.569.569,0,0,1,.567-.567H3A.621.621,0,0,0,3,0H1.809A1.811,1.811,0,0,0,0,1.809V3a.621.621,0,0,0,.621.621" transform="translate(0 0)" fill="#fff"/>\n      <path id="Path_1529" data-name="Path 1529" d="M17.842,1.242H19.03a.568.568,0,0,1,.566.567V3a.621.621,0,1,0,1.242,0V1.809A1.811,1.811,0,0,0,19.03,0H17.842a.621.621,0,0,0,0,1.242" transform="translate(4.162 0)" fill="#fff"/>\n      <path id="Path_1530" data-name="Path 1530" d="M9.562,0H5.4a.621.621,0,0,0,0,1.242H9.562A.621.621,0,0,0,9.562,0" transform="translate(1.156 0)" fill="#fff"/>\n      <path id="Path_1531" data-name="Path 1531" d="M11.623,1.242h4.158a.621.621,0,0,0,0-1.242H11.623a.621.621,0,0,0,0,1.242" transform="translate(2.659 0)" fill="#fff"/>\n      <path id="Path_1532" data-name="Path 1532" d="M3,19.6H1.808a.568.568,0,0,1-.566-.567V17.841a.621.621,0,1,0-1.242,0v1.188a1.81,1.81,0,0,0,1.808,1.809H3A.621.621,0,0,0,3,19.6" transform="translate(0 4.161)" fill="#fff"/>\n      <path id="Path_1533" data-name="Path 1533" d="M9.562,19.134H5.4a.621.621,0,1,0,0,1.242H9.562a.621.621,0,1,0,0-1.242" transform="translate(1.156 4.624)" fill="#fff"/>\n      <path id="Path_1534" data-name="Path 1534" d="M.621,10.183a.621.621,0,0,0,.621-.621V5.4A.621.621,0,0,0,0,5.4V9.562a.621.621,0,0,0,.621.621" transform="translate(0 1.156)" fill="#fff"/>\n      <path id="Path_1535" data-name="Path 1535" d="M.621,16.4a.621.621,0,0,0,.621-.621V11.624a.621.621,0,1,0-1.242,0v4.157a.621.621,0,0,0,.621.621" transform="translate(0 2.659)" fill="#fff"/>\n      <path id="Path_1536" data-name="Path 1536" d="M20.376,5.4a.621.621,0,1,0-1.242,0V9.563a.621.621,0,1,0,1.242,0Z" transform="translate(4.624 1.156)" fill="#fff"/>\n      <path id="Path_1537" data-name="Path 1537" d="M20.217,17.221a.621.621,0,0,0-.621.621V19.03a.568.568,0,0,1-.567.566H17.841a.621.621,0,1,0,0,1.242h1.188a1.811,1.811,0,0,0,1.809-1.808V17.842a.621.621,0,0,0-.621-.621" transform="translate(4.162 4.162)" fill="#fff"/>\n      <path id="Path_1538" data-name="Path 1538" d="M15.781,19.134H11.623a.621.621,0,1,0,0,1.242h4.158a.621.621,0,0,0,0-1.242" transform="translate(2.659 4.624)" fill="#fff"/>\n      <path id="Path_1539" data-name="Path 1539" d="M19.755,11a.621.621,0,0,0-.621.621v4.157a.621.621,0,0,0,1.242,0V11.624A.621.621,0,0,0,19.755,11" transform="translate(4.624 2.659)" fill="#fff"/>\n      <path id="Path_1540" data-name="Path 1540" d="M7.5,18.3a.621.621,0,0,0-.621-.621H4.733l5.149-5.149A.621.621,0,0,0,9,11.656L3.855,16.806V14.579a.621.621,0,0,0-1.242,0V18.3a.611.611,0,0,0,.048.238A.606.606,0,0,0,3,18.877a.606.606,0,0,0,.238.048H6.878A.621.621,0,0,0,7.5,18.3" transform="translate(0.632 2.773)" fill="#fff"/>\n      <path id="Path_1541" data-name="Path 1541" d="M14.173,3.409a.619.619,0,0,0,.621.621h1.836L11.483,9.178a.621.621,0,0,0,.878.878l5.148-5.148V6.744a.621.621,0,1,0,1.242,0V3.41a.606.606,0,0,0-.048-.238.612.612,0,0,0-.335-.335.606.606,0,0,0-.238-.048H14.794a.621.621,0,0,0-.621.621" transform="translate(2.731 0.673)" fill="#fff"/>\n      <path id="Path_1542" data-name="Path 1542" d="M2.661,3.172a.615.615,0,0,0-.048.238V6.744a.621.621,0,0,0,1.242,0V4.908L9,10.057a.621.621,0,0,0,.878-.878L4.733,4.03H6.57a.621.621,0,1,0,0-1.242H3.235A.634.634,0,0,0,3,2.836a.624.624,0,0,0-.335.335" transform="translate(0.632 0.673)" fill="#fff"/>\n      <path id="Path_1543" data-name="Path 1543" d="M18.7,18.545a.617.617,0,0,0,.048-.24h0V14.581a.62.62,0,1,0-1.24,0v2.226l-5.148-5.15a.621.621,0,0,0-.878.878l5.147,5.149H14.4a.621.621,0,0,0-.621.621.623.623,0,0,0,.621.621h3.71a.616.616,0,0,0,.453-.18.6.6,0,0,0,.117-.175c0-.009.012-.016.016-.025" transform="translate(2.731 2.773)" fill="#fff"/>\n    </g>\n  </g>\n</svg>\n\n',autoBounds:'<svg xmlns="http://www.w3.org/2000/svg" width="25.04" height="25" viewBox="0 0 25.04 25">\n  <g id="bounds-detection" transform="translate(0.02)">\n    <g id="Group_306" data-name="Group 306" transform="translate(-0.02)">\n      <path id="Path_982" data-name="Path 982" d="M.791,8.146h.02a.468.468,0,0,0,.516-.416.455.455,0,0,0,0-.063V1.927a1,1,0,0,1,1-1H7.957A.468.468,0,0,0,8.436.492.468.468,0,0,0,7.977.013H2.247A1.913,1.913,0,0,0,.333,1.927v5.74A.468.468,0,0,0,.791,8.146Z" transform="translate(-0.293 -0.012)" fill="#fff"/>\n      <path id="Path_983" data-name="Path 983" d="M140.092,132.044a.468.468,0,0,0-.458-.478h-.02a.468.468,0,0,0-.478.458q0,.01,0,.02v5.74a1,1,0,0,1-1,1h-5.671a.5.5,0,0,0,0,1h5.711a1.913,1.913,0,0,0,1.915-1.912q0-.041,0-.081Z" transform="translate(-115.132 -114.777)" fill="#fff"/>\n      <path id="Path_984" data-name="Path 984" d="M7.665,138.7H1.955a1,1,0,0,1-1-1v-5.661a.468.468,0,0,0-.458-.478H.48a.468.468,0,0,0-.478.458q0,.01,0,.02v5.74A1.914,1.914,0,0,0,1.914,139.7H7.665a.5.5,0,1,0,0-1Z" transform="translate(-0.001 -114.777)" fill="#fff"/>\n      <path id="Path_985" data-name="Path 985" d="M138.405,0l-.081,0h-5.711a.468.468,0,0,0-.478.458q0,.01,0,.02a.468.468,0,0,0,.458.478h5.731a1,1,0,0,1,1,1v5.7a.5.5,0,0,0,1,0V1.915A1.913,1.913,0,0,0,138.405,0Z" transform="translate(-115.277)" fill="#fff"/>\n      <path id="Path_986" data-name="Path 986" d="M32.226,33.132v14.81a1.227,1.227,0,0,0,1.227,1.227H48.265a1.217,1.217,0,0,0,1.227-1.206V33.132a1.217,1.217,0,0,0-1.206-1.227H33.453A1.227,1.227,0,0,0,32.226,33.132Zm16.251-.045a.19.19,0,0,1,0,.045v14.81a.19.19,0,0,1-.179.2H33.453a.19.19,0,0,1-.211-.168.182.182,0,0,1,0-.033V33.132a.19.19,0,0,1,.212-.212H48.265A.191.191,0,0,1,48.477,33.087Z" transform="translate(-28.359 -28.076)" fill="#fff"/>\n      <path id="Path_987" data-name="Path 987" d="M59.363,95.652h9.209a.478.478,0,0,0,.478-.478.488.488,0,0,0-.478-.478H59.363a.488.488,0,0,0-.478.478A.478.478,0,0,0,59.363,95.652Z" transform="translate(-51.309 -82.838)" fill="#fff"/>\n      <path id="Path_988" data-name="Path 988" d="M59.363,128.6h9.209a.478.478,0,0,0,.478-.478.488.488,0,0,0-.478-.478H59.363a.488.488,0,0,0-.478.478A.478.478,0,0,0,59.363,128.6Z" transform="translate(-51.309 -111.663)" fill="#fff"/>\n      <path id="Path_989" data-name="Path 989" d="M59.364,64.6h4.285a.488.488,0,0,0,.478-.478.478.478,0,0,0-.478-.478H59.364a.468.468,0,0,0-.478.458q0,.01,0,.02A.478.478,0,0,0,59.364,64.6Z" transform="translate(-51.443 -55.678)" fill="#fff"/>\n    </g>\n  </g>\n</svg>\n',finish:'<svg id="finish" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24" viewBox="0 0 24 24">\n  <defs>\n    <clipPath id="finishclip-path">\n      <rect id="Rectangle_2775" data-name="Rectangle 2775" width="24" height="24" fill="currentColor"/>\n    </clipPath>\n  </defs>\n  <g id="Group_584" data-name="Group 584" clip-path="url(#finishclip-path)">\n    <path id="Path_1526" data-name="Path 1526" d="M17.6,6.7l-6.691,9.081L6.313,12.11a.5.5,0,0,0-.625.781l5,4a.508.508,0,0,0,.378.1.493.493,0,0,0,.337-.2l7-9.5A.5.5,0,1,0,17.6,6.7" fill="currentColor"/>\n    <path id="Path_1527" data-name="Path 1527" d="M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0m0,23A11,11,0,1,1,23,12,11.013,11.013,0,0,1,12,23" fill="currentColor"/>\n  </g>\n</svg>\n',retake:'<svg id="re-take" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="28.761" height="23" viewBox="0 0 28.761 23">\n<defs>\n<clipPath id="retakeclip-path">\n  <rect id="Rectangle_2773" data-name="Rectangle 2773" width="28.761" height="23" fill="#fff"/>\n</clipPath>\n</defs>\n<g id="Group_580" data-name="Group 580" clip-path="url(#retakeclip-path)">\n<path id="Path_1522" data-name="Path 1522" d="M25.877,3.639H21.663a.7.7,0,0,1-.575-.288l-.575-.764C19.264.961,18.59,0,17.44,0H11.4C10.151,0,9.486.961,8.336,2.588l-.674.764a.7.7,0,0,1-.575.288H2.875C.476,3.639,0,5.077,0,6.227v13.9C0,22.041,1.051,23,2.974,23H25.787c1.914,0,2.974-.961,2.974-2.776v-14c-.008-1.147-.485-2.585-2.884-2.585m-.1,18.411H2.974c-1.339,0-2.013-.575-2.013-1.824v-14c0-.863.189-1.626,1.914-1.626H7.188a1.666,1.666,0,0,0,1.339-.674L9.1,3.162c1.15-1.626,1.536-2.2,2.2-2.2H17.34c.674,0,1.15.575,2.3,2.2l.575.764a1.562,1.562,0,0,0,1.339.674h4.313c1.725,0,1.914.764,1.914,1.626v14h.009c0,1.249-.673,1.824-2.012,1.824" fill="#fff"/>\n<path id="Path_1523" data-name="Path 1523" d="M15.978,9.16H9.462l1.745-1.743A.5.5,0,0,0,10.5,6.71l-2.6,2.6a.484.484,0,0,0-.108.162.5.5,0,0,0,0,.382.479.479,0,0,0,.108.163l2.6,2.6a.5.5,0,0,0,.708-.708L9.462,10.16h6.516a4.028,4.028,0,0,1,0,8.055H10.255a.5.5,0,1,0,0,1h5.723a5.028,5.028,0,0,0,0-10.055" fill="#fff"/>\n</g>\n</svg>\n',complete:'\n<svg id="continue" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24" viewBox="0 0 24 24">\n<defs>\n<clipPath id="continueclip-path">\n  <rect id="Rectangle_2774" data-name="Rectangle 2774" width="24" height="24" fill="currentColor"/>\n</clipPath>\n</defs>\n<g id="Group_582" data-name="Group 582" clip-path="url(#continueclip-path)">\n<path id="Path_1524" data-name="Path 1524" d="M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0m0,23A11,11,0,1,1,23,12,11.013,11.013,0,0,1,12,23" fill="currentColor"/>\n<path id="Path_1525" data-name="Path 1525" d="M19.862,12a.17.17,0,0,0,0-.024.512.512,0,0,0-.033-.168.532.532,0,0,0-.113-.17l-4.219-4.29a.5.5,0,0,0-.714,0,.51.51,0,0,0,0,.719l3.371,3.428H4.643a.509.509,0,0,0,0,1.018h13.5l-3.373,3.428a.512.512,0,0,0,0,.72.5.5,0,0,0,.714,0l4.224-4.295a.438.438,0,0,0,.056-.086.5.5,0,0,0,.051-.078A.521.521,0,0,0,19.862,12h0" fill="currentColor"/>\n</g>\n</svg>\n'},R=1.588;var E,b;!function(e){e.Image="image",e.Barcode="barcode"}(E||(E={})),function(e){e.Front="frontSide",e.Back="backSide"}(b||(b={}));const D={[b.Front]:"Front",[b.Back]:"Back"};var V;!function(e){e.Scanner="scanner",e.Result="scan-result",e.Correction="correction"}(V||(V={}));const I="DL_detect",L="DL_normalize",A="DL_barcode";var _,x;!function(e){e.InvalidFields="invalidFields",e.LicenseType="licenseType",e.LicenseNumber="licenseNumber",e.FullName="fullName",e.FirstName="firstName",e.LastName="lastName",e.MiddleName="middleName",e.DateOfBirth="dateOfBirth",e.ExpiryDate="expiryDate",e.IssueDate="issueDate",e.Age="age",e.Sex="sex",e.Height="height",e.Weight="weight",e.EyeColor="eyeColor",e.HairColor="hairColor",e.Address="address",e.City="city",e.State="state",e.PostalCode="postalCode",e.VehicleClass="vehicleClass",e.Restrictions="restrictions",e.Endorsements="endorsements",e.IssuingCountry="issuingCountry",e.DocumentDiscriminator="documentDiscriminator"}(_||(_={})),function(e){e.AAMVA_DL_ID="AAMVA_DL_ID",e.AAMVA_DL_ID_WITH_MAG_STRIPE="AAMVA_DL_ID_WITH_MAG_STRIPE",e.SOUTH_AFRICA_DL="SOUTH_AFRICA_DL"}(x||(x={})),_.InvalidFields,_.LicenseType,_.LicenseNumber,_.FullName,_.FirstName,_.LastName,_.MiddleName,_.DateOfBirth,_.ExpiryDate,_.IssueDate,_.Age,_.Sex,_.Height,_.Weight,_.EyeColor,_.HairColor,_.Address,_.City,_.State,_.PostalCode,_.VehicleClass,_.Restrictions,_.Endorsements,_.IssuingCountry,_.DocumentDiscriminator;class k{constructor(e,t){var n,i,o;this.resources=e,this.config=t,this.imageEditorView=null,this.layer=null,this.config.utilizedTemplateNames={detect:(null===(n=t.utilizedTemplateNames)||void 0===n?void 0:n.detect)||I,normalize:(null===(i=t.utilizedTemplateNames)||void 0===i?void 0:i.normalize)||L,barcode:(null===(o=t.utilizedTemplateNames)||void 0===o?void 0:o.barcode)||A}}async initialize(){if(!this.resources.result)throw Error("Captured image is missing. Please capture an image first!");if(!this.config.container)throw new Error("Please create an Correction View Container element");w("ddls-correction-view-style",P);const t=document.createElement("div");t.className="ddls-correction-view-container";const n=document.createElement("div");Object.assign(n.style,{width:"100%",height:"100%"}),t.appendChild(n),m(this.config.container).appendChild(t),this.imageEditorView=await e.createInstance(n),this.layer=this.imageEditorView.createDrawingLayer(),this.setupDrawingLayerStyle(),this.setupInitialDetectedQuad(),this.setupCorrectionControls(),this.setupQuadConstraints()}setupDrawingLayerStyle(){const e=t.createDrawingStyle({lineWidth:5,fillStyle:"transparent",strokeStyle:"#FE8E14",paintMode:"stroke"});this.layer.setDefaultStyle(e)}setupQuadConstraints(){const e=this.layer.fabricCanvas;e.defaultCursor="default",e.hoverCursor="default",e.moveCursor="default",e.on("object:scaling",(t=>{const n=t.target,i=n.points,o=this.getCanvasBounds();i.forEach((e=>{e.x=Math.max(0,Math.min(o.width,e.x)),e.y=Math.max(0,Math.min(o.height,e.y))})),n.set({points:i,dirty:!0}),e.renderAll()})),e.on("object:modified",(t=>{const n=t.target;if(!n)return;const i=n.points,o=this.getCanvasBounds();let a=!1;i.forEach((e=>{(e.x<0||e.x>o.width||e.y<0||e.y>o.height)&&(a=!0)})),a&&(i.forEach((e=>{e.x=Math.max(0,Math.min(o.width,e.x)),e.y=Math.max(0,Math.min(o.height,e.y))})),n.set({points:i,dirty:!0}),e.renderAll())}))}getCanvasBounds(){const e=this.layer.fabricCanvas;return{width:e.getWidth(),height:e.getHeight()}}addQuadToLayer(e){this.layer.clearDrawingItems();const t=e._getFabricObject();t.cornerSize=60,t.lockMovementX=!0,t.lockMovementY=!0,t.on("mousedown",(function(e){var t;e.target&&e.target.controls&&(this.cornerColor="transparent",this.dirty=!0,null===(t=this.canvas)||void 0===t||t.renderAll())})),t.on("mouseup",(function(){var e;this.cornerColor="#FE8E14",this.dirty=!0,null===(e=this.canvas)||void 0===e||e.renderAll()})),this.layer.renderAll(),this.layer.addDrawingItems([e]),this.layer.fabricCanvas.setActiveObject(t),this.layer.fabricCanvas.renderAll()}setupInitialDetectedQuad(){}createControls(){var e,t,n,i,o,a,s,r,l,c,d,h,u,g;const{toolbarButtonsConfig:m}=this.config;return f([{id:"ddls-correction-fullImage",icon:(null===(e=null==m?void 0:m.fullImage)||void 0===e?void 0:e.icon)||S.fullImage,label:(null===(t=null==m?void 0:m.fullImage)||void 0===t?void 0:t.label)||"Full Image",className:`${(null===(n=null==m?void 0:m.fullImage)||void 0===n?void 0:n.className)||""}`,isHidden:(null===(i=null==m?void 0:m.fullImage)||void 0===i?void 0:i.isHidden)||!1,onClick:()=>this.setFullImageBoundary()},{id:"ddls-correction-detectBorders",icon:(null===(o=null==m?void 0:m.detectBorders)||void 0===o?void 0:o.icon)||S.autoBounds,label:(null===(a=null==m?void 0:m.detectBorders)||void 0===a?void 0:a.label)||"Detect Borders",className:`${(null===(s=null==m?void 0:m.detectBorders)||void 0===s?void 0:s.className)||""}`,isHidden:(null===(r=null==m?void 0:m.detectBorders)||void 0===r?void 0:r.isHidden)||!1,onClick:()=>this.setBoundaryAutomatically()},{id:"ddls-correction-apply",icon:(null===(l=null==m?void 0:m.apply)||void 0===l?void 0:l.icon)||(!1===(null===(c=this.config)||void 0===c?void 0:c._showResultView)?S.complete:S.finish),label:(null===(d=null==m?void 0:m.apply)||void 0===d?void 0:d.label)||(!1===(null===(h=this.config)||void 0===h?void 0:h._showResultView)?"Done":"Apply"),className:`${(null===(u=null==m?void 0:m.apply)||void 0===u?void 0:u.className)||""}`,isHidden:(null===(g=null==m?void 0:m.apply)||void 0===g?void 0:g.isHidden)||!1,onClick:()=>this.confirmCorrection()}])}setupCorrectionControls(){try{const e=this.createControls(),t=m(this.config.container).firstElementChild;t&&t.appendChild(e)}catch(e){throw console.error("Error setting up correction controls:",e),new Error(`Failed to setup correction controls: ${e.message}`)}}setFullImageBoundary(){}async setBoundaryAutomatically(){this.config.templateFilePath&&await this.resources.cvRouter.initSettings(this.config.templateFilePath),this.resources.cvRouter.maxImageSideLength=1/0}async confirmCorrection(){const e=this.layer.getDrawingItems()[0];if(!e)throw new Error("No quad drawing item found");const t=e.getQuad();await this.correctImage(null==t?void 0:t.points),this.dispose(),this.hideView()}async launch(){try{return m(this.config.container).textContent="",await this.initialize(),m(this.config.container).style.display="flex",new Promise((e=>{this.currentCorrectionResolver=e}))}catch(e){let t=(null==e?void 0:e.message)||e;console.error(t)}}hideView(){m(this.config.container).style.display="none"}async correctImage(e){const{cvRouter:t}=this.resources;this.config.templateFilePath&&await this.resources.cvRouter.initSettings(this.config.templateFilePath);const n=await t.getSimplifiedSettings(this.config.utilizedTemplateNames.normalize);n.roiMeasuredInPercentage=!1,n.roi.points=e,await t.updateSettings(this.config.utilizedTemplateNames.normalize,n)}dispose(){var e,t;(null===(e=this.imageEditorView)||void 0===e?void 0:e.dispose)&&this.imageEditorView.dispose(),this.layer=null,(null===(t=this.config)||void 0===t?void 0:t.container)&&(m(this.config.container).textContent=""),this.currentCorrectionResolver=void 0}}const P="\n  .ddls-correction-view-container {\n    display: flex;\n    width: 100%;\n    height: 100%;\n    background-color:#575757;\n    font-size: 12px;\n    flex-direction: column;\n    align-items: center;\n  }\n\n  @media (orientation: landscape) and (max-width: 1024px) {\n    .ddls-correction-view-container {\n      flex-direction: row;\n    }\n  }\n";function M(e,t={}){const{message:n,spinnerSize:i=32}=t,o=document.createElement("div");o.className="ddls-loading-screen";const a=document.createElement("div");a.className="ddls-loading";const s=document.createElement("div");s.className="ddls-loading-content";const r=`\n    <svg \n      xmlns="http://www.w3.org/2000/svg" \n      viewBox="0 0 24 24" \n      fill="none" \n      stroke="white" \n      stroke-linecap="round" \n      stroke-linejoin="round" \n      width="${i}" \n      height="${i}" \n      stroke-width="0.75"\n    > \n      <path d="M12 3a9 9 0 1 0 9 9"></path> \n    </svg>\n  `;if(s.innerHTML=r,n){const e=document.createElement("div");e.className="ddls-loading-message",e.textContent=n,s.appendChild(e)}return a.appendChild(s),o.appendChild(a),e.appendChild(o),{element:o,updateMessage:e=>{let t=a.querySelector(".ddls-loading-message");null!==e?t?t.textContent=e:(t=document.createElement("div"),t.className="ddls-loading-message",t.textContent=e,s.appendChild(t)):null==t||t.remove()},hide:()=>{o&&o.parentNode&&(o.classList.add("fade-out"),setTimeout((()=>{var e;null===(e=o.parentNode)||void 0===e||e.removeChild(o)}),200))}}}const z=e=>({start:`Position the ${D[e]} of the license in the frame`,inProgress:"Keep steady while we complete the scan"});class B{showScannerLoadingOverlay(e){const t=m(this.config.container);this.loadingScreen=M(t,{message:e}),t.style.display="block",t.style.position="relative"}hideScannerLoadingOverlay(e=!1){this.loadingScreen&&(this.loadingScreen.hide(),this.loadingScreen=null,e&&(m(this.config.container).style.display="none"))}constructor(e,t){var n,i,o;this.resources=e,this.config=t,this.currentScanMode=b.Front,this.boundsDetectionEnabled=!1,this.smartCaptureEnabled=!1,this.autoCropEnabled=!1,this.licenseVerificationCount=0,this.originalImageData=null,this.initialized=!1,this.initializedDCE=!1,this.resizeTimer=null,this.DCE_ELEMENTS={selectCameraBtn:null,uploadImageBtn:null,closeScannerBtn:null,takePhotoBtn:null,boundsDetectionBtn:null,smartCaptureBtn:null,autoCropBtn:null,hintTopMessage:null},this.loadingScreen=null,this.handleResize=()=>{this.toggleScanGuide(!1),this.resizeTimer&&window.clearTimeout(this.resizeTimer),this.resizeTimer=window.setTimeout((()=>{this.toggleScanGuide(!0)}),500)},this.config.utilizedTemplateNames={detect:(null===(n=t.utilizedTemplateNames)||void 0===n?void 0:n.detect)||I,normalize:(null===(i=t.utilizedTemplateNames)||void 0===i?void 0:i.normalize)||L,barcode:(null===(o=t.utilizedTemplateNames)||void 0===o?void 0:o.barcode)||A}}async initialize(){if(!this.initialized){w("dynamsoft-ddls-loading-screen-style",'\n  .ddls-loading-screen {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background-color: #323234;\n    z-index: 998;\n    opacity: 1;\n    transition: opacity 0.2s ease-out;\n  }\n\n  .ddls-loading-screen.fade-out {\n    opacity: 0;\n  }\n\n  .ddls-loading {\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    color: white;\n    z-index: 999;\n    transform: translate(-50%, -50%);\n  }\n\n  .ddls-loading-content {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 16px;\n  }\n\n  .ddls-loading svg {\n    animation: spin 1s linear infinite;\n  }\n\n  .ddls-loading-message {\n    color: white;\n    font-family: "Verdana";\n    font-size: 14px;\n    text-align: center;\n    max-width: 200px;\n    line-height: 1.4;\n    opacity: 0.9;\n  }\n\n  @keyframes spin {\n    from {\n      transform: rotate(0deg);\n    }\n    to {\n      transform: rotate(360deg);\n    }\n  }\n');try{const{cameraView:e,cameraEnhancer:t,cvRouter:i}=this.resources;e.setVideoFit("cover"),i.setInput(t);const o=new n;o.onCapturedResultReceived=e=>this.handleBoundsDetection(e),await i.addResultReceiver(o),this.boundsDetectionEnabled=!0,this.smartCaptureEnabled=!0,this.autoCropEnabled=!0,!1===this.config.showScanGuide&&this.toggleScanGuide(!1),this.initialized=!0}catch(e){let t=(null==e?void 0:e.message)||e;console.error(t),alert(t),this.closeCamera();const n={status:{code:u.RS_FAILED,message:"DDLS Init error"}};this.currentScanResolver(n)}}}async initializeElements(){const e=m(this.config.container),t=e.children[e.children.length-1];if(!(null==t?void 0:t.shadowRoot))throw new Error("Shadow root not found");this.DCE_ELEMENTS={selectCameraBtn:t.shadowRoot.querySelector(".dce-mn-select-camera-icon"),uploadImageBtn:t.shadowRoot.querySelector(".dce-mn-upload-image-icon"),closeScannerBtn:t.shadowRoot.querySelector(".dce-mn-close"),takePhotoBtn:t.shadowRoot.querySelector(".dce-mn-take-photo"),boundsDetectionBtn:t.shadowRoot.querySelector(".dce-mn-bounds-detection"),smartCaptureBtn:t.shadowRoot.querySelector(".dce-mn-smart-capture"),autoCropBtn:t.shadowRoot.querySelector(".dce-mn-auto-crop"),hintTopMessage:t.shadowRoot.querySelector(".dce-hint-top")},await this.toggleBoundsDetection(this.boundsDetectionEnabled),await this.toggleSmartCapture(this.smartCaptureEnabled),await this.toggleAutoCrop(this.autoCropEnabled),this.assignDCEClickEvents(),!1===this.config._showCorrectionView&&(this.DCE_ELEMENTS.smartCaptureBtn.style.display="none"),this.initializedDCE=!0}assignDCEClickEvents(){if(!Object.values(this.DCE_ELEMENTS).every(Boolean))throw new Error("Camera control elements not found");const e={passive:!0};this.takePhoto=this.takePhoto.bind(this),this.toggleBoundsDetection=this.toggleBoundsDetection.bind(this),this.toggleSmartCapture=this.toggleSmartCapture.bind(this),this.toggleAutoCrop=this.toggleAutoCrop.bind(this),this.closeCamera=this.closeCamera.bind(this),this.DCE_ELEMENTS.takePhotoBtn.addEventListener("click",this.takePhoto,e),this.DCE_ELEMENTS.boundsDetectionBtn.addEventListener("click",(async()=>await this.toggleBoundsDetection()),e),this.DCE_ELEMENTS.smartCaptureBtn.addEventListener("click",(async()=>await this.toggleSmartCapture()),e),this.DCE_ELEMENTS.autoCropBtn.addEventListener("click",(async()=>await this.toggleAutoCrop()),e),this.DCE_ELEMENTS.closeScannerBtn.addEventListener("click",(async()=>await this.handleCloseBtn()),e),this.DCE_ELEMENTS.selectCameraBtn.addEventListener("click",(e=>{e.stopPropagation(),this.toggleSelectCameraBox()}),e),this.DCE_ELEMENTS.uploadImageBtn.addEventListener("click",(()=>this.uploadImage()),e)}async handleCloseBtn(){this.closeCamera(),this.currentScanResolver&&this.currentScanResolver({status:{code:u.RS_CANCELLED,message:"Cancelled"}})}attachOptionClickListeners(){const e=m(this.config.container),t=e.children[e.children.length-1];if(!(null==t?void 0:t.shadowRoot))return;const n=t.shadowRoot.querySelector(".dce-mn-camera-and-resolution-settings");[...t.shadowRoot.querySelectorAll(".dce-mn-camera-option"),...t.shadowRoot.querySelectorAll(".dce-mn-resolution-option")].forEach((e=>{e.addEventListener("click",(async()=>{const t=e.getAttribute("data-davice-id"),i=e.getAttribute("data-height"),o=e.getAttribute("data-width");t?this.resources.cameraEnhancer.selectCamera(t).then((()=>{this.toggleScanGuide()})):i&&o&&this.resources.cameraEnhancer.setResolution({width:parseInt(o),height:parseInt(i)}).then((()=>{this.toggleScanGuide()})),"none"!==n.style.display&&this.toggleSelectCameraBox()}))}))}highlightCameraAndResolutionOption(){const e=m(this.config.container),t=e.children[e.children.length-1];if(!(null==t?void 0:t.shadowRoot))return;const n=t.shadowRoot.querySelector(".dce-mn-camera-and-resolution-settings"),i=n.querySelectorAll(".dce-mn-camera-option"),o=n.querySelectorAll(".dce-mn-resolution-option"),a=this.resources.cameraEnhancer.getSelectedCamera(),s=this.resources.cameraEnhancer.getResolution();i.forEach((e=>{const t=e;t.getAttribute("data-davice-id")===(null==a?void 0:a.deviceId)?t.style.border="2px solid #fe814a":t.style.border="none"}));const r={"480p":"480","720p":"720","1080p":"1080","2k":"1440","4k":"2160"},l=function(e){const t=e.width*e.height,n=e.width/e.height;let i="480p",o=Number.MAX_VALUE;for(const[e,a]of Object.entries(C)){const s=a.width*a.height,r=a.width/a.height,l=.7*Math.abs(s-t)+Math.abs(r-n)*s*.3;l<o&&(o=l,i=e)}return i}(s);o.forEach((e=>{const t=e,n=t.getAttribute("data-height");t.style.border=n===r[l]?"2px solid #fe814a":"none"}))}toggleSelectCameraBox(){const e=m(this.config.container),t=e.children[e.children.length-1];if(!(null==t?void 0:t.shadowRoot))return;const n=t.shadowRoot.querySelector(".dce-mn-resolution-box");this.highlightCameraAndResolutionOption(),this.attachOptionClickListeners(),n.click()}async uploadImage(){var e,t,n,i,o,a;const s=document.createElement("input");s.type="file",s.accept="image/*",s.style.display="none",document.body.appendChild(s);try{const{cameraEnhancer:r,result:l,onResultUpdated:c}=this.resources;this.showScannerLoadingOverlay("Processing image...");const d=await new Promise(((e,t)=>{s.onchange=n=>{var i;const o=null===(i=n.target.files)||void 0===i?void 0:i[0];(null==o?void 0:o.type.startsWith("image/"))?e(o):t(new Error("Please select an image file"))},s.addEventListener("cancel",(()=>this.hideScannerLoadingOverlay(!1))),s.click()}));if(!d)return void this.hideScannerLoadingOverlay(!1);this.closeCamera(!1);const{blob:h}=await this.fileToBlob(d);this.capturedResult=await this.resources.cvRouter.capture(h,this.config.utilizedTemplateNames.detect),this.originalImageData=null===(e=this.capturedResult.items[0])||void 0===e?void 0:e.imageData;let m=null;if((null===(t=this.capturedResult.items)||void 0===t?void 0:t.length)<=1){const{width:e,height:t}=this.originalImageData;m={points:[{x:0,y:0},{x:e,y:0},{x:e,y:t},{x:0,y:t}],area:t*e}}else m=null===(a=null===(o=null===(i=null===(n=this.capturedResult)||void 0===n?void 0:n.processedDocumentResult)||void 0===i?void 0:i.detectedQuadResultItems)||void 0===o?void 0:o[0])||void 0===a?void 0:a.location;m.points=y(m.points,this.originalImageData,15);const f=await this.normalizeImage(m.points,this.originalImageData),p={status:{code:u.RS_SUCCESS,message:"Success"},originalImageResult:this.originalImageData,deskewedImageResult:f,detectedQuadrilateral:m,_flowType:g.UPLOADED_IMAGE,imageData:!0,_imageData:f};null==c||c(Object.assign(Object.assign({},l),{[this.currentScanMode]:p})),this.currentScanResolver(p),this.hideScannerLoadingOverlay(!0)}catch(e){let t=(null==e?void 0:e.message)||e;console.error(t),alert(t),this.closeCamera();const n={status:{code:u.RS_FAILED,message:"Error processing uploaded image"}};this.currentScanResolver(n)}finally{document.body.removeChild(s)}}async fileToBlob(e){return new Promise(((t,n)=>{const i=new Image;i.onload=()=>{const o=document.createElement("canvas");o.width=i.width,o.height=i.height;const a=o.getContext("2d");null==a||a.drawImage(i,0,0),o.toBlob((e=>{e?t({blob:e,width:i.width,height:i.height}):n(new Error("Failed to create blob"))}),e.type)},i.onerror=n,i.src=URL.createObjectURL(e)}))}async toggleAutoCaptureAnimation(e){const t=m(this.config.container),n=t.children[t.children.length-1];if(!(null==n?void 0:n.shadowRoot))return;const i=n.shadowRoot.querySelector(".dce-loading-auto-capture-animation");i.style.borderLeftColor=e?"transparent":"#fe8e14",i.style.borderBottomColor=e?"transparent":"#fe8e14"}async toggleBoundsDetection(e){const t=m(this.config.container),n=t.children[t.children.length-1];if(!(null==n?void 0:n.shadowRoot))return;const i=n.shadowRoot.querySelector(".dce-mn-bounds-detection"),o=n.shadowRoot.querySelector(".dce-mn-bounds-detection-on"),a=n.shadowRoot.querySelector(".dce-mn-bounds-detection-off");if(!o||!a)return;this.toggleAutoCaptureAnimation(!1);const s=void 0!==e?e:!this.boundsDetectionEnabled;s||await this.toggleSmartCapture(!1);const{cvRouter:r}=this.resources;this.boundsDetectionEnabled=s,i.style.color=this.boundsDetectionEnabled?"#fe814a":"#fff",a.style.display=this.boundsDetectionEnabled?"none":"block",o.style.display=this.boundsDetectionEnabled?"block":"none",this.initialized&&this.boundsDetectionEnabled?await r.startCapturing(this.config.utilizedTemplateNames.detect):this.initialized&&!this.boundsDetectionEnabled&&this.stopCapturing()}async toggleSmartCapture(e){const t=m(this.config.container),n=t.children[t.children.length-1];if(!(null==n?void 0:n.shadowRoot))return;const i=n.shadowRoot.querySelector(".dce-mn-smart-capture"),o=n.shadowRoot.querySelector(".dce-mn-smart-capture-on"),a=n.shadowRoot.querySelector(".dce-mn-smart-capture-off");if(!o||!a)return;const s=void 0!==e?e:!this.smartCaptureEnabled;this.toggleAutoCaptureAnimation(s),s&&!this.boundsDetectionEnabled?await this.toggleBoundsDetection(!0):s||!1===this.config._showCorrectionView||await this.toggleAutoCrop(!1),this.smartCaptureEnabled=s,i.style.color=this.smartCaptureEnabled?"#fe814a":"#fff",a.style.display=this.smartCaptureEnabled?"none":"block",o.style.display=this.smartCaptureEnabled?"block":"none",this.licenseVerificationCount=0}async toggleAutoCrop(e){const t=m(this.config.container),n=t.children[t.children.length-1];if(!(null==n?void 0:n.shadowRoot))return;const i=n.shadowRoot.querySelector(".dce-mn-auto-crop"),o=n.shadowRoot.querySelector(".dce-mn-auto-crop-on"),a=n.shadowRoot.querySelector(".dce-mn-auto-crop-off");if(!o||!a)return;const s=void 0!==e?e:!this.autoCropEnabled;!s||this.boundsDetectionEnabled&&this.smartCaptureEnabled||(await this.toggleBoundsDetection(!0),await this.toggleSmartCapture(!0)),s||!1!==this.config._showCorrectionView||await this.toggleSmartCapture(!1),this.autoCropEnabled=s,i.style.color=this.autoCropEnabled?"#fe814a":"#fff",a.style.display=this.autoCropEnabled?"none":"block",o.style.display=this.autoCropEnabled?"block":"none"}toggleScanGuide(e){const t=m(this.config.container),n=t.children[t.children.length-1];if(!(null==n?void 0:n.shadowRoot))return;const i=n.shadowRoot.querySelector(".dce-scanguide-dl-front"),o=n.shadowRoot.querySelector(".dce-scanguide-dl-back");if(!1===e||!1===this.config.showScanGuide)return i.style.display="none",void(o.style.display="none");i.style.display=this.currentScanMode===b.Front?"block":"none",o.style.display=this.currentScanMode===b.Back?"block":"none",this.calculateScanRegion()}toggleScanHintMessage(e=!0,t=""){this.DCE_ELEMENTS.hintTopMessage.style.display=e?"block":"none",this.DCE_ELEMENTS.hintTopMessage.innerText=t}calculateScanRegion(){const{cameraEnhancer:e,cameraView:t}=this.resources;if(!e||!e.isOpen())return;let n;const i=t.getVisibleRegionOfVideo({inPixels:!0}),{width:o,height:a}=i;if(i){if(i.width>i.height){const e=.5*a*R,t=Math.round(e/o*100),i=(100-t)/2;n={left:i,right:i+t,top:25,bottom:75,isMeasuredInPercentage:!0}}else{const e=.9*o/R,t=Math.round(e/a*100),i=(100-t)/2;n={left:5,right:95,top:i,bottom:i+t,isMeasuredInPercentage:!0}}null==t||t.setScanRegionMaskVisible(!0),e.setScanRegion(n)}}async openCamera(){try{this.showScannerLoadingOverlay("Initializing camera...");const{cameraEnhancer:e,cameraView:t}=this.resources,n=m(this.config.container);if(n.style.display="block",e.isOpen())e.isPaused()&&await e.resume();else{const i=t.getUIElement();i.parentElement||n.append(i);try{await e.open()}catch(e){}}await e.setResolution({width:2560,height:1440}),!this.initializedDCE&&e.isOpen()&&await this.initializeElements(),window.addEventListener("resize",this.handleResize),this.toggleScanHintMessage(!0,z(this.currentScanMode).start)}catch(e){let t=(null==e?void 0:e.message)||e;console.error(t),alert(t),this.closeCamera();const n={status:{code:u.RS_FAILED,message:"Driver License Scanner Open Camera Error"}};this.currentScanResolver(n)}finally{this.hideScannerLoadingOverlay()}}async closeCamera(e=!0){try{window.removeEventListener("resize",this.handleResize),this.resizeTimer&&(window.clearTimeout(this.resizeTimer),this.resizeTimer=null);const{cameraEnhancer:t,cameraView:n}=this.resources,i=m(this.config.container);i.style.display=e?"none":"block",(null==n?void 0:n.getUIElement().parentElement)&&i.removeChild(n.getUIElement()),t.close(),this.stopCapturing()}catch(e){let t=(null==e?void 0:e.message)||e;console.error(`Close Camera error: ${t}`)}}pauseCamera(){const{cameraEnhancer:e}=this.resources;e.pause()}stopCapturing(){const{cameraView:e,cvRouter:t}=this.resources;t.stopCapturing(),e.clearAllInnerDrawingItems()}getFlowType(){return this.autoCropEnabled?g.AUTO_CROP:this.smartCaptureEnabled?g.SMART_CAPTURE:g.MANUAL}async takePhoto(){var e,t,n,i,o;try{const{cameraEnhancer:a,result:s,onResultUpdated:r}=this.resources,l=!this.boundsDetectionEnabled||this.boundsDetectionEnabled&&(null===(e=this.capturedResult.items)||void 0===e?void 0:e.length)<=1;this.originalImageData=l?a.fetchImage():this.originalImageData;let c=null,d=null;if(l){const{width:e,height:t}=this.originalImageData;d={points:[{x:0,y:0},{x:e,y:0},{x:e,y:t},{x:0,y:t}],area:t*e}}else d=null===(o=null===(i=null===(n=null===(t=this.capturedResult)||void 0===t?void 0:t.processedDocumentResult)||void 0===n?void 0:n.detectedQuadResultItems)||void 0===i?void 0:i[0])||void 0===o?void 0:o.location;console.log(JSON.stringify(d.points)),d.points=d.points.map((e=>this.resources.cameraEnhancer.convertToScanRegionCoordinates(e))),console.log(JSON.stringify(d.points)),d.points=y(d.points,this.originalImageData,15);const h=this.getFlowType();await this.toggleSmartCapture(!1),this.closeCamera(),this.showScannerLoadingOverlay("Processing image..."),c=await this.normalizeImage(d.points,this.originalImageData),this.hideScannerLoadingOverlay(!0);const g={status:{code:u.RS_SUCCESS,message:"Success"},originalImageResult:this.originalImageData,deskewedImageResult:c,detectedQuadrilateral:d,_flowType:h,imageData:!0,_imageData:c};null==r||r(Object.assign(Object.assign({},s),{[this.currentScanMode]:g})),this.currentScanResolver(g)}catch(e){let t=(null==e?void 0:e.message)||e;console.error(t),alert(t),this.closeCamera();const n={status:{code:u.RS_FAILED,message:"Error capturing image"}};this.currentScanResolver(n)}}async handleBoundsDetection(e){var t,n;if(!(null===(t=e.items)||void 0===t?void 0:t.length))return;this.capturedResult=e;const o=e.items.filter((e=>e.type===i.CRIT_ORIGINAL_IMAGE));this.originalImageData=o.length&&(null===(n=o[0])||void 0===n?void 0:n.imageData),(this.smartCaptureEnabled||this.autoCropEnabled)&&this.handleAutoCaptureMode(e)}async handleAutoCaptureMode(e){var t,n,i,o;if(e.items.length<=1)return this.licenseVerificationCount=0,void this.toggleScanHintMessage(!0,z(this.currentScanMode).start);this.toggleScanHintMessage(!0,z().inProgress);const a=null===(n=null===(t=null==e?void 0:e.processedDocumentResult)||void 0===t?void 0:t.detectedQuadResultItems)||void 0===n?void 0:n[0];(function(e,t=.1){if(!e)return!1;let n=1/0,i=-1/0,o=1/0,a=-1/0;for(const t of e)n=Math.min(n,t.x),i=Math.max(i,t.x),o=Math.min(o,t.y),a=Math.max(a,t.y);const s=(i-n)/(a-o);return Math.abs(s-R)/R<=t})(null!==(o=null===(i=null==a?void 0:a.location)||void 0===i?void 0:i.points)&&void 0!==o?o:null)&&this.licenseVerificationCount++,this.licenseVerificationCount>1&&await this.takePhoto()}async launch(e=b.Front){try{this.currentScanMode=e,await this.initialize();const{cvRouter:t,cameraEnhancer:n}=this.resources;return new Promise((async e=>{this.currentScanResolver=e,await this.openCamera(),this.boundsDetectionEnabled&&await t.startCapturing(this.config.utilizedTemplateNames.detect),this.toggleScanGuide(),n.setPixelFormat(o.IPF_ABGR_8888)}))}catch(e){let t=(null==e?void 0:e.message)||e;console.error("Driver License Scanner Launch error: ",t),this.closeCamera();const n={status:{code:u.RS_FAILED,message:"Driver License Scanner Launch error"}};this.currentScanResolver(n)}}async launchBarcodeScanner(){try{await this.initialize();const{cvRouter:e,cameraEnhancer:t}=this.resources;return new Promise((async n=>{this.currentScanResolver=n,await this.openCamera(),await e.startCapturing(this.config.utilizedTemplateNames.barcode),this.toggleScanGuide(),t.setPixelFormat(o.IPF_ABGR_8888)}))}catch(e){let t=(null==e?void 0:e.message)||e;console.error("Driver License Scanner Launch error: ",t),this.closeCamera();const n={status:{code:u.RS_FAILED,message:"Driver License Scanner Launch error"}};this.currentScanResolver(n)}}async normalizeImage(e,t){var n;const{cvRouter:i}=this.resources,o=await i.getSimplifiedSettings(this.config.utilizedTemplateNames.normalize);o.roiMeasuredInPercentage=!1,o.roi.points=e,await i.updateSettings(this.config.utilizedTemplateNames.normalize,o);const a=await i.capture(t,this.config.utilizedTemplateNames.normalize);if(null===(n=null==a?void 0:a.processedDocumentResult.deskewedImageResultItems)||void 0===n?void 0:n[0])return a.processedDocumentResult.deskewedImageResultItems[0]}}class N{constructor(e,t,n,i){this.resources=e,this.config=t,this.scannerView=n,this.correctionView=i,this.currentScanMode=b.Front}async launch(e=b.Front){try{return this.currentScanMode=e,m(this.config.container).textContent="",await this.initialize(),m(this.config.container).style.display="flex",new Promise((e=>{this.currentScanResultViewResolver=e}))}catch(e){let t=(null==e?void 0:e.message)||e;throw console.error(t),t}}async handleUploadAndShareBtn(e){var t,n;try{const{result:i}=this.resources;if(!(null===(t=i[this.currentScanMode])||void 0===t?void 0:t.deskewedImageResult))throw new Error("No image to upload");"upload"===e&&(null===(n=this.config)||void 0===n?void 0:n.onUpload)?await this.config.onUpload(i[this.currentScanMode]):"share"===e&&await this.handleShare()}catch(e){console.error("Error on upload/share:",e),alert("Failed")}}async handleShare(){var e,t;try{const{result:n}=this.resources;if(!(null===(e=n[this.currentScanMode])||void 0===e?void 0:e.deskewedImageResult))throw new Error("No image result provided");const i=await n[this.currentScanMode].deskewedImageResult.toBlob("image/png");if(!i)throw new Error("Failed to convert image to blob");const o=new File([i],`ddls-${Date.now()}.png`,{type:i.type});if(navigator.share&&(null===(t=navigator.canShare)||void 0===t?void 0:t.call(navigator,{files:[o]})))await navigator.share({files:[o],title:"Dynamsoft Driver License Scanner Shared Image"});else{const e=URL.createObjectURL(i),t=document.createElement("a");t.href=e,t.download=o.name,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(e)}return!0}catch(e){if("AbortError"!==e.name){let t=(null==e?void 0:e.message)||e;console.error("Error sharing image:",t),alert(`Error sharing image: ${t}`)}}}async handleCorrectImage(){try{if(!this.correctionView)return void console.error("Correction View not initialized");this.hideView();const e=await this.correctionView.launch();e.deskewedImageResult&&(this.resources.onResultUpdated&&this.resources.onResultUpdated(Object.assign(Object.assign({},this.resources.result),{[this.currentScanMode]:{deskewedImageResult:e.deskewedImageResult,_imageData:e.deskewedImageResult}})),this.dispose(!0),await this.initialize(),m(this.config.container).style.display="flex")}catch(e){throw console.error("DriverLicenseImageResultView - Handle Correction View Error:",e),this.currentScanResultViewResolver&&this.currentScanResultViewResolver({status:{code:u.RS_FAILED,message:(null==e?void 0:e.message)||e}}),e}}async handleRetake(){var e;try{if(!this.scannerView)return void console.error("Correction View not initialized");this.hideView();const t=await this.scannerView.launch(this.currentScanMode);if((null===(e=null==t?void 0:t.status)||void 0===e?void 0:e.code)===u.RS_FAILED)return void(this.currentScanResultViewResolver&&this.currentScanResultViewResolver(t));this.resources.onResultUpdated&&((null==t?void 0:t.status.code)===u.RS_CANCELLED?this.resources.onResultUpdated(this.resources.result):(null==t?void 0:t.status.code)===u.RS_SUCCESS&&this.resources.onResultUpdated(Object.assign(Object.assign({},this.resources.result),{[this.currentScanMode]:t}))),this.correctionView&&(null==t?void 0:t._flowType)&&p(null==t?void 0:t._flowType)&&await this.handleCorrectImage(),this.dispose(!0),await this.initialize(),m(this.config.container).style.display="flex"}catch(e){throw console.error("Error in retake handler:",e),this.currentScanResultViewResolver&&this.currentScanResultViewResolver({status:{code:u.RS_FAILED,message:(null==e?void 0:e.message)||e}}),e}}async handleDone(){var e;try{(null===(e=this.config)||void 0===e?void 0:e.onDone)&&await this.config.onDone(this.resources.result[this.currentScanMode]),this.currentScanResultViewResolver&&this.resources.result[this.currentScanMode]&&this.currentScanResultViewResolver(this.resources.result[this.currentScanMode]),this.hideView(),this.dispose()}catch(e){throw console.error("Error in done handler:",e),this.currentScanResultViewResolver&&this.currentScanResultViewResolver({status:{code:u.RS_FAILED,message:(null==e?void 0:e.message)||e}}),e}}createControls(){var e,t,n,i,o,a,s,r;const{toolbarButtonsConfig:l,onUpload:c}=this.config,d=new Blob(["mock-png-data"],{type:"image/png"}),h=new File([d],"test.png",{type:"image/png"});"share"in navigator&&navigator.canShare({files:[h]});return f([{id:"ddls-scanResult-retake",icon:(null===(e=null==l?void 0:l.retake)||void 0===e?void 0:e.icon)||S.retake,label:(null===(t=null==l?void 0:l.retake)||void 0===t?void 0:t.label)||"Re-take",onClick:()=>this.handleRetake(),className:`${(null===(n=null==l?void 0:l.retake)||void 0===n?void 0:n.className)||""}`,isHidden:(null===(i=null==l?void 0:l.retake)||void 0===i?void 0:i.isHidden)||!1,isDisabled:!this.scannerView},{id:"ddls-scanResult-done",icon:(null===(o=null==l?void 0:l.done)||void 0===o?void 0:o.icon)||S.complete,label:(null===(a=null==l?void 0:l.done)||void 0===a?void 0:a.label)||"Done",className:`${(null===(s=null==l?void 0:l.done)||void 0===s?void 0:s.className)||""}`,isHidden:(null===(r=null==l?void 0:l.done)||void 0===r?void 0:r.isHidden)||!1,onClick:()=>this.handleDone()}])}async initialize(){var e;try{if(!this.resources.result)throw Error("Captured image is missing. Please capture an image first!");if(!this.config.container)throw new Error("Please create a Scan Result View Container element");w("ddls-result-view-style",T);const t=document.createElement("div");t.className="ddls-result-view-container";const n=document.createElement("div");Object.assign(n.style,{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"0",position:"relative"});const i=null===(e=this.resources.result[this.currentScanMode].deskewedImageResult)||void 0===e?void 0:e.toCanvas();Object.assign(i.style,{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"});const o=document.createElement("div");o.className="ddls-verify-message",o.textContent="Are all the details clearly visible? If so, you're all set!",n.appendChild(o),n.appendChild(i),t.appendChild(n);const a=this.createControls();t.appendChild(a),m(this.config.container).appendChild(t)}catch(e){let t=(null==e?void 0:e.message)||e;console.error(t),alert(t)}}hideView(){m(this.config.container).style.display="none"}dispose(e=!1){m(this.config.container).textContent="",e||(this.currentScanResultViewResolver=void 0)}}const T="\n  .ddls-result-view-container {\n    display: flex;\n    width: 100%;\n    height: 100%;\n    background-color:#575757;\n    font-size: 12px;\n    flex-direction: column;\n    align-items: center;\n  }\n\n  .ddls-verify-message{\n    position: absolute;\n    left: 50%;\n    transform: translateX(-50%);\n    top: 2rem;\n    font-family: Verdana;\n    padding: 0.5rem;\n    user-select: none;\n    color: white;\n    font-size: 12px;\n    border-radius: 8px;\n\n    border-color: rgb(254, 142, 20);\n    border-width: 2px;\n    border-style: solid;\n    background-color: rgba(254, 142, 20, 0.4);\n\n    text-align: center;\n    width: max-content;\n  }\n\n  @media (orientation: landscape) and (max-width: 1024px) {\n    .ddls-result-view-container {\n      flex-direction: row;\n    }\n    \n    .ddls-result-view-container div canvas {\n      max-height: 50% !important;\n    }\n  \n    .ddls-verify-message{\n      top: 1.5rem;\n    }\n  }\n",F={dcvData:"https://cdn.jsdelivr.net/npm/dynamsoft-capture-vision-data@1.0.1/",dcvBundle:"https://cdn.jsdelivr.net/npm/dynamsoft-capture-vision-bundle@3.0.3000-beta-202506040121/dist/"};class H{showLoadingOverlay(e){var t,n;const i=m(this.config.container)||m(null===(t=this.config.scannerViewConfig)||void 0===t?void 0:t.container)||m(null===(n=this.config.resultViewConfig)||void 0===n?void 0:n.container);this.loadingScreen=M(i,{message:e}),i.style.display="block",i.style.position="relative"}hideLoadingOverlay(e=!1){var t;this.loadingScreen&&(this.loadingScreen.hide(),this.loadingScreen=null,e&&(null===(t=this.config)||void 0===t?void 0:t.container)&&(m(this.config.container).style.display="none"))}constructor(e){this.config=e,this.fullResult={[b.Front]:null,[b.Back]:null},this.resources={},this.isInitialized=!1,this.isCapturing=!1,this.isDynamsoftResourcesLoaded=!1,this.currentScanStep=0,this.scanSequence=[],this.loadingScreen=null,this.isDynamsoftResourcesLoaded||(this.initializeDDLSConfig(),this.loadDynamsoftResources())}loadDynamsoftResources(){var e;a.engineResourcePaths=v(null===(e=this.config)||void 0===e?void 0:e.engineResourcePaths)?F:this.config.engineResourcePaths;const{readBarcode:t}=this.config.workflowConfig,n=t;a.loadWasm(),n&&(s.loadSpec("AAMVA_DL_ID"),s.loadSpec("AAMVA_DL_ID_WITH_MAG_STRIPE"),s.loadSpec("SOUTH_AFRICA_DL")),this.isDynamsoftResourcesLoaded=!0}async initializeDCVResources(){var e,t;try{this.isDynamsoftResourcesLoaded||this.loadDynamsoftResources(),r._onAuthMessage=e=>e.replace("(https://www.dynamsoft.com/customer/license/trialLicense?product=unknown&deploymenttype=unknown)","(https://www.dynamsoft.com/customer/license/trialLicense?product=ddls&deploymenttype=web)"),r.initLicense((null===(e=this.config)||void 0===e?void 0:e.license)||"",{executeNow:!0}),this.resources.cameraView=await l.createInstance(null===(t=this.config.scannerViewConfig)||void 0===t?void 0:t.uiPath),this.resources.cameraEnhancer=await c.createInstance(this.resources.cameraView),this.resources.cvRouter=await d.createInstance(),await this.resources.cvRouter.initSettings(this.config.templateFilePath),this.resources.cvRouter.maxImageSideLength=1/0}catch(e){let t=(null==e?void 0:e.message)||e;const n=(null==t?void 0:t.toLowerCase().includes("license"))?"The license for the Driver License Scanner is no longer valid or has expired. Please contact the site administrator to resolve this issue.":`Resource Initialization Failed: ${t}`;throw console.error(n),new Error(n)}}async initialize(){if(this.isInitialized)return{resources:this.resources,components:{scannerView:this.scannerView,correctionView:this.correctionView,scanResultView:this.scanResultView}};try{this.initializeDDLSConfig(),await this.initializeDCVResources(),this.resources.onResultUpdated=e=>{this.resources.result=e};const e={};return this.config.scannerViewConfig&&(this.scannerView=new B(this.resources,this.config.scannerViewConfig),e.scannerView=this.scannerView,await this.scannerView.initialize()),this.config.correctionViewConfig&&(this.correctionView=new k(this.resources,this.config.correctionViewConfig),e.correctionView=this.correctionView),this.config.resultViewConfig&&(this.scanResultView=new N(this.resources,this.config.resultViewConfig,this.scannerView,this.correctionView),e.scanResultView=this.scanResultView),this.isInitialized=!0,{resources:this.resources,components:e}}catch(e){this.isInitialized=!1;let t=(null==e?void 0:e.message)||e;throw new Error(`Initialization Failed: ${t}`)}}shouldCreateDefaultContainer(){var e,t,n;const i=!this.config.container,o=!((null===(e=this.config.scannerViewConfig)||void 0===e?void 0:e.container)||(null===(t=this.config.resultViewConfig)||void 0===t?void 0:t.container)||(null===(n=this.config.correctionViewConfig)||void 0===n?void 0:n.container));return i&&o}createDefaultDDLSContainer(){const e=document.createElement("div");return e.className="ddls-main-container",Object.assign(e.style,{display:"none",height:"100dvh",width:"100%",position:"absolute",left:"0",top:"0",zIndex:"999"}),document.body.append(e),e}checkForTemporaryLicense(e){return!(null==e?void 0:e.length)||(null==e?void 0:e.startsWith("A"))||(null==e?void 0:e.startsWith("L"))||(null==e?void 0:e.startsWith("P"))||(null==e?void 0:e.startsWith("Y"))?"DLS2eyJvcmdhbml6YXRpb25JRCI6IjIwMDAwMSJ9":e}validateViewConfigs(){var e,t,n,i,o,a,s,r;if(!this.config.container){if(this.config.showCorrectionView&&!(null===(e=this.config.correctionViewConfig)||void 0===e?void 0:e.container)){const e="CorrectionView container is required when showCorrectionView is true and no main container is provided";return alert(e),console.error(e),!1}if(this.config.showResultView&&!(null===(t=this.config.resultViewConfig)||void 0===t?void 0:t.container)){const e="ResultView container is required when showResultView is true and no main container is provided";return alert(e),console.error(e),!1}}try{if(this.config.container&&!m(this.config.container)){const e="Invalid main container reference";return alert(e),console.error(e),!1}if((null===(n=this.config.scannerViewConfig)||void 0===n?void 0:n.container)&&!m(null===(i=this.config.scannerViewConfig)||void 0===i?void 0:i.container)){const e="Invalid scanner view container reference";return alert(e),console.error(e),!1}if((null===(o=this.config.correctionViewConfig)||void 0===o?void 0:o.container)&&!m(null===(a=this.config.correctionViewConfig)||void 0===a?void 0:a.container)){const e="Invalid correction view container reference";return alert(e),console.error(e),!1}if((null===(s=this.config.resultViewConfig)||void 0===s?void 0:s.container)&&!m(null===(r=this.config.resultViewConfig)||void 0===r?void 0:r.container)){const e="Invalid result view container reference";return alert(e),console.error(e),!1}}catch(e){const t=`Error accessing container references: ${e.message}`;return alert(t),console.error(t),!1}return!0}showCorrectionView(){var e,t;return!1!==this.config.showCorrectionView&&(this.config.container?!(void 0!==this.config.showCorrectionView||!(null===(e=this.config.correctionViewConfig)||void 0===e?void 0:e.container)&&!this.config.container)||!!this.config.showCorrectionView:this.config.showCorrectionView&&!!(null===(t=this.config.correctionViewConfig)||void 0===t?void 0:t.container))}showResultView(){var e,t;return!1!==this.config.showResultView&&(this.config.container?!(void 0!==this.config.showResultView||!(null===(e=this.config.resultViewConfig)||void 0===e?void 0:e.container)&&!this.config.container)||!!this.config.showResultView:this.config.showResultView&&!!(null===(t=this.config.resultViewConfig)||void 0===t?void 0:t.container))}validateWorkflowConfig(e){const{captureFrontImage:t,captureBackImage:n,readBarcode:i}=e;if(!t&&!n&&!i){const e="Invalid workflow configuration: At least one capture mode must be enabled";return alert(e),console.error(e),!1}return!0}buildScanSequence(e){const{captureFrontImage:t,captureBackImage:n,readBarcode:i,scanOrder:o}=e;this.scanSequence=[];const a=o||[b.Front,b.Back];for(const e of a)e===b.Front&&t&&this.scanSequence.push({side:b.Front,mode:E.Image}),e===b.Back&&n&&this.scanSequence.push({side:b.Back,mode:E.Image});i&&this.scanSequence.push({mode:E.Barcode})}initializeDDLSConfig(){var e,t,n,i,o,a,s,r;this.config=null!==(e=this.config)&&void 0!==e?e:{},this.config.workflowConfig=Object.assign({captureFrontImage:!0,captureBackImage:!0,readBarcode:!0,scanOrder:[b.Front,b.Back]},this.config.workflowConfig);if(!this.validateWorkflowConfig(this.config.workflowConfig))return!1;if(!this.validateViewConfigs())return!1;this.buildScanSequence(this.config.workflowConfig),this.config.showCorrectionView=!1,this.shouldCreateDefaultContainer()?this.config.container=this.createDefaultDDLSContainer():this.config.container&&(this.config.container=m(this.config.container));const l=this.config.container?this.createViewContainers(m(this.config.container)):{},c={license:this.checkForTemporaryLicense(this.config.license),utilizedTemplateNames:{detect:(null===(t=this.config.utilizedTemplateNames)||void 0===t?void 0:t.detect)||I,normalize:(null===(n=this.config.utilizedTemplateNames)||void 0===n?void 0:n.normalize)||L},templateFilePath:(null===(i=this.config)||void 0===i?void 0:i.templateFilePath)||"../dist/ddls.template.json"},d=Object.assign(Object.assign({},this.config.scannerViewConfig),{container:l[V.Scanner]||(null===(o=this.config.scannerViewConfig)||void 0===o?void 0:o.container)||null,uiPath:(null===(a=this.config.scannerViewConfig)||void 0===a?void 0:a.uiPath)||"../dist/ddls.ui.html",templateFilePath:c.templateFilePath,utilizedTemplateNames:c.utilizedTemplateNames,_showCorrectionView:this.showCorrectionView(),_workflowConfig:this.config.workflowConfig}),h=this.showCorrectionView()?Object.assign(Object.assign({},this.config.correctionViewConfig),{container:l[V.Correction]||(null===(s=this.config.correctionViewConfig)||void 0===s?void 0:s.container)||null,templateFilePath:c.templateFilePath,utilizedTemplateNames:c.utilizedTemplateNames,_showResultView:this.showResultView()}):void 0,u=this.showResultView()?Object.assign(Object.assign({},this.config.resultViewConfig),{container:l[V.Result]||(null===(r=this.config.resultViewConfig)||void 0===r?void 0:r.container)||null}):void 0;return Object.assign(this.config,Object.assign(Object.assign({},c),{scannerViewConfig:d,correctionViewConfig:h,resultViewConfig:u})),!0}createViewContainers(e){e.textContent="";const t=[V.Scanner];return this.showCorrectionView()&&t.push(V.Correction),this.showResultView()&&t.push(V.Result),t.reduce(((t,n)=>{const i=document.createElement("div");return i.className=`ddls-${n}-view-container`,Object.assign(i.style,{height:"100%",width:"100%",display:"none",position:"relative"}),e.append(i),t[n]=i,t}),{})}dispose(){var e,t,n;this.scanResultView&&(this.scanResultView.dispose(),this.scanResultView=null),this.correctionView&&(this.correctionView.dispose(),this.correctionView=null),this.scannerView=null,this.resources.cameraEnhancer&&(this.resources.cameraEnhancer.dispose(),this.resources.cameraEnhancer=null),this.resources.cameraView&&(this.resources.cameraView.dispose(),this.resources.cameraView=null),this.resources.cvRouter&&(this.resources.cvRouter.dispose(),this.resources.cvRouter=null),this.resources.result=null,this.resources.onResultUpdated=null;const i=e=>{const t=m(e);t&&(t.style.display="none",t.textContent="")};i(this.config.container),i(null===(e=this.config.scannerViewConfig)||void 0===e?void 0:e.container),i(null===(t=this.config.correctionViewConfig)||void 0===t?void 0:t.container),i(null===(n=this.config.resultViewConfig)||void 0===n?void 0:n.container),this.isInitialized=!1}async executeCurrentScanStep(e){const t=this.scanSequence[this.currentScanStep];if(!t)return{status:{code:u.RS_SUCCESS,message:"All scan steps completed"}};if(t.mode===E.Image){const n=t.side===b.Front?b.Front:b.Back,i=await e.scannerView.launch(n);return(null==i?void 0:i.status.code)===u.RS_SUCCESS&&(this.fullResult[n]=i),i}if(t.mode===E.Barcode){const t=this.config.workflowConfig.captureBackImage||this.config.workflowConfig.captureFrontImage;let n={status:{message:"Barcode Result not found",code:u.RS_FAILED}};return t?Object.values(b).forEach((async e=>{var t,n;const i=await this.resources.cvRouter.capture(null===(n=null===(t=this.resources.result[e])||void 0===t?void 0:t.deskewedImageResult)||void 0===n?void 0:n.imageData,this.config.utilizedTemplateNames.barcode);console.log(i)})):n=await e.scannerView.launchBarcodeScanner(),(null==n?void 0:n.status.code)===u.RS_SUCCESS&&(this.fullResult.licenseData=n),n}return{status:{code:u.RS_FAILED,message:"Unknown scan mode"}}}async launch(){if(this.isCapturing){const e="Capture session already in progress";return alert(e),console.error(e),{[b.Front]:{status:{code:u.RS_FAILED,message:e}},[b.Back]:{status:{code:u.RS_FAILED,message:e}},licenseData:{status:{code:u.RS_FAILED,message:e}}}}try{this.isCapturing=!0;const{components:e}=await this.initialize();if(v(e))throw new Error("Driver License Scanner initialization failed");if(this.config.container&&(m(this.config.container).style.display="block"),!e.scannerView)throw new Error("Scanner view is required for capture operations");for(this.currentScanStep=0;this.currentScanStep<this.scanSequence.length;){const t=await this.executeCurrentScanStep(e);if((null==t?void 0:t.status.code)!==u.RS_SUCCESS){if((null==t?void 0:t.status.code)===u.RS_CANCELLED)return this.fullResult;console.warn(`Step ${this.currentScanStep} failed:`,null==t?void 0:t.status.message)}const n=this.scanSequence[this.currentScanStep];if(n.mode===E.Image&&(null==t?void 0:t.status.code)===u.RS_SUCCESS&&(e.correctionView&&p(t._flowType)&&await e.correctionView.launch(),e.scanResultView)){const t=n.side===b.Front?b.Front:b.Back;await e.scanResultView.launch(t)}this.currentScanStep++}return this.fullResult}catch(e){const t=`Driver license capture flow failed. ${(null==e?void 0:e.message)||e}`;return alert(t),console.error("Driver license capture flow failed:",(null==e?void 0:e.message)||e),this.fullResult}finally{this.isCapturing=!1,this.dispose()}}}const O={DriverLicenseScanner:H,DriverLicenseNormalizerView:k,DriverLicenseScannerView:B,DriverLicenseResultView:N,EnumResultStatus:u,EnumFlowType:g,EnumDriverLicenseScannerViews:V,EnumDriverLicenseScanSide:b};export{O as DDLS,k as DriverLicenseNormalizerView,N as DriverLicenseResultView,H as DriverLicenseScanner,B as DriverLicenseScannerView,b as EnumDriverLicenseScanSide,u as EnumResultStatus};
